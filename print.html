<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Forge Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="././mdbook-admonish.css">
        <link rel="stylesheet" href="./mdbook-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="home.html">Home</a></li><li class="chapter-item affix "><li class="part-title">Getting Started</li><li class="chapter-item "><a href="getting-started/installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item affix "><li class="part-title">Building Models</li><li class="chapter-item "><a href="building-models/overview.html"><strong aria-hidden="true">2.</strong> Overview</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="building-models/alloy-user-overview.html"><strong aria-hidden="true">2.1.</strong> Addendum for Alloy Users</a></li></ol></li><li class="chapter-item "><a href="building-models/sigs/sigs.html"><strong aria-hidden="true">3.</strong> Sigs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="building-models/sigs/inheritance.html"><strong aria-hidden="true">3.1.</strong> Inheritance</a></li><li class="chapter-item "><a href="building-models/sigs/singleton-maybe-sigs.html"><strong aria-hidden="true">3.2.</strong> Singleton, Maybe, and Abstract Sigs</a></li><li class="chapter-item "><a href="building-models/sigs/multiplicity.html"><strong aria-hidden="true">3.3.</strong> Field Multiplicity</a></li><li class="chapter-item "><a href="building-models/sigs/advanced.html"><strong aria-hidden="true">3.4.</strong> Advanced: Sigs and fields, under-the-hood</a></li></ol></li><li class="chapter-item "><a href="building-models/constraints/constraints.html"><strong aria-hidden="true">4.</strong> Constraints</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="building-models/constraints/instances.html"><strong aria-hidden="true">4.1.</strong> Instances</a></li><li class="chapter-item "><a href="building-models/constraints/formulas/formulas.html"><strong aria-hidden="true">4.2.</strong> Formulas</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="building-models/constraints/formulas/operators.html"><strong aria-hidden="true">4.2.1.</strong> Operators</a></li><li class="chapter-item "><a href="building-models/constraints/formulas/cardinality-membership.html"><strong aria-hidden="true">4.2.2.</strong> Cardinality and Membership</a></li><li class="chapter-item "><a href="building-models/constraints/formulas/quantifiers.html"><strong aria-hidden="true">4.2.3.</strong> Quantifiers</a></li><li class="chapter-item "><a href="building-models/constraints/formulas/predicates.html"><strong aria-hidden="true">4.2.4.</strong> Predicates</a></li></ol></li><li class="chapter-item "><a href="building-models/constraints/expressions/expressions.html"><strong aria-hidden="true">4.3.</strong> Expressions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="building-models/constraints/expressions/relational-expressions/relational-expressions.html"><strong aria-hidden="true">4.3.1.</strong> Relational Operators</a></li><li class="chapter-item "><a href="building-models/constraints/expressions/functions.html"><strong aria-hidden="true">4.3.2.</strong> Functions</a></li><li class="chapter-item "><a href="building-models/constraints/expressions/let-expressions.html"><strong aria-hidden="true">4.3.3.</strong> Let-Expressions</a></li></ol></li></ol></li><li class="chapter-item "><a href="building-models/comments.html"><strong aria-hidden="true">5.</strong> Comments</a></li><li class="chapter-item affix "><li class="part-title">Running Models</li><li class="chapter-item "><a href="running-models/running.html"><strong aria-hidden="true">6.</strong> Running</a></li><li class="chapter-item "><a href="running-models/sterling-visualizer.html"><strong aria-hidden="true">7.</strong> Sterling Visualizer</a></li><li class="chapter-item "><a href="running-models/bounds.html"><strong aria-hidden="true">8.</strong> Bounds</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="running-models/concrete-instance-bounds.html"><strong aria-hidden="true">8.1.</strong> Concrete Instance Bounds</a></li></ol></li><li class="chapter-item "><a href="running-models/options.html"><strong aria-hidden="true">9.</strong> Options</a></li><li class="chapter-item "><a href="running-models/optimization.html"><strong aria-hidden="true">10.</strong> Optimization</a></li><li class="chapter-item affix "><li class="part-title">Testing</li><li class="chapter-item "><a href="testing-chapter/testing.html"><strong aria-hidden="true">11.</strong> Testing</a></li><li class="chapter-item affix "><li class="part-title">Forge Standard Library (Built-Ins)</li><li class="chapter-item "><a href="forge-standard-library/integers.html"><strong aria-hidden="true">12.</strong> Integers</a></li><li class="chapter-item "><a href="forge-standard-library/constants-and-keywords.html"><strong aria-hidden="true">13.</strong> Constants and Keywords</a></li><li class="chapter-item "><a href="forge-standard-library/helpers.html"><strong aria-hidden="true">14.</strong> Helpers: Sequences and Reachability</a></li><li class="chapter-item affix "><li class="part-title">Temporal Forge</li><li class="chapter-item "><a href="electrum/electrum-overview.html"><strong aria-hidden="true">15.</strong> Temporal Forge Overview and Operators</a></li><li class="chapter-item affix "><li class="part-title">Custom Visualizations</li><li class="chapter-item "><a href="sterling/cnd.html"><strong aria-hidden="true">16.</strong> Lightweight Customization with CnD</a></li><li class="chapter-item "><a href="sterling/custom-basics.html"><strong aria-hidden="true">17.</strong> JavaScript Custom Visualization Basics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="sterling/d3fx_apr23.html"><strong aria-hidden="true">17.1.</strong> D3FX JavaScript Helpers</a></li><li class="chapter-item "><a href="sterling/svg-tips.html"><strong aria-hidden="true">17.2.</strong> Working with SVG and Imports</a></li></ol></li><li class="chapter-item "><li class="part-title">Domain-Specific Input</li><li class="chapter-item "><a href="dsl/abac.html"><strong aria-hidden="true">18.</strong> Attribute-Based Access Control</a></li><li class="chapter-item affix "><li class="part-title">Glossary of Terms and Errors</li><li class="chapter-item "><a href="glossary.html"><strong aria-hidden="true">19.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Forge Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="home"><a class="header" href="#home">Home</a></h1>
<p>Forge is a lightweight modeling language, similar to <a href="https://alloytools.org">Alloy</a>, that has been designed for <em>teaching</em> modeling and lightweight formal methods. It comprises three sublanguages or modes:</p>
<ul>
<li><strong>Froglet</strong> (<code>#lang forge/froglet</code>), a language for modeling using only functions and partial functions;</li>
<li><strong>Relational Forge</strong> (<code>#lang forge</code>), an extension of Froglet to include relations and relational operators;</li>
<li><strong>Temporal Forge</strong> (<code>#lang forge/temporal</code>), an extension of Forge to include linear-temporal operators (akin to Alloy 6 or <a href="https://github.com/haslab/Electrum">Electrum</a>).</li>
</ul>
<p>Students can progress through this language hierarchy as new concepts are introduced in class; this lets the course avoid a steep language-learning curve and cover important practical material earlier than would otherwise be possible.</p>
<div id="admonition-if-there-are-three-languages-are-there-three-versions-of-the-documentation" class="admonition admonish-note">
<div class="admonition-title">
<p>If there are three languages, are there three versions of the documentation?</p>
<p><a class="admonition-anchor-link" href="home.html#admonition-if-there-are-three-languages-are-there-three-versions-of-the-documentation"></a></p>
</div>
<div>
<p><strong>No!</strong> In principle, we might ideally have three separate versions, but we are focusing (for now) on 
producing better documentation overall rather than taking on the subtle cross-language page-linking challenge. </p>
<p>We will nevertheless try to maintain a reasonable separation.</p>
</div>
</div>
<h2 id="textbook"><a class="header" href="#textbook">Textbook</a></h2>
<p>Forge also has a <a href="https://csci1710.github.io/book/">draft textbook</a>, which is in a different document in order to make searching easier.</p>
<h2 id="using-this-documentation"><a class="header" href="#using-this-documentation">Using this Documentation</a></h2>
<div id="admonition-table-of-contents-theme-and-search" class="admonition admonish-tip">
<div class="admonition-title">
<p>Table of Contents, Theme, and Search</p>
<p><a class="admonition-anchor-link" href="home.html#admonition-table-of-contents-theme-and-search"></a></p>
</div>
<div>
<p>This page has three buttons for popping out the table of contents, changing the color theme, and searching. If you do not see them, please ensure that JavaScript is enabled.</p>
<center>
If the table of contents isn't open, click this button:
<label id="sidebar-toggle-alternate" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents (Alternate Button)" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
<p>The table of contents is expandable. Once it is open, cxlick the ❱ icons to expand individual sections and subsections to browse more easily! </p>
<p>To change the color theme of the page, click this button:
<button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme (Alternate Button)" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
<i class="fa fa-paint-brush"></i>
</button></p>
<p>To search, click this button:
<button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar (Alternate Button)" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
<i class="fa fa-search"></i>
</button></p>
</center>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>To run Forge, you will need to have installed:</p>
<ul>
<li><a href="https://download.racket-lang.org/all-versions.html">Racket</a> (we suggest the latest version, and certainly no lower than 8.7);</li>
<li>Java 11 or later (which you can get <a href="https://www.oracle.com/java/technologies/javase-downloads.html">here</a> if you don't have it); </li>
<li>A modern web-browser for visualizing output (we suggest, and primarily test on, Firefox).</li>
</ul>
<p>We strongly suggest using our VSCode extension to write Forge, although you can also run from the terminal or use DrRacket (Racket's built-in IDE). You can get VSCode <a href="https://code.visualstudio.com">here</a>.</p>
<h2 id="installing-forge"><a class="header" href="#installing-forge">Installing Forge</a></h2>
<p>To install Forge, you have two options. The first is to <strong>install from Racket’s package server</strong>, and the second is to <strong>install from Git</strong>, which also allows (but doesn't require) you to use the latest development build if you wish.</p>
<p>We recommend installing from Git, because this way you can pull updates immediately if you wish to. </p>
<h3 id="installing-from-git"><a class="header" href="#installing-from-git">Installing from Git</a></h3>
<p>To install via Git, open a terminal window. Then: </p>
<ul>
<li>clone our Git repository (<code>git clone https://github.com/tnelson/forge</code>);</li>
<li>change directory to the repository folder (<code>cd forge</code>);</li>
<li>install the <code>forge</code> and <code>froglet</code> packages (<code>raco pkg install ./forge</code>).</li>
</ul>
<p>If you wish to switch to the development branch, you must:</p>
<ul>
<li>check out the development branch (<code>git checkout dev</code>);</li>
<li>rebuild Forge (<code>raco setup forge</code>).</li>
</ul>
<div id="admonition-using-" class="admonition admonish-warning">
<div class="admonition-title">
<p>Using ./</p>
<p><a class="admonition-anchor-link" href="getting-started/installation.html#admonition-using-"></a></p>
</div>
<div>
<p>Note the <code>./</code> in the <code>install</code> command! If you write <code>raco pkg install forge froglet</code>, that will install both from the package server instead of your local directory. Adding prefix <code>./</code> tells <code>raco</code> that you're talking about folders instead. It's also important to have both <code>./forge</code> and <code>./froglet</code> in the single command; they depend on each other, so leaving one out will cause <code>raco</code> to &quot;helpfully&quot; install it from the package server, not your local drive.</p>
</div>
</div>
<div id="admonition-upgrading-a-version-from-before-2025" class="admonition admonish-note">
<div class="admonition-title">
<p>Upgrading a version from before 2025?</p>
<p><a class="admonition-anchor-link" href="getting-started/installation.html#admonition-upgrading-a-version-from-before-2025"></a></p>
</div>
<div>
<p>If you have already installed a version of Forge prior to 2025, we are no longer using the separate package <code>froglet</code>. Rather than simply updating, you should run <code>raco pkg uninstall forge froglet</code> and follow the installation instructions from the beginning.</p>
</div>
</div>
<h3 id="installing-from-rackets-package-servers"><a class="header" href="#installing-from-rackets-package-servers">Installing from Racket's Package Servers</a></h3>
<p>For the standard package-server installation, after installing Racket, run <code>raco pkg install forge froglet</code> from your command line. Alternatively, you can run Racket's IDE, DrRacket, and navigate to <em>File &gt; Install Package</em>. Type <code>forge</code> as the package name and choose <strong>Install</strong>, then do the same for <code>froglet</code> </p>
<p>If the package is already installed, you'll see an <strong>Update</strong> button instead of an <strong>Install</strong> button.</p>
<h4 id="forge-version"><a class="header" href="#forge-version">Forge Version</a></h4>
<p>When you run a Forge file (via <code>racket &lt;filename&gt;</code> at the command line), you'll be told the <em>Forge version</em> you're running. This is important information to include with questions, etc. If you're taking a class that uses Forge, you can expect a few Forge updates throughout the semester---<em>please keep Forge updated!</em></p>
<h2 id="installing-vscode-extension-for-forge"><a class="header" href="#installing-vscode-extension-for-forge">Installing VSCode Extension for Forge</a></h2>
<p>To get Forge's VSCode extension, open VSCode and click the Extensions button on the sidebar: </p>
<center>
<img src="getting-started/./vscode_extension_button.png" width="10%"/>
</center>
<p>Then type <code>forge-language-server</code> in the search bar. You should see an extension with that title, under the developer name &quot;Siddhartha Prasad&quot;. Install it and reload VSCode.</p>
<div id="admonition-for-early-adopters" class="admonition admonish-warning">
<div class="admonition-title">
<p>For early adopters</p>
<p><a class="admonition-anchor-link" href="getting-started/installation.html#admonition-for-early-adopters"></a></p>
</div>
<div>
<p>An early version of this extension was provided via Github, rather than the VSCode Marketplace. Please <strong>use the Marketplace version</strong> (and uninstall the other, if you have it) if for no other reason than it will automatically update when you restart VSCode.</p>
</div>
</div>
<h3 id="logging-in-vscode"><a class="header" href="#logging-in-vscode">Logging in VSCode</a></h3>
<p>If you're working in a file with the <code>.frg</code> extension, you should see an eye icon in your VSCode toolbar (usually on the upper right). This can be used to opt out of (and back into) logging. By default, we log the state of your Forge model whenever you click the run button in VSCode. This includes the contents of every <code>.frg</code> file being edited in VSCode. No other information is recorded, not even your identity. </p>
<div id="admonition-comparison-to-spring-2023" class="admonition admonish-note">
<div class="admonition-title">
<p>Comparison to Spring 2023</p>
<p><a class="admonition-anchor-link" href="getting-started/installation.html#admonition-comparison-to-spring-2023"></a></p>
</div>
<div>
<p>In prior years, logging was done via annotations to <code>#lang</code> in homework files. We no longer do this. A major consequence is that we no longer know your identity from logs; we believe this is an improvement! However, it does mean we can't reach out if we see a problem happening. Please <em>report problems</em> if you see them.</p>
</div>
</div>
<p>We log primarily for two reasons. </p>
<ul>
<li>First, Forge is under active development---the majority of the codebase was written by undergraduate researchers working with Tim! This means that information about how Forge is used, what errors arise, etc. can be useful in making Forge better. </li>
<li>Second, Forge is mainly used in the classroom. It's easy for instructors to claim, anecdotally, that students &quot;like&quot; something or &quot;find it useful&quot; based on a handful of office-hours conversations. We want to hold ourselves to a higher standard. What proportion of students <em>actually uses</em> that feature? Is the hinting we provide on some problems <em>effective</em>? Questions like these are impossible to answer without knowing something about patterns of use. </li>
</ul>
<!-- ## Installing VSCode Extension for GPT-3

This extension allows you to write questions to GPT-3 from your editor. 

---
### Requirements

- Your Brown Provided API Key.
- Your Brown-provided User Id.

--- 

[Once downloaded, the extension can be installed following the instructions here.](https://code.visualstudio.com/docs/editor/extension-marketplace#_install-from-a-vsix)

When the extension is installed, a prompt will appear for you to enter in your API key and your User Id. You must use the extension **only with the API key provided by the course**, obtained from filling out the [responsible-use form](https://docs.google.com/forms/d/e/1FAIpQLSe18e5qNnaZm6JBMsAM3cNJiEC43ElsLyL6IJIN6U3WDOR1-w/viewform?usp=sf_link).

---


### Functionality
#### Ask GPT
Sends user input to GPT for processing. The response will appear in a modal.

> Default key binding set to `alt + g` (Windows) or `cmd + g` (Mac)
> Ask GPT in the Status Bar

#### Ask GPT inline
Queries GPT-3 with highlighted text. The response is automatically injected **below** the highlighted docs.

> Default key binding set to `alt + q` (Windows) or `cmd + q` (Mac)


#### Re-enter API Key

> - Open command palette and run `Update OpenAI API Key` (alt + m on Windows, cmd + m on Mac)
> - Enter your correct API Key into the prompt 
> - Reload VSCODE

#### Re-enter UserId

> - Open command palette and run `Update UserId` (alt + u on Windows, cmd + u on Mac)
> - Enter your correct UserId into the prompt 
> - Reload VSCODE
--- -->
<h2 id="checking-your-installation"><a class="header" href="#checking-your-installation">Checking your installation</a></h2>
<p>Once Racket, Forge, and Java are installed, you should confirm that everything is working properly. Create a text file <code>test.frg</code> with only the contents <code>#lang forge</code> and then, from your command line, type <code>racket test.frg</code>. If this runs without error, congratulations, Forge should now be installed!</p>
<p>If you encounter any issues installing, please report them. We'll do our best to get you help as soon as possible.</p>
<ul>
<li>If you're taking CSCI 1710 at Brown, a class that uses Forge, report bugs on EdStem. </li>
<li>If you don't have a course-related means of reporting bugs, please mail Tim (Tim_Nelson@brown.edu).</li>
</ul>
<h2 id="updating-forge"><a class="header" href="#updating-forge">Updating Forge</a></h2>
<p><strong>Please remember to update using the method appropriate for your install.</strong></p>
<h3 id="if-you-installed-via-rackets-package-system"><a class="header" href="#if-you-installed-via-rackets-package-system">If you installed via Racket's package system</a></h3>
<p>Do:</p>
<ul>
<li><code>raco pkg update forge</code> and </li>
<li><code>raco pkg update froglet</code>.<br />
or click <code>Update</code> for both in the DrRacket package manager.</li>
</ul>
<h3 id="if-you-installed-via-git"><a class="header" href="#if-you-installed-via-git">If you installed via Git</a></h3>
<p>Do:</p>
<ul>
<li><code>cd</code> to the location of the <code>Forge</code> repository on your system;</li>
<li>make sure you're in the branch you want (<code>main</code> for published updates, <code>dev</code> for our development build);</li>
<li><code>git pull</code> in the repository, and then </li>
<li><code>raco setup forge</code> and <code>raco setup froglet</code> (to rebuild the packages). </li>
</ul>
<div id="admonition-confirming-install-location" class="admonition admonish-tip">
<div class="admonition-title">
<p>Confirming install location</p>
<p><a class="admonition-anchor-link" href="getting-started/installation.html#admonition-confirming-install-location"></a></p>
</div>
<div>
<p>Confirm that these packages are installed properly using <code>raco pkg show froglet</code> and <code>raco pkg show forge</code>. </p>
<p>If one is installed from a directory on your machine, and another via the Racket package system, issues can occur. Here's how to read the information that <code>raco</code> provides. If it says: </p>
<ul>
<li><code>link &lt;path on your machine&gt;</code> then the package is installed from a local folder; and </li>
<li><code>catalog ...</code> means the package is installed via Racket's servers.</li>
</ul>
</div>
</div>
<h2 id="known-installation-related-issues"><a class="header" href="#known-installation-related-issues">Known Installation-Related Issues</a></h2>
<h3 id="windows-visualizer-connectivity"><a class="header" href="#windows-visualizer-connectivity">Windows: Visualizer Connectivity</a></h3>
<p>If you use Windows, running Forge from <code>cmd</code> or PowerShell is not recommended (as of January 2024); we strongly suggest using the VSCode extension, DrRacket, the Windows Subsystem for Linux (<code>wsl</code>), Git <code>bash</code>, or Cygwin.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>Forge is a tool (and a set of languages) that allows us to define models of systems and explore instances of those models. But <strong><em>what does that mean</em></strong>? Let's break it down:</p>
<h2 id="systems"><a class="header" href="#systems">Systems</a></h2>
<p>A <strong>system</strong> can be generally thought of as a particular way that various entities interact.  A system isn't necessarily a <em>computer</em> system, although it can be. For example:</p>
<ul>
<li>The game of baseball is a system involving players, a ball, a field and bases, etc. along with rules that govern how those things interact with each other.</li>
<li>Family trees are a system where there are people, and rules that express how they are related to each other.</li>
<li>A cryptographic protocol is a system where there are parties, messages, cryptographic primitives, and rules that govern how messages can be encrypted, decrypted, sent, and received.</li>
<li>Binary search trees are a system where there are nodes, values, connections between nodes, and rules that govern how nodes can be created, removed, and positioned relative to one another.
<em>There is no limit to the type or complexity of a system that we can discuss</em>, although different tools and techniques are useful for working with and able to express different kinds of systems.</li>
</ul>
<hr />
<h2 id="models"><a class="header" href="#models">Models</a></h2>
<p>A <strong>model</strong> is a <em>representation</em> of a system that faithfully includes some but usually not all of the system's complexity. There are many different ways to model a system, all of which have different advantages and disadvantages. Think about what a car company does before it produces a new car design. Among other things, it creates multiple models. E.g.,</p>
<ul>
<li>it models the car in some computer-aided design tool; and then</li>
<li>creates a physical model of the car, perhaps with clay, for testing in wind tunnels etc.</li>
</ul>
<p>There may be many different models of a system, all of them focused on something different, and all of them useful for something. (As the statisticians say, &quot;all models are wrong, but some models are useful&quot;.)</p>
<p>Models define a notion of what kinds of things exist in the system and (some of) the &quot;rules&quot; governing the system. In a well-crafted model, we can explore what scenarios are possible in the system, which gives us insight and the ability to reason about the system itself---within the bounds of what the model expresses. </p>
<h3 id="example-friends"><a class="header" href="#example-friends">Example: Friends</a></h3>
<p>If we wanted to model a group of friends, we might define our model to have the following structure:</p>
<ul>
<li>There's a type of object, <code>Person</code>, in the system.</li>
<li>Each <code>Person</code> has a <code>bestFriend</code> field, possibly containing a <code>Person</code>.</li>
<li>Each <code>Person</code> has a best friend. </li>
</ul>
<p>These three items correspond to three different concepts in Forge: defining types (<code>sig</code>s), defining fields that those types have, and defining constraints. </p>
<h3 id="a-note-on-imperfect-representations"><a class="header" href="#a-note-on-imperfect-representations">A Note on Imperfect Representations</a></h3>
<p>It is very difficult to fully model some systems. That being said, <em>we don't need to fully model a system for the model to be useful</em>. We can simplify or omit concepts as needed to approximate the system while preserving the fundamentals that we're interested in.</p>
<p>We can see this principle applied in the car-manufacturing example above. You could use a solid clay model of a car to accurately determine the car's aerodynamics in a wind tunnel, but you'd have a hard time exploring how the doors of the car operate or how any of the interior parts work. What you can explore is limited by how the system is modeled. If all you care about is exploring the aerodynamic profile of a car, then we can safely abstract out the internals of the car and focus on the shape. </p>
<p>Likewise, in our &quot;friend group&quot; system example, we don't have to fully describe a <code>Person</code> in our model, we just have to describe the relevant properties of a <code>Person</code>. We abstract the idea of &quot;friendship,&quot; combining all types of friends (best friend, acquaintance, etc.) into a single concept of &quot;friend.&quot; We omit from our model the concept of a <code>Person</code>'s dietary restrictions and myriad other things. These are all choices that affect the scope of our model. If we wanted to distinguish between types of friends, or examine familial relationships as well, we would have to expand the model to include those concepts---and we could!</p>
<p>Learning how to model a system is a key skill for engineers; abstraction is one of our main tools in Computer Science, and modeling lies at the heart of abstraction.</p>
<hr />
<h2 id="instances"><a class="header" href="#instances">Instances</a></h2>
<p>An <strong>instance</strong> is a concrete scenario that abides by the rules of a model, containing specific objects (<em>atoms</em>) and their relationships with each other.</p>
<div id="admonition-analogy-to-oop" class="admonition admonish-warning">
<div class="admonition-title">
<p>Analogy to OOP</p>
<p><a class="admonition-anchor-link" href="building-models/overview.html#admonition-analogy-to-oop"></a></p>
</div>
<div>
<p>We can draw a very rough analogy to object-oriented programming here. We might say:</p>
<ul>
<li>a <code>sig</code> definition, along with its fields, is like a class; and</li>
<li>atoms within an instance of a model are like objects (since each atom belongs to some <code>sig</code>).
This is a useful analogy! </li>
</ul>
<p>Just remember that <strong>it is an analogy and not the exact truth</strong>. There are important differences. For example, you might remember the heap from Java or some other language, and wonder how atoms (analogously to objects) are created or garbage-collected. But <em>there is no heap</em> in Forge instances, only a set of atoms for each <code>sig</code>. Similarly, you might wonder how a Forge model executes. But it doesn't! A Forge model defines a set of possible instances, which the tool searches for.</p>
</div>
</div>
<p>Each instance shows a single way that the constraints in the model can be satisfied. Here are two example instances, described in English:</p>
<ul>
<li>There are two people, <code>Tim</code> and <code>Nim</code>. <code>Tim</code> has <code>Nim</code> as a best friend, and <code>Nim</code> has <code>Tim</code> as a best friend. </li>
<li>There is one person, <code>Nim</code>, who has <code>Nim</code> as a best friend. </li>
<li>There are no people. </li>
</ul>
<p>Why do the second and third instance get produced? Because all we told Forge to enforce was:</p>
<ul>
<li>Each <code>Person</code> must have a best friend.</li>
</ul>
<p>If there are no people, there is nobody to be obligated to have friends. The empty instance satisfies this constraint.</p>
<h2 id="satisfiability-and-unsatisfiability"><a class="header" href="#satisfiability-and-unsatisfiability">Satisfiability and Unsatisfiability</a></h2>
<p>Semi-formally, we'll say that a model is <em>satisfied</em> by an instance if:</p>
<ul>
<li>it contains sets of atoms for every <code>sig</code> in the model; </li>
<li>each atom has fields appropriate to its <code>sig</code>; and </li>
<li>the instance obeys all of the model's constraints. </li>
</ul>
<p>A model is <em>satisfiable</em> if there exists some satisfying instance for it. A model is <em>unsatisfiable</em> if there is no instance that satisfies it. </p>
<div id="admonition-another-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Another example</p>
<p><a class="admonition-anchor-link" href="building-models/overview.html#admonition-another-example"></a></p>
</div>
<div>
<p>If you play Sudoku, you might imagine modeling the game as a set of constraints. Then add:</p>
<ul>
<li>constraints that express the starting puzzle; and </li>
<li>a constraint expressing the need to populate every square in the board.</li>
</ul>
<p>If the starting puzzle has a solution, the model will be satisfiable. If there is no solution, it will be unsatisfiable.</p>
</div>
</div>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>In Forge, we use <a href="building-models/./sigs.html"><code>sig</code>s</a> to define the types that exist in a system, and <a href="building-models/./constraints.html">constraints</a> to define the &quot;rules&quot; of the system.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="addendum-for-alloy-users"><a class="header" href="#addendum-for-alloy-users">Addendum for Alloy Users</a></h1>
<p>All Forge languages (as of January 2024) are restricted versions of Alloy 6, with some added features. </p>
<p>Relational Forge syntax and semantics are nearly identical to Alloy 5. Similarly, Temporal Forge approximates Alloy 6. There are some minor differences. E.g.:</p>
<ul>
<li>All Forge languages eschew the <code>fact</code> construct and <code>sig</code>-facts in favor of using predicates throughout.</li>
<li>Forge disallows some complex field declarations. E.g., one cannot write a bijection as <code>f: A one -&gt; one A</code>. Instead, Forge fields always have exactly one multiplicity keyword and a product of sig names.</li>
<li>Forge introduces new <a href="building-models/../testing-chapter/testing.html">syntax for testing</a>. It also supports <a href="building-models/../running-models/concrete-instance-bounds.html">partial instances</a> via the <code>inst</code> keyword.</li>
<li>Due to user-experience concerns, we have changed the name of the <code>after</code> temporal operator to <code>next_state</code>. This avoids confusion due to Alloy (and Forge's) implicit conjunction; the <code>after</code> in <code>A after B</code> appears at first to be a binary operator, which it is not!</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="sigs"><a class="header" href="#sigs">Sigs</a></h1>
<p><em>Sigs</em> (short for &quot;signatures&quot;) are the basic building block of any model in Forge. They represent the types of the system being modeled. To declare one, use the <code>sig</code> keyword. </p>
<pre><code>sig &lt;name&gt; {}
</code></pre>
<p>A <code>sig</code> can also have one or more <em>fields</em>, which define relationships between members of that <code>sig</code> other atoms. The definition above has no fields because the braces are empty. In contrast, this <code>sig</code> definition would have many fields:</p>
<pre><code>sig &lt;name&gt; {
    &lt;field&gt;,
    &lt;field&gt;,
    ...
    &lt;field&gt;
}
</code></pre>
<div id="admonition-syntax-note" class="admonition admonish-note">
<div class="admonition-title">
<p>Syntax Note</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/sigs.html#admonition-syntax-note"></a></p>
</div>
<div>
<p>Ensure that there is a <strong>comma after every field except for the last one</strong>. This is a common source of compilation errors when first defining a model!</p>
</div>
</div>
<h2 id="fields"><a class="header" href="#fields">Fields</a></h2>
<p>Fields allow us to define relationships between a given <code>sig</code>s and other components of our model. Each <em>field</em> in a <code>sig</code> has:</p>
<ul>
<li>a <em><strong>name</strong></em> for the field;</li>
<li>a <a href="building-models/sigs/./multiplicity.html"><em><strong>multiplicity</strong></em></a> (<code>one</code>, <code>lone</code>, <code>pfunc</code>, <code>func</code>, or, in Relational or Temporal Forge, <code>set</code>);</li>
<li>a <em><strong>type</strong></em> (a <code>-&gt;</code> separated list of <code>sig</code> names, including the built-in sig <a href="building-models/sigs/../../forge-standard-library/constants-and-keywords.html"><code>Int</code></a>)<em><strong>.</strong></em></li>
</ul>
<div id="admonition-example-sig-definition" class="admonition admonish-example">
<div class="admonition-title">
<p>Example sig definition</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/sigs.html#admonition-example-sig-definition"></a></p>
</div>
<div>
<p>Here is a sig that defines the <code>Person</code> type from the <a href="building-models/sigs/../overview.html">overview</a>.</p>
<pre><code>sig Person {
    bestFriend: lone Person
}
</code></pre>
<p>The <code>lone</code> <a href="building-models/sigs/./multiplicity.html">multiplicity</a> says that the field may contain at most one atom. (Note that this example has yet to express the constraint that everyone has a friend!)</p>
</div>
</div>
<h3 id="more-examples"><a class="header" href="#more-examples">More Examples</a></h3>
<p>Let's look at a few more examples.</p>
<div id="admonition-example-sig-with-one-field" class="admonition admonish-example">
<div class="admonition-title">
<p>Example: Sig with one field</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/sigs.html#admonition-example-sig-with-one-field"></a></p>
</div>
<div>
<p><strong>Basic Sig with Fields (Linked List):</strong></p>
<p>A model of a circularly-linked list might have a <code>sig</code> called <code>Node</code>. <code>Node</code> might then have a field <code>next: one Node</code> to represent the contents of every <code>Node</code>'s <code>next</code> reference. We use <code>one</code> here since every <code>Node</code> always has exactly one successor in a <em>circularly</em> linked list. </p>
<pre><code>sig Node {
    next: one Node
}
</code></pre>
</div>
</div>
<div id="admonition-example-sig-with-multiple-fields" class="admonition admonish-example">
<div class="admonition-title">
<p>Example: Sig with multiple fields</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/sigs.html#admonition-example-sig-with-multiple-fields"></a></p>
</div>
<div>
<p><strong>Basic Sig with Fields (Binary Tree):</strong></p>
<p>A model of a binary tree might have a <code>sig</code> called <code>Node</code>. <code>Node</code> might then have three fields:</p>
<ul>
<li><code>left: lone Node</code> and <code>right: lone Node</code> to represent the <code>Node</code>'s children. We use <code>lone</code> here since the left/right child fields can either be empty or contain exactly one <code>Node</code>.</li>
<li><code>val: one Int</code> to represent the value of each Node, where we have decided that every <code>Node</code> should have an <code>Int</code>eger value. We use <code>one</code> here because each <code>Node</code> should have exactly one value.</li>
</ul>
<pre><code>sig Node {
    left: lone Node,
    right: lone Node,
    val: one Int
}
</code></pre>
<p><em><code>Int</code> is a built-in sig provided by Forge. To learn more about how Forge handles integers, see <a href="building-models/sigs/../../forge-standard-library/integers.html">Integers in Forge</a>.</em></p>
</div>
</div>
<div id="admonition-example-sig-with-no-fields" class="admonition admonish-example">
<div class="admonition-title">
<p>Example: Sig with No Fields</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/sigs.html#admonition-example-sig-with-no-fields"></a></p>
</div>
<div>
<p><strong>Example - Basic Sig without Fields:</strong></p>
<p>Not every <code>sig</code> in a model needs to have fields to be a useful part of the model! <code>sig</code>s with no fields are often used in conjunction with other <code>sig</code>s that reference them. One such example might look like this:</p>
<pre><code>sig Student {}
sig Group {
    member: set Student
}
</code></pre>
<p>Note that the <code>set</code> multiplicity is only available in Relational and Temporal Forge, not Froglet.</p>
</div>
</div>
<div id="admonition-field-names-must-be-unique" class="admonition admonish-warning">
<div class="admonition-title">
<p>Field names must be unique</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/sigs.html#admonition-field-names-must-be-unique"></a></p>
</div>
<div>
<p>You cannot use the same field name within two different <code>sigs</code> in a model. This is because field names are globally available for writing constraints.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h1>
<p>Sigs may inherit from other sigs via the <code>extends</code> keyword:</p>
<pre><code class="language-clike">sig &lt;name&gt; extends &lt;parent sig name&gt; {
    &lt;additional fields&gt; ...
}
</code></pre>
<p>Sigs may only have <em>at most one parent sig</em>. Moreover, much like how no object can be belong to multiple top-level sigs, no object can belong to more than one immediate child of any sig. That is, any two sigs <code>A</code> and <code>B</code> will never contain an object in common unless one is a descendent of the other. </p>
<div id="admonition-different-kinds-of-cat" class="admonition admonish-example">
<div class="admonition-title">
<p>Different kinds of cat</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/inheritance.html#admonition-different-kinds-of-cat"></a></p>
</div>
<div>
<pre><code class="language-clike">sig Cat {
    favoriteFood: one Food
}
sig ActorCat extends Cat {
    playName: one Play
}
sig ProgrammerCat extends Cat {}
</code></pre>
<p>This means that any <code>ProgrammerCat</code> object is also a <code>Cat</code> object, and so will have a <code>favoriteFood</code> field. But only <code>ActorCat</code>s have the <code>playName</code> field. Moreover, any cat may be either an <code>ActorCat</code>, <code>ProgrammerCat</code>, or neither---but not both.</p>
</div>
</div>
<div id="admonition-inheritance-and-bounds" class="admonition admonish-warning">
<div class="admonition-title">
<p>Inheritance and Bounds</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/inheritance.html#admonition-inheritance-and-bounds"></a></p>
</div>
<div>
<p>Forge must have bounds for <em>every</em> sig, including child sigs. The default of 0-to-4 objects is applied to every top-level sig. Forge can often infer consistent bounds for child sigs, but it cannot always do so and will require you to provide them. This is most often the case in the presence of complex hierarchies involving <code>abstract</code> and <code>one</code> sigs. </p>
<p>More importantly, <code>example</code> and <code>inst</code> syntax require the contents of parent sigs to be defined once the contents of a single child are set. To see why, consider this example:</p>
<pre><code class="language-clike">example workingCats is {myPredicate} for {
    ActorCat = `ActorCat0 + `ActorCat1
    ProgrammerCat = `ProgrammerCat0 + `ProgrammerCat1
}
</code></pre>
<p>This produces an error: </p>
<blockquote>
<p>run: Please specify an upper bound for ancestors of ActorCat.</p>
</blockquote>
<p>This error occurs because Forge knows only that there are 2 specific actors and 2 specific programmers, and can't infer whether any <em>other</em> cats exist. To fix the error, provide bounds for the parent sig:</p>
<pre><code class="language-clike">example workingCats is {myPredicate} for {    
    ActorCat = `ActorCat0 + `ActorCat1
    ProgrammerCat = `ProgrammerCat0 + `ProgrammerCat1
    Cat = `ActorCat0 + `ActorCat1 + `ProgrammerCat0 + `ProgrammerCat1
}
</code></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="singleton-and-maybe-sigs"><a class="header" href="#singleton-and-maybe-sigs">Singleton and Maybe Sigs</a></h1>
<p>A sig declaration can be annotated to indicate:</p>
<ul>
<li>that there is always exactly one object of that sig (<code>one sig</code>);</li>
<li>that there is never more than one object of that sig (<code>lone sig</code>); or</li>
<li>that any object of that sig must also be a member of some child sig (<code>abstract sig</code>).</li>
</ul>
<div id="admonition-one-sig" class="admonition admonish-example">
<div class="admonition-title">
<p>One Sig</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/singleton-maybe-sigs.html#admonition-one-sig"></a></p>
</div>
<div>
<pre><code class="language-clike">sig Dog {}
-- &quot;Beauty without Vanity, Courage without Ferosity, Strength without Insolence&quot;
one sig Boatswain extends Dog {}
</code></pre>
<p>If you'd asked <a href="https://en.wikipedia.org/wiki/Epitaph_to_a_Dog">Lord Byron</a>, there was only one Boatswain---whose tomb was famously larger than Lord Byron's own.</p>
</div>
</div>
<div id="admonition-abstract-sig" class="admonition admonish-example">
<div class="admonition-title">
<p>Abstract Sig</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/singleton-maybe-sigs.html#admonition-abstract-sig"></a></p>
</div>
<div>
<pre><code class="language-clike">abstract sig Student {}
sig Undergrad, Grad extends Student {}
</code></pre>
<p>In this example, any <code>Student</code> must be either an <code>Undergrad</code> or <code>Grad</code> student.</p>
</div>
</div>
<div id="admonition-lone-sig" class="admonition admonish-example">
<div class="admonition-title">
<p>Lone Sig</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/singleton-maybe-sigs.html#admonition-lone-sig"></a></p>
</div>
<div>
<p>Lone sigs aren't used much; you can think of them in the same way you'd use a <code>one</code> sig, but with the possibility that the sig will be empty. This can sometimes be useful for efficiency. E.g., if we were modeling soup recipes:</p>
<pre><code class="language-clike">abstract sig Ingredient {}
lone sig Potatoes extends Ingredient {}
lone sig Carrots extends Ingredient {}
lone sig Celery extends Ingredient {}
lone sig Water extends Ingredient {}
// ...
</code></pre>
<p>There might be dozens of possible ingredients. But if we only want to use a few at a time, it can be useful to set a lower bound on <code>Ingredient</code> and allow un-used ingredients to simply not exist.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="field-multiplicity"><a class="header" href="#field-multiplicity">Field Multiplicity</a></h1>
<p>While types define what kinds of data can fit into a specific field, <em>multiplicities</em> define how that data can be arranged. For example, multiplicities will say whether or not a field can be empty.</p>
<h2 id="singleton-fields"><a class="header" href="#singleton-fields">Singleton fields</a></h2>
<p>If you're declaring a field that is meant to hold a single value, and not something like a function, there are two possible multiplicities: <code>one</code> (which means that a value must always be present) and <code>lone</code> (which means that a value <em>may</em> be present). </p>
<ul>
<li><code>one</code>: a singleton value (this field always contains a single object); and</li>
<li><code>lone</code>: either a singleton value or no value (this field contains 0 or 1 object).</li>
</ul>
<div id="admonition-examples" class="admonition admonish-example">
<div class="admonition-title">
<p>Examples</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-examples"></a></p>
</div>
<div>
<p>This definition of a <code>Student</code> sig enforces that every student has an advisor, but not every student has a concentration.</p>
<pre><code>sig Student {
    advisor: one Faculty, 
    concentration: lone Concentration
}
</code></pre>
<p>If we later write constraints about students, it is possible for a student's concentration to evaluate to <code>none</code>.</p>
</div>
</div>
<h2 id="set-fields-relational-and-temporal-forge-only"><a class="header" href="#set-fields-relational-and-temporal-forge-only">Set fields (Relational and Temporal Forge only)</a></h2>
<p>If you're declaring a field that holds a set of atoms, use the <code>set</code> multiplicity.</p>
<div id="admonition-examples-1" class="admonition admonish-example">
<div class="admonition-title">
<p>Examples</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-examples-1"></a></p>
</div>
<div>
<p>Let's add a field for the friends a student has at Brown:</p>
<pre><code>sig Student {
    advisor: one Faculty, 
    concentration: lone Concentration,
    friends: set Student -- in reality, perhaps not only students!
}
</code></pre>
<p>A student's friends may evaluate to <code>none</code>, just as in the <code>lone</code> multiplicity. But it might also evaluate to set of more than one student.</p>
</div>
</div>
<div id="admonition-no-sets-in-froglet" class="admonition admonish-warning">
<div class="admonition-title">
<p>No sets in Froglet!</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-no-sets-in-froglet"></a></p>
</div>
<div>
<p>Froglet does not support the <code>set</code> multiplicity, because sets add a layer of complexity to the language. If you <em>really</em> need to model sets in Froglet, you an approximate them using boolean-valued functions (see below).</p>
</div>
</div>
<h2 id="function-fields"><a class="header" href="#function-fields">Function Fields</a></h2>
<p>If you want a field that is a function or partial function, use the <code>func</code> or <code>pfunc</code> multiplicities. (If you view singleton fields as functions that take no arguments, <code>func</code> and <code>pfunc</code> are analogous to <code>one</code> and <code>lone</code>.) These multiplicities only work if the field's type involves more than one sig. Suppose we are defining a function field meant to map elements of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> to elements of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span>. Then:</p>
<ul>
<li><code>func A -&gt; B -&gt; ... -&gt; Y -&gt; Z</code>: denotes a total function with the above domain and co-domain. Because it is a <em>total</em> function, every possible input must have exactly one output value.</li>
<li><code>pfunc A -&gt; B -&gt; ... -&gt; Y -&gt; Z</code>: denotes a partial function with the above domain and co-domain. Because the function may be partial, every possible input has either one output value or is not mapped by the function.</li>
</ul>
<div id="admonition-examples-2" class="admonition admonish-example">
<div class="admonition-title">
<p>Examples</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-examples-2"></a></p>
</div>
<div>
<p>Let's add a function that says what grade a student got in a given class. Because students don't take every course available, we might use a partial function for this:</p>
<pre><code>sig Student {
    advisor: one Faculty, 
    concentration: lone Concentration,
    grades: pfunc Course -&gt; Grade
}
</code></pre>
<p>If we later write constraints about students, it is possible for a student's grade in a particilar class to evaluate to <code>none</code>.</p>
</div>
</div>
<div id="admonition-intuition" class="admonition admonish-note">
<div class="admonition-title">
<p>Intuition</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-intuition"></a></p>
</div>
<div>
<p>Fields declared as <code>pfunc</code> are analogous to maps or dictionaries in an object-oriented programming language: some keys may not map to values, but if a key is mapped it is mapped to exactly one value. </p>
<p>Keep in mind that, unlike in (say) Java, the functions themselves are not objects on a heap, but rather just tables of values being mapped to other values.</p>
</div>
</div>
<h2 id="relation-fields-relational-and-temporal-forge-only"><a class="header" href="#relation-fields-relational-and-temporal-forge-only">Relation Fields (Relational and Temporal Forge only)</a></h2>
<p>If you want a field to represent an arbitrary <em>relation</em> that may or may not be a function, use the <code>set</code> multiplicity instead of <code>pfunc</code> or <code>func</code>.</p>
<div id="admonition-examples-3" class="admonition admonish-example">
<div class="admonition-title">
<p>Examples</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-examples-3"></a></p>
</div>
<div>
<p>Perhaps we want to keep track of the set of project partners a student had during a particular course:</p>
<pre><code>sig Student {
    advisor: one Faculty, 
    concentration: lone Concentration,
    partnersIn: set Course -&gt; Student
}
</code></pre>
<p>Now, for a given student, <code>partnersIn</code> might map to more than one student for a given class. Neither <code>func</code> nor <code>pfunc</code> would allow this.</p>
</div>
</div>
<div id="admonition-no-sets-in-froglet-1" class="admonition admonish-warning">
<div class="admonition-title">
<p>No sets in Froglet!</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-no-sets-in-froglet-1"></a></p>
</div>
<div>
<p>Froglet does not support the <code>set</code> multiplicity, because sets add a layer of complexity to the language. If you <em>really</em> need to model sets in Froglet, you an approximate them using boolean-valued functions (see below).</p>
</div>
</div>
<div id="admonition-approximating-sets-and-relations-in-froglet" class="admonition admonish-tip">
<div class="admonition-title">
<p>Approximating sets and relations in Froglet</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/multiplicity.html#admonition-approximating-sets-and-relations-in-froglet"></a></p>
</div>
<div>
<p>If you really need something like sets, but are working in Froglet, you can use the following trick.</p>
<pre><code>abstract sig Boolean {}
one sig True, False extends Boolean {}
sig Student {
    advisor: one Faculty, 
    concentration: lone Concentration,
    partnersIn: func (Course -&gt; Student) -&gt; Boolean
}
</code></pre>
<p>Alternatively, you can represent booleans <em>slightly</em> more efficiently as the presence (or non-presence) of a mapping in a partial function:</p>
<pre><code>one sig Yes {}
sig Student {
    advisor: one Faculty, 
    concentration: lone Concentration,
    partnersIn: pfunc (Course -&gt; Student) -&gt; Yes
}
</code></pre>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="advanced-material-how-do-sigs-and-fields-work"><a class="header" href="#advanced-material-how-do-sigs-and-fields-work">Advanced Material (How do sigs and fields work?)</a></h1>
<p>In case you're curious, we include a very brief sketch of how sigs, fields, etc. relate to Forge's core solver engine. This information might be useful when debugging a tough problem or just for understanding the tool better.</p>
<div id="admonition-froglet" class="admonition admonish-warning">
<div class="admonition-title">
<p>Froglet</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/advanced.html#admonition-froglet"></a></p>
</div>
<div>
<p>If you are currently working in Froglet, you may see terms in this document that you aren't yet familiar with.</p>
</div>
</div>
<p>Forge's solver engine works entirely in terms of <em>sets</em>, regardless of which Forge language you are using. Each <code>sig</code> name corresponds to the set of atoms of that type in a given instance. Similarly, each field name <code>f</code> corresponds to a relation (set) with arity <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span>. (The extra column in the relation holds the atom the field value belongs to.) </p>
<div id="admonition-arity" class="admonition admonish-note">
<div class="admonition-title">
<p>Arity</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/advanced.html#admonition-arity"></a></p>
</div>
<div>
<p>The <em>arity</em> of a set is how many elements its member tuples contain. E.g., a set of atoms would have arity 1, but a set of pairs of atoms would have arity 2.</p>
</div>
</div>
<p>E.g.,</p>
<pre><code>sig B {}
sig A {
    myField: set A -&gt; B
}
</code></pre>
<p>is internally represented as a pair of sets <code>A</code> and <code>B</code> and a 3-ary relation named <code>myField</code> that must be a subset of <code>A -&gt; A -&gt; B</code> in any instance. </p>
<h2 id="the-role-of-bounds"><a class="header" href="#the-role-of-bounds">The role of bounds</a></h2>
<p>Because every <code>run</code> is always equipped with a finite bound on every sig, the solver is then able to convert Forge constraints to a purely boolean logic problem, where every <em>possible</em> membership in each set is assigned a unique boolean variable. </p>
<div id="admonition-compiling-a-forge-problem" class="admonition admonish-example">
<div class="admonition-title">
<p>Compiling a Forge problem</p>
<p><a class="admonition-anchor-link" href="building-models/sigs/advanced.html#admonition-compiling-a-forge-problem"></a></p>
</div>
<div>
<pre><code class="language-clike">#lang forge
sig Person {
    bestFriend: one Person
}
run {
    all p: Person | { 
        some disj p1, p2: Person | {
            p1.bestFriend = p 
            p2.bestFriend = p
        }
    }
} for exactly 4 Person
</code></pre>
<p>This model defines two sets: </p>
<ul>
<li><code>Person</code>, of arity 1; and</li>
<li><code>bestFriend</code>, of arity 2.</li>
</ul>
<p>Since there are exactly 4 people allowed by the <code>run</code>, the contents of <code>Person</code> is fixed. But <code>bestFriend</code> may contain any pair of <code>Person</code> objects. There are <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span></span></span></span> possible pairs, and so there are 16 boolean variables needed to define the <code>bestFriend</code> field.</p>
<p>You can see these reflected in the <em>primary variable</em> portion of the statistical output Forge gives when running this file:</p>
<pre><code>#vars: (size-variables 178); #primary: (size-primary 16); #clauses: (size-clauses 311)
</code></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="constraints"><a class="header" href="#constraints">Constraints</a></h1>
<p>Once the model has defined the kinds of objects it deals with, it defines <em>constraints</em> that limit how those objects can behave.</p>
<h2 id="rules-vs-instructions"><a class="header" href="#rules-vs-instructions">Rules vs. Instructions</a></h2>
<p>This idea of a <em>constraint</em> is key in Forge (and in many other modeling languages), and it's very different from programming in a language like Java, Pyret, or Python.</p>
<p>When you're programming traditionally, you give the computer a set of instructions and it follows those instructions. This is true whether you're programming functionally or imperatively, with or without objects, etc. In contrast, modeling languages like Forge work differently. The goal of a Forge model isn't to <em>run instructions</em>, but rather to <em>express the rules</em> that govern systems.</p>
<p>Here's a useful comparison to help reinforce the difference (with thanks to Daniel Jackson):</p>
<ul>
<li>Given a lack of <strong>instructions</strong>, a program <em>does</em> nothing.</li>
<li>Given a lack of <strong>constraints</strong>, a model <em>allows</em> everything.</li>
</ul>
<h2 id="example-concentration-requirements"><a class="header" href="#example-concentration-requirements">Example: Concentration Requirements</a></h2>
<p>Let's get concrete. <a href="https://cs.brown.edu/degrees/undergrad/concentrating-in-cs/concentration-requirements-2020/new-ab-requirements/">The concentration requirements for an A.B. in CSCI</a> state that to get an A.B., a student must (among other things) complete a pathway, which comprises two upper-level courses. We might rewrite this as:</p>
<blockquote>
<p>&quot;Every student who gets an A.B. must have passed two 1000-level courses in the same pathway.&quot;</p>
</blockquote>
<p>If we're modeling concentration requirements, we might decide to create <code>sig</code>s for <code>Student</code>, <code>Course</code>, <code>Pathway</code>, and so on, with fields you'd expect. For example, we might create:</p>
<pre><code>sig Student {
  -- dictionary of grades for courses taken and passed
  grades: pfunc Course -&gt; Grade
}
</code></pre>
<p>But this only describes the shape of the data, not the concentration requirements themselves! To do that, we need to create some constraints. The sentence above states a requirement for <em>every student</em>. Generally the department follows this rule. But it's possible to imagine some semester where the department makes a mistake, and gives an A.B. degrees to someone who hadn't actually finished a pathway. The sentence is something that could be true or false in any given semester:</p>
<blockquote>
<p>&quot;<span style="color:cyan">Every student</span> who gets an A.B. must have passed two 1000-level courses in the same pathway.&quot;</p>
</blockquote>
<p>In Forge, we'd write this for-all using a quantifier: </p>
<pre><code><span style="color:cyan">all s: Student</span> | ...
</code></pre>
<p>Then we have a condition that triggers a requirement: <em>if</em> a student has gotten an A.B., then something is required. In Forge, this becomes an implication inside the quantifier: </p>
<pre><code>all s: Student | s.degreeGranted = AB implies {...}
</code></pre>
<p>Let's look more closely at the part we wrote: <code>s.degreeGranted = AB</code>. For a given student, that is also either true or false. But something important is different inside the <code>=</code>: <code>s.degreeGranted</code> doesn't denote a boolean, but rather an <em>atom</em> in some instance (which will perhaps be equal to <code>AB</code>). These are very different kinds of syntax. A similar thing is true for <code>s</code>, <code>course1</code>, and <code>course2</code>. Let's finish writing the constraint and then color-code the different parts:</p>
<pre><code><span style="color:green">all <span style="color:red">s</span>: <span style="color:red">Student</span> |</span> <span style="color:red">s.degreeGranted</span> <span style="color:green">=</span> <span style="color:red">AB</span> <span style="color:green">implies { 
  some disj <span style="color:red">course1</span>, <span style="color:red">course2</span>: <span style="color:red">Course</span> |</span> <span style="color:red">course1.pathway</span> <span style="color:green">=</span> <span style="color:red">course2.pathway</span>
<span style="color:green">}</span>
</code>
</pre>
<p>The <span style="color:green">green</span> syntax is about whether something is true or false. The <span style="color:red">red</span> syntax is about identifying specific atoms in an instance. By using both kinds of syntax, you can express constraints about the shape of instances. </p>
<ul>
<li>without <span style="color:green">boolean-valued syntax</span>, you couldn't express implications, &quot;or&quot;, &quot;and&quot;, etc.</li>
<li>without <span style="color:red">atom-valued syntax</span>, you could only talk about abstract boolean values, not actual atoms in the world.</li>
</ul>
<h3 id="writing-constraints-formulas-vs-expressions"><a class="header" href="#writing-constraints-formulas-vs-expressions">Writing Constraints: Formulas vs. Expressions</a></h3>
<p>The top-level constraints that Forge works with must always evaluate to booleans, but the inner workings of constraints can speak about specific objects, the values of their fields, and so on. We'll make the distinction between these two different kinds of syntax:</p>
<ul>
<li><span style="color:green"><em>Formulas</em></span> always evaluate to booleans---i.e., either true or false; and</li>
<li><span style="color:red"><em>Expressions</em></span> always evaluate to objects or sets of objects. </li>
</ul>
<div id="admonition-forge-isnt-truthy" class="admonition admonish-warning">
<div class="admonition-title">
<p>Forge isn't 'truthy'</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/constraints.html#admonition-forge-isnt-truthy"></a></p>
</div>
<div>
<p>Unlike what would happen in a programming language like JavaScript or Python, attempting to use an expression in place of a formula, or vice versa, will produce an error in Forge when you try to run your model. For example, if we wrote the constraint <code>all s: Student | s.grades</code>, what would that mean? That every <code>s</code> exists? That every <code>s</code> has passed some class? Something different? To avoid this ambiguity, Forge doesn't try to infer your meaning, and just gives an error. </p>
<p><strong>Always ask, for every word you write: are you writing about what must be true, or naming some atom or set of atoms?</strong></p>
</div>
</div>
<h3 id="context-for-evaluating-constraints-instances"><a class="header" href="#context-for-evaluating-constraints-instances">Context for Evaluating Constraints: Instances</a></h3>
<p>Notice that there's always a context that helps us decide whether a constraint yields true or false. In the above example, the context is a collection of students, courses taken and degrees granted. For some other model, it might be a tic-tac-toe board, a run of a distributed system, a game of baseball, etc. We'll call these  <em>instances</em>. An instance contains:</p>
<ul>
<li>a set of atoms for each <code>sig</code> definition (the objects of that type in the world); and </li>
<li>a concrete function (or partial function) for each field of the appropriate type. 
Together, these give the context that makes it possible to tell whether constraints have been satisfied or not. </li>
</ul>
<div id="admonition-relational-forge" class="admonition admonish-note">
<div class="admonition-title">
<p>Relational Forge</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/constraints.html#admonition-relational-forge"></a></p>
</div>
<div>
<p>Once you move from Froglet to Relational Forge, the value of a field might be an arbitrary relation, and not a function.</p>
</div>
</div>
<hr />
<!--
_TODO: BEFORE TALKING ABOUT IMPL DETAILS OF CONSTRAINTS IN FORGE, LET'S TALK ABOUT HOW CONSTRAINTS PLAY INTO BUILDING MODELS BY LOOKING AT AN EXAMPLE_ -->
<!-- Let's bring back the [linked list](../../building-models/sigs/sigs.md#admonition-example-sig-w-one-field) example we saw when learning about sigs:

```
sig Node {
    next: one Node
}
```

If the point of modeling linked-lists is to learn things about the linked-list systems, we have to -->
<!--
![LinkedList-Normal](../../../images/constraints/LinkedList-normal.png)
![LL-Weird-A](../../images/constraints/LinkedList-weird-A.png) -->
<!-- ![Linked-List-Weird-B](../../images/constraints/LinkedList-weird-B.png)

Let's look at the example we first introduced when discussing sigs, [a linked list](../../building-models/sigs/sigs.md#admonition-example-sig-w-one-field)

We _constrain_ the acceptable outputs of the model by defining more rules and being more specific about the constraints of the model. In general, the more rules we add, the fewer acceptable outputs.

a model with a lack of rules just means that you are allowing lots of things to be acceptable instances of the model!

Forge will by default try and give you all possible instances -->
<!-- In Forge, the computer already has a set of instructions: construct instances of the model based on how you defined the "things" and "rules" of the model. -->
<h2 id="next-steps-1"><a class="header" href="#next-steps-1">Next Steps</a></h2>
<p>The next sections describe <a href="building-models/constraints/./formulas/formulas.html">formula</a> and <a href="building-models/constraints/./expressions/expressions.html">expression</a> syntax in more detail. A reader familiar with this syntax is free to skip to the section on <a href="building-models/constraints/./instances.html">instances</a>, or progress to <a href="building-models/constraints/../../running-models/running.html">running models</a> in Forge.</p>
<div id="admonition-temporal-forge" class="admonition admonish-info">
<div class="admonition-title">
<p>Temporal Forge</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/constraints.html#admonition-temporal-forge"></a></p>
</div>
<div>
<p>For more information on <em>temporal</em> operators, which are only supported in Relational Forge, see the page on <a href="building-models/constraints/../../electrum/electrum-overview.html">Temporal Mode</a>. We maintain these in separate chapter because the meaning of constraints in this mode can differ subtly.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="instances-1"><a class="header" href="#instances-1">Instances</a></h1>
<h2 id="intuition"><a class="header" href="#intuition">Intuition</a></h2>
<p>Forge <em>instances</em> give the context in which constraints are evaluated. E.g., an instance might describe:</p>
<ul>
<li>Tim's family tree, going back 3 generations;</li>
<li>CSCI courses offered at Brown this semester, with information on who teaches each;</li>
<li>the current state of a chessboard;</li>
<li>an entire game of tic-tac-toe;</li>
<li>etc.
What an instance contains depends on the current model. Family-tree instances would make sense if the model had defined people, a parenthood relationship, etc.---but not if it was about the game of chess!</li>
</ul>
<p>An instance gives concrete values for <code>sig</code>s and their fields. It says which atoms actually exist in the world, and what their fields contain. This is what gives constraints their meaning. We could write a model of tic-tac-toe in Forge, but statements like &quot;some player has won the game&quot; is neither true nor false by itself---<strong>it depends on the instance</strong>. </p>
<p>The remainder of this page defines instances more formally.</p>
<div id="admonition-warning" class="admonition admonish-warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/instances.html#admonition-warning"></a></p>
</div>
<div>
<p>If you are working in Froglet, the remainder of this page may reference terms you are as yet unfamiliar with. Don't worry; this will be covered more in class. Informally, you might read &quot;relation&quot; as &quot;function&quot;.</p>
<pre><code>
&lt;/div&gt;
&lt;/div&gt;

## Formal Definition of Instances

Because `sig` definitions can involve concepts like inheritance, partial functions, and uniqueness, the precise definition is a bit involved.

Consider an arbitrary Forge model $M$ that defines some `sig`s and fields.

An _instance_ is a collection of finite sets for each `sig` and field in the model. For each `sig S` in the model, an instance contains a set $S$ where:
  - if `S` has a parent `sig P`, then the contents of $S$ must be a subset of the contents of $P$;
  - for any pair of child-sigs of `S`, `C1` and `C2`, $C_1$ and $C_2$ have no elements in common; 
  - if `S` is declared `abstract` and has child sigs, then any object in $S$ must also be present in $C$ for some `sig C` that extends `sig S`; and
  - if `S` is declared `one` or `lone`, then $S$ contains exactly one or at most one object, respectively.

For each field `f` of type `S1 -&gt; ... -&gt; Sn` of `sig S` in the model, an instance contains a set $f$ where:
  - $f$ is subset of the cross product $S\times S_1 \times ... \times S_N$;
  - if `f` is declared `one` or `lone`, then $f$ can only contain exactly one or at most one object, respectively;
  - if `f` is declared `func`, then there is exactly one entry in $f$ for each $(s, s_1, ..., s_{n-1})$ in $S\times S_1 \times ... \times S_{(n-1)}$.
  - if `f` is declared `pfunc`, then there is at most one entry in $f$ for each $(s, s_1, ..., s_{n-1})$ in $S\times S_1 \times ... \times S_{(n-1)}$.

The union over all `sig`-sets $S$ in an instance (including the built-in sig `Int`) is said to be the _universe_ of that instance.


&lt;div id=&quot;admonition-fields-are-not-objects&quot; class=&quot;admonition admonish-tip&quot;&gt;
&lt;div class=&quot;admonition-title&quot;&gt;

Fields are not objects

&lt;a class=&quot;admonition-anchor-link&quot; href=&quot;#admonition-fields-are-not-objects&quot;&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;

It is sometimes useful to use terminology from object-oriented programming to think about Forge models. For example, we can think of a `pfunc` field like a dictionary in Python or a map in Java. However, _a field is not an object_. This matters for at least two reasons:
- We can't write a constraint like &quot;every `pfunc` field in the model is non-empty&quot;, because there's no set of `pfunc` &quot;objects&quot; to examine.
- Two different objects in an instance will be considered non-equal in Forge, even if they belong to the same `sig` and have identical field contents. In contrast, two fields themselves are equal in Forge if they have identical contents; fields are relations that involve atoms, not objects themselves.

&lt;/div&gt;
&lt;/div&gt;
  

&lt;div id=&quot;admonition-tuples-arity&quot; class=&quot;admonition admonish-info&quot;&gt;
&lt;div class=&quot;admonition-title&quot;&gt;

Tuples, Arity

&lt;a class=&quot;admonition-anchor-link&quot; href=&quot;#admonition-tuples-arity&quot;&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;

An ordered list of elements is called a _tuple_, and we'll sometimes use that term to refer to elements of the `sig` and field sets in an instance. The number of elements in a tuple is called its _arity_. Since any single `sig` or field set will contain tuples with the same arity, we can safely talk about the arity of these sets as well. E.g., in the above definition, a field `f` of type `S1 -&gt; ... -&gt; Sn` in `sig S` would always correspond to a set with arity $n+1$.

&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="formulas"><a class="header" href="#formulas">Formulas</a></h1>
<p><em>Formulas</em> are a type of Forge syntax. Given an instance, every formula evaluates to a boolean value. If the formula is true of an instance, we say that the instance <em>satisfies</em> the formula.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="formula-combining-operators"><a class="header" href="#formula-combining-operators">Formula-Combining Operators</a></h1>
<p>Formula operators combine smaller formulas to produce new formulas. Many closely resemble similar operators from programming languages, like <code>&amp;&amp;</code>, <code>||</code>, and <code>!</code>.</p>
<h2 id="list-of-available-operators"><a class="header" href="#list-of-available-operators">List of Available Operators:</a></h2>
<p>For the following <code>&lt;fmla&gt;</code> means an arbitrary formula.</p>
<ul>
<li>Negation: <a href="building-models/constraints/formulas/./operators.html#not"><code>not (!)</code></a></li>
<li>Conjunction: <a href="building-models/constraints/formulas/./operators.html#and"><code>and (&amp;&amp;)</code></a></li>
<li>Disjunction: <a href="building-models/constraints/formulas/./operators.html#or"><code>or (||)</code></a></li>
<li>Implication: <a href="building-models/constraints/formulas/./operators.html#implies"><code>implies (=&gt;)</code></a>
<ul>
<li>If-then-else: <a href="building-models/constraints/formulas/./operators.html#implies-else"><code>else</code></a></li>
</ul>
</li>
<li>If-and-only-if: <a href="building-models/constraints/formulas/./operators.html#iff"><code>iff (&lt;=&gt;)</code></a></li>
</ul>
<div id="admonition-alternative-syntax" class="admonition admonish-note">
<div class="admonition-title">
<p>Alternative syntax</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-alternative-syntax"></a></p>
</div>
<div>
<p>Some operators have alternative syntax (marked by <strong><em>alt</em></strong>) which are equivalent. Use whichever is most natural and convenient to you.</p>
</div>
</div>
<hr />
<h2 id="not-alt-"><a class="header" href="#not-alt-"><code>not</code> (<em>alt:</em> <code>!</code>)</a></h2>
<blockquote>
<p><code>not &lt;fmla&gt;</code></p>
<p><code>! &lt;fmla&gt;</code></p>
</blockquote>
<p><strong>true</strong> when <code>&lt;fmla&gt;</code> evaluates to <strong>false</strong></p>
<div id="admonition-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-example"></a></p>
</div>
<div>
<p>If <code>some p.spouse</code> is true when the person <code>p</code> is married, <code>not (some p.spouse)</code> denotes the opposite, being true whenever <code>p</code> is <em>not</em> married.</p>
</div>
</div>
<hr />
<h2 id="and-alt-"><a class="header" href="#and-alt-"><code>and</code> (<em>alt:</em> <code>&amp;&amp;</code>)</a></h2>
<blockquote>
<p><code>&lt;fmla-a&gt; and &lt;fmla-b&gt;</code></p>
<p><code>&lt;fmla-a&gt; &amp;&amp; &lt;fmla-b&gt;</code></p>
</blockquote>
<p><strong>true</strong> when both <code>&lt;fmla-a&gt;</code> and <code>&lt;fmla-b&gt;</code> evaluate to <strong>true</strong>.</p>
<div id="admonition-example-1" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-example-1"></a></p>
</div>
<div>
<p>If <code>some p.spouse</code> is true when the person <code>p</code> is married, and <code>p.spouse != p</code> is true when <code>p</code> is not married to themselves, then <code>some p.spouse and p.spouse != p</code> is true exactly when <code>p</code> is married, but not to themselves.</p>
</div>
</div>
<div id="admonition-implicit-and" class="admonition admonish-note">
<div class="admonition-title">
<p>Implicit and</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-implicit-and"></a></p>
</div>
<div>
<p>Forge treats consecutive formulas within <code>{ ... }</code> as implicitly combined using <code>and</code>. For instance, the above example could also be written as:</p>
<pre><code>{
  some p.spouse
  p.spouse != p
}
</code></pre>
</div>
</div>
<hr />
<h2 id="or-alt-"><a class="header" href="#or-alt-"><code>or</code> (<em>alt:</em> <code>||</code>)</a></h2>
<blockquote>
<p><code>&lt;fmla-a&gt; or &lt;fmla-b&gt;</code></p>
<p><code>&lt;fmla-a&gt; || &lt;fmla-b&gt;</code></p>
</blockquote>
<p><strong>true</strong> when either <code>&lt;fmla-a&gt;</code> is <strong>true</strong> or <code>&lt;fmla-b&gt;</code> evaluates to <strong>true</strong>.</p>
<div id="admonition-example-2" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-example-2"></a></p>
</div>
<div>
<p>If <code>some p.spouse</code> is true when the person <code>p</code> is married, and <code>p.spouse != p</code> is true when <code>p</code> is not married to themselves, then <code>some p.spouse or p.spouse != p</code> is true exactly when <code>p</code> is <em>either</em>:</p>
<ul>
<li>married; or </li>
<li>not married to themselves (including the case where <code>p</code> is unmarried).</li>
</ul>
</div>
</div>
<hr />
<h2 id="implies-alt-"><a class="header" href="#implies-alt-"><code>implies</code> (<em>alt</em> <code>=&gt;</code>)</a></h2>
<blockquote>
<p><code>&lt;fmla-a&gt; implies &lt;fmla-b&gt;</code></p>
<p><code>&lt;fmla-a&gt; =&gt; &lt;fmla-b&gt;</code></p>
</blockquote>
<p><strong>true</strong> when either <code>&lt;fmla-a&gt;</code> evaluates to <strong>false</strong> or <code>&lt;fmla-b&gt;</code> evaluates to <strong>true</strong>.</p>
<div id="admonition-example-3" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-example-3"></a></p>
</div>
<div>
<p>If <code>some p.spouse</code> is true when the person <code>p</code> is married, and <code>p.spouse != p</code> is true when <code>p</code> is not married to themselves, then <code>some p.spouse implies p.spouse != p</code> is true exactly when <code>p</code> is <em>either</em>:</p>
<ul>
<li>unmarried; or </li>
<li>not married to themselves.</li>
</ul>
</div>
</div>
<hr />
<h3 id="implies-else-alt--else"><a class="header" href="#implies-else-alt--else"><code>implies else</code> (<em>alt:</em> <code>=&gt; else</code>)</a></h3>
<blockquote>
<p><code>{&lt;fmla-a&gt; implies &lt;fmla-b&gt; else &lt;fmla-c&gt;}</code></p>
<p><code>{&lt;fmla-a&gt; =&gt; &lt;fmla-b&gt; else &lt;fmla-c&gt;}</code></p>
</blockquote>
<p>takes the value of <code>&lt;fmla-b&gt;</code> when <code>&lt;fmla-a&gt;</code> evaluates to <strong>true</strong>, and takes the value of <code>&lt;fmla-c&gt;</code> otherwise.</p>
<div id="admonition-example-4" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-example-4"></a></p>
</div>
<div>
<p>If:</p>
<ul>
<li><code>some p.spouse</code> is true when the person <code>p</code> is married, </li>
<li><code>p.spouse != p</code> is true when <code>p</code> is not married to themselves, and</li>
<li><code>some p.parent1</code> is true when <code>p</code> has a <code>parent1</code> in the instance, </li>
</ul>
<p>then <code>some p.spouse =&gt; p.spouse != p else some p.parent1</code> is true exactly when:</p>
<ul>
<li><code>p</code> is married, and not to themselves; or</li>
<li><code>p</code> is not married and have a <code>parent1</code> in the instance.</li>
</ul>
</div>
</div>
<hr />
<h2 id="iff-alt-"><a class="header" href="#iff-alt-"><code>iff</code> (<em>alt:</em> <code>&lt;=&gt;</code>)</a></h2>
<blockquote>
<p><code>&lt;fmla-a&gt; iff &lt;fmla-b&gt;</code></p>
<p><code>&lt;fmla-a&gt; &lt;=&gt; &lt;fmla-b&gt;</code></p>
</blockquote>
<p>true when <code>&lt;fmla-a&gt;</code> evaluates to <strong>true</strong> exactly when <code>&lt;fmla-b&gt;</code> evaluates to <strong>true</strong>.</p>
<div id="admonition-iff" class="admonition admonish-note">
<div class="admonition-title">
<p>IFF</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-iff"></a></p>
</div>
<div>
<p>The term <code>iff</code> is short for &quot;if and only if&quot;.</p>
</div>
</div>
<div id="admonition-example-5" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/operators.html#admonition-example-5"></a></p>
</div>
<div>
<p>If <code>some p.spouse</code> is true when the person <code>p</code> is married, and <code>some p.parent1</code> is true when <code>p</code> has a <code>parent1</code> in the instance, then <code>some p.spouse iff some p.parent1</code> is true exactly when <em>either</em>:</p>
<ul>
<li><code>p</code> is married and has a <code>parent1</code> in the instance; or </li>
<li><code>p</code> is unmarried has no <code>parent1</code> in the instance.</li>
</ul>
</div>
</div>
<hr />
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="cardinality-and-membership"><a class="header" href="#cardinality-and-membership">Cardinality and Membership</a></h1>
<p>The following operators produce formulas from smaller expression arguments:</p>
<ul>
<li><code>no &lt;expr&gt;</code>: true when <code>&lt;expr&gt;</code> is <strong>empty</strong></li>
<li><code>lone &lt;expr&gt;</code>: true when <code>&lt;expr&gt;</code> contains <strong>zero or one</strong> elements</li>
<li><code>one &lt;expr&gt;</code>: true when <code>&lt;expr&gt;</code> contains <strong>exactly one</strong> element</li>
<li><code>some &lt;expr&gt;</code>: true when <code>&lt;expr&gt;</code> contains <strong>at least one</strong> element</li>
<li><code>&lt;expr-a&gt; in &lt;expr-b&gt;</code>: true when <code>&lt;expr-a&gt;</code> is a <strong>subset</strong> of or equal to <code>&lt;expr-b&gt;</code></li>
<li><code>&lt;expr-a&gt; = &lt;expr-b&gt;</code>: true when <code>&lt;expr-a&gt;</code> and <code>&lt;expr-b&gt;</code> contain exactly the <strong>same elements</strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="quantifiers"><a class="header" href="#quantifiers">Quantifiers</a></h1>
<p>In the following, <code>&lt;x&gt;</code> is a variable, <code>&lt;expr&gt;</code> is an expression of arity 1, and <code>&lt;fmla&gt;</code> is a formula (that can use the variable <code>&lt;x&gt;</code>). You can quantify over a unary set in the following ways:</p>
<ul>
<li><code>some &lt;x&gt;: &lt;expr&gt; | { &lt;fmla&gt; }</code>: true when <code>&lt;fmla&gt;</code> is true for at least one element in <code>&lt;expr&gt;</code>; and</li>
<li><code>all &lt;x&gt;: &lt;expr&gt; | { &lt;fmla&gt; }</code>: true when <code>&lt;fmla&gt;</code> is true for all elements in <code>&lt;expr&gt;</code></li>
</ul>
<p>If you want to quantify over several variables, you can also do the following:</p>
<ul>
<li><code>some &lt;x&gt;: &lt;expr-a&gt;, &lt;y&gt;: &lt;expr-b&gt; | { &lt;fmla&gt; }</code>; or</li>
<li><code>some &lt;x&gt;, &lt;y&gt;: &lt;expr&gt; | { &lt;fmla&gt; }</code>.</li>
</ul>
<p>The syntax is the same for other quantifiers, such as <code>all</code>.</p>
<h2 id="complex-quantifiers"><a class="header" href="#complex-quantifiers">Complex Quantifiers</a></h2>
<p>Forge also provides 3 additional quantifiers, which encode somewhat richer constraints than the above:</p>
<ul>
<li><code>no &lt;x&gt;: &lt;expr&gt; | { &lt;fmla&gt; }</code>: true when <code>&lt;fmla&gt;</code> is false for all elements in <code>&lt;expr&gt;</code></li>
<li><code>lone &lt;x&gt;: &lt;expr&gt; | { &lt;fmla&gt; }</code>: true when <code>&lt;fmla&gt;</code> is true for zero or one elements in <code>&lt;expr&gt;</code></li>
<li><code>one &lt;x&gt;: &lt;expr&gt; | { &lt;fmla&gt; }</code>: true when <code>&lt;fmla&gt;</code> is true for exactly one element in <code>&lt;expr&gt;</code></li>
</ul>
<p><strong>The above 3 quantifiers (<code>no</code>, <code>lone</code>, and <code>one</code>) should be used carefully.</strong> Because they invisibly encode extra constraints, they do not commute the same way <code>some</code> and <code>all</code> quantifiers do. E.g., <code>some x : A | some y : A | myPred[x,y]</code> is always equivalent to <code>some y : A | some x : A | myPred[x,y]</code>, but <code>one x : A | one y : A | myPred[x,y]</code> is <strong>NOT</strong> always equivalent to <code>one y : A | one x : A | myPred[x,y]</code>. (Why not? Try it out in Forge!)</p>
<div id="admonition-warning" class="admonition admonish-warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/formulas/quantifiers.html#admonition-warning"></a></p>
</div>
<div>
<p>Beware combining the <code>no</code>, <code>one</code>, and <code>lone</code> quantifiers with multiple variables at once; the meaning of, e.g., <code>one x, y: A | ...</code> is &quot;there exists a <strong>unique pair</strong> <code>&lt;x, y&gt;</code> such that <code>...</code>&quot;. This is different from the meaning of <code>one x: A | one y: A | ...</code>, which is &quot;there is a unique <code>x</code> such that there is a unique <code>y</code> such that ...&quot;.</p>
</div>
</div>
<h2 id="quantifying-over-disjoint-objects"><a class="header" href="#quantifying-over-disjoint-objects">Quantifying Over Disjoint Objects</a></h2>
<p>Sometimes, it might be useful to try to quantify over all pairs of elements in <code>A</code>, where the two in the pair are distinct atoms. You can do that using the <code>disj</code> keyword, e.g.:</p>
<ul>
<li><code>some disj x, y : A | ...</code> (adds an implicit <code>x != y and ...</code>); and</li>
<li><code>all disj x, y : A | ...</code> (adds an implicit <code>x != y implies ...</code>)`</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="predicates"><a class="header" href="#predicates">Predicates</a></h1>
<p>If you have a set of constraints that you use often, or that you'd like to give a name to, you can define a <em>predicate</em> using the <code>pred</code> keyword. A predicate has the following form:</p>
<pre><code>pred &lt;pred-name&gt; {
   &lt;fmla-1&gt;
   &lt;fmla-2&gt;
   ...
   &lt;fmla-n&gt;
}
</code></pre>
<p>Newlines between formulas in a <code>pred</code> will be combined implicitly with <code>and</code>s, helping keep your predicates uncluttered. Predicates can also be defined with arguments, which will be evaluated via substitution. For instance, in a family-tree model, you could create:</p>
<pre><code>pred parentOrChildOf[p1, p2: Person] {
  p2 = p1.parent1 or
  p2 = p1.parent2 or
  p1 = p2.parent1 or
  p1 = p2.parent1
}
</code></pre>
<p>and then write something like <code>some p : Person | parentOrChildOf[Tim, p]</code>. Predicates may be used like this anywhere a formula can appear.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="expressions"><a class="header" href="#expressions">Expressions</a></h1>
<p>Given an instance, <em>expressions</em> in Forge evaluate to sets of atoms. </p>
<h2 id="froglet"><a class="header" href="#froglet">Froglet</a></h2>
<p>In Froglet, expressions must always denote a single atom or the empty set (<code>none</code>). This matches the abstraction where fields are always either total (<code>one</code>, <code>func</code>) or partial (<code>lone</code>, <code>pfunc</code>) functions.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="relational-operators"><a class="header" href="#relational-operators">Relational Operators</a></h1>
<p><em>Relational Operators</em> produce expressions (not formulas) from other expressions. </p>
<div id="admonition-froglet" class="admonition admonish-note">
<div class="admonition-title">
<p>Froglet</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-froglet"></a></p>
</div>
<div>
<p>If you are using Froglet, not all of these operators are available.</p>
</div>
</div>
<div id="admonition-relational-forge" class="admonition admonish-warning">
<div class="admonition-title">
<p>Relational Forge</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-relational-forge"></a></p>
</div>
<div>
<p>Recall that Forge treats every field of a sig as a relation of arity 1 higher than the arity of the field itself, with the object the field belongs to as the added left-most column. E.g., in this sig definition:</p>
<pre><code>sig City {
    roads: set City
}
</code></pre>
<p>the relation <code>roads</code> is an arity-2 set which contains ordered pairs of <code>City</code> objects.</p>
<p>This is what allows the dot operator in Forge to act as if it is field access when it is actually a <a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#-join">relational join</a>.</p>
</div>
</div>
<h3 id="list-of-relational-expression-operators"><a class="header" href="#list-of-relational-expression-operators">List of Relational Expression Operators:</a></h3>
<ul>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#-union"><code>+ (union)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#--set-difference"><code>- (set difference)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#intersection"><code>&amp; (intersection)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#-and--relational-join"><code>.  [] (relational join)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#--cross-product"><code>-&gt; (cross product)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#-transpose"><code>~ (transpose)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#-transitive-closure"><code>^ (transitive closure)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#-reflexive-transitive-closure"><code>* (reflexive transitive closure)</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#if-then-else"><code>=&gt; else</code></a></li>
<li><a href="building-models/constraints/expressions/relational-expressions/./relational-expressions.html#set-comprehension"><code>set comprehension</code></a></li>
</ul>
<!-- (Unlike [Formula Operators](../../formulas/operators.md), the parentheticals are _not alternative syntax_. They are the mathematical names) -->
<hr />
<h2 id="-union"><a class="header" href="#-union"><code>+ (union)</code></a></h2>
<blockquote>
<p><code>&lt;expr-a&gt; + &lt;expr-b&gt;</code></p>
</blockquote>
<p>returns the <strong>union</strong> of the two exprs, i.e., the set containing all elements that are in either of the two exprs.</p>
<div id="admonition-union" class="admonition admonish-example">
<div class="admonition-title">
<p>Union</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-union"></a></p>
</div>
<div>
<p>The set of employees who work at Brown CS include both faculty and staff:</p>
<pre><code>BrownCS.employees = BrownCS.faculty + BrownCS.staff
</code></pre>
</div>
</div>
<hr />
<h2 id="--set-difference"><a class="header" href="#--set-difference"><code>- (set difference)</code></a></h2>
<blockquote>
<p><code>&lt;expr-a&gt; - &lt;expr-b&gt;</code></p>
</blockquote>
<p>returns the <strong>set difference</strong> of the two exprs, i.e., everything in <code>expr-a</code> that is <strong>not</strong> also in <code>expr-b</code>.</p>
<div id="admonition-difference" class="admonition admonish-example">
<div class="admonition-title">
<p>Difference</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-difference"></a></p>
</div>
<div>
<p>The set of students eligible to UTA includes all students except those who are already hired as head TAs:</p>
<pre><code>BrownCS.utaCandidates = Student - BrownCS.htaHires
</code></pre>
</div>
</div>
<hr />
<h2 id="intersection"><a class="header" href="#intersection"><code>&amp; (intersection)</code></a></h2>
<blockquote>
<p><code>&lt;expr-a&gt; &amp; &lt;expr-b&gt;</code></p>
</blockquote>
<p>returns the <strong>intersection</strong> of the two exprs, i.e., all elements in both <code>expr-a</code> and <code>expr-b</code>.</p>
<div id="admonition-intersection" class="admonition admonish-example">
<div class="admonition-title">
<p>Intersection</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-intersection"></a></p>
</div>
<div>
<p>Students in the &quot;AI/ML&quot; pathway must take multiple intermediate courses. In this (oversimplified) example, students can use the AI/ML pathway if they've taken both linear algebra and probability:</p>
<pre><code>BrownCS.canUseAIML = BrownCS.tookLinearAlgebra &amp; BrownCS.tookProbability 
</code></pre>
</div>
</div>
<hr />
<h2 id="--cross-product"><a class="header" href="#--cross-product"><code>-&gt; (cross product)</code></a></h2>
<blockquote>
<p><code>&lt;expr-a&gt; -&gt; &lt;expr-b&gt;</code></p>
</blockquote>
<p>returns the <strong>cross product</strong> of the two exprs. </p>
<div id="admonition-product-example-1" class="admonition admonish-example">
<div class="admonition-title">
<p>Product (example 1)</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-product-example-1"></a></p>
</div>
<div>
<p>If <code>roads</code> is a binary relation between <code>City</code> and itself, and <code>Providence</code> and <code>Pawtucket</code> are cities:</p>
<pre><code>sig City {
    roads: set City
}
one sig Providence, Pawtucket extends City {}
</code></pre>
<p>then <code>Providence -&gt; Pawtucket</code> is an arity-2, one-element set, which can be used with other operators. E.g.,  <code>roads + (Providence -&gt; Pawtucket)</code> represents the set of roads augmented with a new road (if it wasn't already there). </p>
<p>Likewise, <code>City -&gt; City</code> will produce an arity-2 set containing every possible pair-wise combination of cities.</p>
</div>
</div>
<hr />
<h2 id="-transpose"><a class="header" href="#-transpose"><code>~ (transpose)</code></a></h2>
<blockquote>
<p><code>~&lt;expr&gt;</code></p>
</blockquote>
<p>returns the transpose of <code>&lt;expr&gt;</code>, assuming it is has arity 2. (Attempting to use transpose on a different-arity relation will produce an error.)</p>
<div id="admonition-transpose" class="admonition admonish-example">
<div class="admonition-title">
<p>Transpose</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-transpose"></a></p>
</div>
<div>
<p>If <code>roads</code> is a binary relation between <code>City</code> and itself:</p>
<pre><code>sig City {
    roads: set City
}
</code></pre>
<p>then <code>~roads</code> is an arity-2, set that contains exactly the same elements in <code>roads</code> except reversed. E.g., if <code>Providence -&gt; Pawtucket</code> was in <code>roads</code>, then <code>Pawtucket -&gt; Providence</code> would be in <code>~roads</code>.</p>
</div>
</div>
---
<h2 id="set-comprehension"><a class="header" href="#set-comprehension">Set Comprehension</a></h2>
<p>A set-comprehension expression <code>{x1: T1, ..., xn: Tn | &lt;fmla&gt;}</code> evaluates to a set of arity-n tuples. A tuple of objects <code>o1, ... on</code> is in the set if and only if <code>&lt;fmla&gt;</code> is satisfied when <code>x1</code> takes the value <code>o1</code>, etc. </p>
<div id="admonition-set-comprehension" class="admonition admonish-example">
<div class="admonition-title">
<p>Set Comprehension</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-set-comprehension"></a></p>
</div>
<div>
<p>In a model with sigs for <code>Student</code>, <code>Faculty</code>, and <code>Course</code>, the expression</p>
<pre><code>{s: Student, i: Faculty | some c: Course | { some s.grades[c] and c.instructor = i} }
</code></pre>
<p>would evaluate to the set of student-faculty pairs where the student has taken a course from that faculty member.</p>
</div>
</div>
<hr />
<h2 id="-and--relational-join"><a class="header" href="#-and--relational-join"><code>.</code> <em>and</em> <code>[] (relational join)</code></a></h2>
<blockquote>
<p><code>&lt;expr-a&gt; . &lt;expr-b&gt;</code></p>
</blockquote>
<p>returns the <strong>relational join</strong> of the two exprs. It combines two relations by seeking out rows with common values in their rightmost and leftmost columns. Concretely, if <code>A</code> is an <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>-ary relation, and <code>B</code> is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>-ary, then <code>A.B</code> equals the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>-ary relation:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣∃</span><span class="mord mathnormal">x</span><span class="mord">∣</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord text"><span class="mord"> and </span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">}</span></span></span></span></span></p>
<div id="admonition-product-example-1-1" class="admonition admonish-example">
<div class="admonition-title">
<p>Product (example 1)</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-product-example-1-1"></a></p>
</div>
<div>
<p>If <code>roads</code> is a binary relation between <code>City</code> and itself, and <code>Providence</code> is a city:</p>
<pre><code>sig City {
    roads: set City
}
one sig Providence extends City {}
</code></pre>
<p>then <code>roads.roads</code> is an arity-2 set and <code>Providence.roads</code> is an arity-1 set. </p>
<p>In the instance:</p>
<pre><code>inst joinExample {
    City = `Providence + `City0 + `City2
    roads = `Providence -&gt; `City0 +
            `City0 -&gt; `City1 +
            `City1 -&gt; Providence
}
</code></pre>
<p><code>roads.roads</code> would contain:</p>
<pre><code>`Providence -&gt; `City1   (because `Providence -&gt; `City0 and `City0 -&gt; `City1)
`City0 -&gt; `Providence (because `City0 -&gt; `City1 and `City1 -&gt; `Providence)
`City1 -&gt; `City0 (because `City1 -&gt; `Providence and `Providence -&gt; `City0)
</code></pre>
<p><code>Providence.roads</code> would contain:</p>
<pre><code>`City0 (because `Providence -&gt; `City0)
</code></pre>
</div>
</div>
<div id="admonition-forge-is-not-sql" class="admonition admonish-warning">
<div class="admonition-title">
<p>Forge is not SQL</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-forge-is-not-sql"></a></p>
</div>
<div>
<p>Relations in Forge don't have column <em>names</em> like they do in most databases. The join is always on the innermost columns of the two relations being joined.</p>
</div>
</div>
<!-- [TODOLINK]() -->
<p><strong>Alternative syntax:</strong> <code>&lt;expr-a&gt;[&lt;expr-b&gt;]</code>: is equivalent to <code>&lt;expr-b&gt; . &lt;expr-a&gt;</code>;</p>
<hr />
<h2 id="-transitive-closure"><a class="header" href="#-transitive-closure"><code>^ (transitive closure)</code></a></h2>
<blockquote>
<p><code>^&lt;expr&gt;</code></p>
</blockquote>
<p>returns the transitive closure of <code>&lt;expr&gt;</code>, assuming it is has arity 2. Attempting to apply <code>^</code> to a relation of different arity will produce an error. The transitive closure of a binary relation $r$ is defined as the <em>smallest</em> relation $t$ such that:</p>
<ul>
<li><code>r in t</code>; and </li>
<li>for all <code>a</code>, <code>b</code>, and <code>c</code>, if <code>a-&gt;b</code> is in <code>t</code> and <code>b-&gt;c</code> is in <code>t</code>, then <code>a-&gt;c</code> is in <code>t</code>.</li>
</ul>
<p>Informally, it is useful to think of <code>^r</code> as encoding <em>reachability</em> using <code>r</code>. It is equivalent to the (unbounded and thus inexpressible in Forge) union: <code>r + r.r + r.r.r + r.r.r.r + ...</code>. </p>
<div id="admonition-transitive-closure" class="admonition admonish-example">
<div class="admonition-title">
<p>Transitive Closure</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/relational-expressions/relational-expressions.html#admonition-transitive-closure"></a></p>
</div>
<div>
<p>If <code>roads</code> is a binary relation between <code>City</code> and itself, and <code>Providence</code> is a city:</p>
<pre><code>sig City {
    roads: set City
}
one sig Providence extends City {}
</code></pre>
<p>then <code>^roads</code> is the <em>reachability relation</em> between cities.</p>
</div>
</div>
<hr />
<h2 id="-reflexive-transitive-closure"><a class="header" href="#-reflexive-transitive-closure"><code>* (reflexive transitive closure)</code></a></h2>
<blockquote>
<p><code>*&lt;expr&gt;</code></p>
</blockquote>
<p>returns the reflexive-transitive closure of <code>&lt;expr&gt;</code>, assuming it is has arity 2. Attempting to apply <code>*</code> to a relation of different arity will produce an error.</p>
<p>For a given 2-ary relation <code>r</code>, <code>*r</code> is equivalent to <code>^r + iden</code>. </p>
<hr />
<h2 id="if-then-else"><a class="header" href="#if-then-else"><code>if then else</code></a></h2>
<blockquote>
<p><code>{&lt;fmla&gt; =&gt; &lt;expr-a&gt; else &lt;expr-b&gt;}</code> </p>
</blockquote>
<p>returns <code>&lt;expr-a&gt;</code> if <code>&lt;fmla&gt;</code> evaluates to true, and <code>&lt;expr-b&gt;</code> otherwise.</p>
<hr />
<h2 id="caveats-alloy-support"><a class="header" href="#caveats-alloy-support">Caveats: Alloy support</a></h2>
<p>Forge does not currently support the relational Alloy operators <code>&lt;:</code>, <code>:&gt;</code>, or <code>++</code>; if your models require them, please contact the Forge team.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="functions"><a class="header" href="#functions">Functions</a></h1>
<p>In the same way that <a href="building-models/constraints/expressions/../formulas/predicates.html">predicates</a> define reusable formulas, <em>functions</em> define reusable expressions in Relational and Temporal Forge. Define functions with the <code>fun</code> keyword:</p>
<pre><code>fun &lt;fun-name&gt;[&lt;args&gt;]: &lt;result-type&gt; {
   &lt;expr&gt;
}
</code></pre>
<div id="admonition-helper-function" class="admonition admonish-example">
<div class="admonition-title">
<p>Helper function</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/functions.html#admonition-helper-function"></a></p>
</div>
<div>
<pre><code>fun inLawA[p: Person]: one Person {
  p.spouse.parent1
}
</code></pre>
</div>
</div>
<p>As with predicates, arguments will be evaluated via substitution. Functions may be used (with appropriate arguments) anywhere expressions can appear.</p>
<div id="admonition-helper-function-use" class="admonition admonish-example">
<div class="admonition-title">
<p>Helper function use</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/functions.html#admonition-helper-function-use"></a></p>
</div>
<div>
<pre><code>all p: Person | some inLawA[p]
</code></pre>
<p>This expands to:</p>
<pre><code>all p: Person | some (p.spouse.parent1)
</code></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="let-expressions"><a class="header" href="#let-expressions">Let-Expressions</a></h1>
<p>You can bind an expression to an identifier locally by using a <code>let</code> form:</p>
<pre><code>let &lt;id&gt; = &lt;expression&gt; |
  &lt;formula&gt;
</code></pre>
<p>This is useful to avoid code bloat due to re-use. E.g., if <code>s</code> is a state:</p>
<pre><code>let s2 = Traces.nextState[s] |
  canTransition[s, s2]
</code></pre>
<h2 id="using-let-in-the-evaluator"><a class="header" href="#using-let-in-the-evaluator">Using <code>let</code> in the evaluator</a></h2>
<p>A <code>let</code> expression can be useful when debugging a model using Sterling's evaluator. E.g., if you want to evaluate an internal subformula for a specific value of a quantifier:</p>
<pre><code>some p: Person | some p.spouse
</code></pre>
<p>you can check individual values by directly substituting (e.g., <code>some Person0.spouse</code>) but this is tiresome if the variable is used in multiple places. Instead, consider using let: </p>
<pre><code>let p = Person0 | some p.spouse
</code></pre>
<div id="admonition-concrete-atoms" class="admonition admonish-warning">
<div class="admonition-title">
<p>Concrete atoms</p>
<p><a class="admonition-anchor-link" href="building-models/constraints/expressions/let-expressions.html#admonition-concrete-atoms"></a></p>
</div>
<div>
<p>This trick (referring to concrete objects) is only usable in the evaluator, because at that point a specific instance has been identified.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="comments"><a class="header" href="#comments">Comments</a></h1>
<p>Forge models support 3 different syntactic styles of comment:</p>
<ul>
<li>lines beginning with <code>--</code> are ignored;</li>
<li>lines beginning with <code>//</code> are ignored; and </li>
<li>all text between <code>/*</code> and <code>*/</code> are ignored. </li>
</ul>
<div id="admonition-no-nesting-comments" class="admonition admonish-warning">
<div class="admonition-title">
<p>No nesting comments</p>
<p><a class="admonition-anchor-link" href="building-models/comments.html#admonition-no-nesting-comments"></a></p>
</div>
<div>
<p><code>/* ... */</code> comments may <strong>not</strong> be nested. E.g., </p>
<pre><code class="language-clike">/*
/*
*/
*/
</code></pre>
<p>would be a syntax error, because the first instance of <code>*/</code> terminates all preceding instances of `/*.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="running"><a class="header" href="#running">Running</a></h1>
<h2 id="how-to-run"><a class="header" href="#how-to-run">How to Run</a></h2>
<p>You can either use the <a href="https://marketplace.visualstudio.com/items?itemName=SiddharthaPrasad.forge-language-server">Forge VSCode extension</a>'s play button, or invoke Forge directly from the terminal via Racket:</p>
<pre><code>racket &lt;modelname.frg&gt; 
</code></pre>
<p>You can provide Forge <a href="running-models/../running-models/options.html">options</a> directly by adding command-line flags:</p>
<ul>
<li>The <code>-o</code> or <code>-option</code> flag will set the option, but if the file sets that option the file's version will be used.</li>
<li>The <code>-O</code> or <code>-override</code> flag will set the option, and that option will hold regardless of what may be set in the file. </li>
</ul>
<div id="admonition-setting-options-at-the-command-line" class="admonition admonish-example">
<div class="admonition-title">
<p>Setting options at the command line</p>
<p><a class="admonition-anchor-link" href="running-models/running.html#admonition-setting-options-at-the-command-line"></a></p>
</div>
<div>
<p>If <code>ring_of_lights.frg</code> is in the current directory, running:</p>
<pre><code>racket ring_of_lights.frg -o run_sterling off -O verbose 0
</code></pre>
<p>will:</p>
<ul>
<li>disable Sterling <em>unless the option is set in the file</em>; and</li>
<li>disable verbose output entirely, regardless of any <code>verbose</code> option settings in the file.</li>
</ul>
</div>
</div>
<h2 id="commands-to-view-instances"><a class="header" href="#commands-to-view-instances">Commands to View Instances</a></h2>
<p>There are two primary ways of running your model with the goal of getting instances. You can either as Forge to show you instances that satisfy a predicate you wrote with the <code>run</code> command, or ask Forge to look for counterexamples to a predicate you wrote with the <code>check</code> command. </p>
<p>The various <a href="running-models/../testing-chapter/testing.html">testing commands</a> will also execute your model.</p>
<h3 id="run"><a class="header" href="#run">Run</a></h3>
<p>The run command can be used in a few different ways, show below:</p>
<pre><code>&lt;run-name&gt;: run &lt;pred&gt; for &lt;bounds&gt;
&lt;run-name&gt;: run { &lt;expr&gt; } for &lt;bounds&gt;
</code></pre>
<p>Note that the run-name is optional to provide, but is helpful to distinguish what different run commands are showing.</p>
<p>When using the run command, Forge will display possible worlds (instances) where the predicates or expressions you specified evaluate to true, within the given bounds. Instances are displayed in <a href="https://github.com/tnelson/Forge/wiki/Sterling-Visualizer">Sterling</a> If no such instances are found, &quot;UNSAT&quot; is displayed.</p>
<p>When no more satisfying instances can be found, Sterling displays &quot;No more instances found&quot;.</p>
<h3 id="check"><a class="header" href="#check">Check</a></h3>
<p>The check command is used to ask Forge to look for counterexamples to a given set of predicates, i.e. instances where the predicate or expression evaluates to false. The syntax is the same as for the run command, just with the keyword <code>check</code> instead:</p>
<pre><code>&lt;check-name&gt;: check &lt;pred&gt; for &lt;bounds&gt;
&lt;check-name&gt;: check { &lt;expr&gt; } for &lt;bounds&gt;
</code></pre>
<p>If no counterexamples are found, Sterling displays &quot;No counterexamples found. Assertion may be valid&quot;. When no more counterexamples can be found, Sterling displays &quot;No more instances found&quot;.</p>
<div id="admonition-common-mistake" class="admonition admonish-warning">
<div class="admonition-title">
<p>Common Mistake!</p>
<p><a class="admonition-anchor-link" href="running-models/running.html#admonition-common-mistake"></a></p>
</div>
<div>
<p>Unless a predicate is explicitly used in the <code>run</code>, <code>check</code>, etc. command (or invoked by another predicate that is used in the command) it will not take effect. For example, if you have defined a <code>wellformed</code> predicate, but execute <code>run {}</code>, that predicate will not necessarily hold in instances Forge finds.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="visualizing-and-evaluating-output"><a class="header" href="#visualizing-and-evaluating-output">Visualizing and Evaluating Output</a></h1>
<p>Forge uses a modified version of the <a href="https://sterling-js.github.io/">Sterling</a> model visualizer.</p>
<h2 id="visualizing-output"><a class="header" href="#visualizing-output">Visualizing Output</a></h2>
<p>When you execute your model, Forge will either look for instances that satisfy the predicates you wrote, or look for counterexamples to the assertion you wrote. If you used a <code>run</code> command, or if Forge found a counter-example to a <code>test</code>, <code>example</code>, or <code>assert</code> you wrote, Forge launches a window in your browser that displays the output. (See the run and check sections for the different displays Sterling has in various scenarios.)</p>
<p>The basic visualization of the model is a <strong>directed graph</strong> showing all the atoms in that instance and the relations between them. You can also view an alternate depiction of the instance in the <strong>table</strong> view tab. To keep visualizations neat, Sterling will not show you any <code>Int</code> atoms that are not used in the instance.</p>
<h3 id="theming"><a class="header" href="#theming">Theming</a></h3>
<p>The directed-graph view can be customized by clicking the <strong>Theme</strong> tray to the right of the Sterling window. Sterling supports two kinds of theming, listed below. </p>
<div id="admonition-saving-a-theme" class="admonition admonish-tip">
<div class="admonition-title">
<p>Saving a theme</p>
<p><a class="admonition-anchor-link" href="running-models/sterling-visualizer.html#admonition-saving-a-theme"></a></p>
</div>
<div>
<p>You can save your theme in a file and re-load it later in a new session. To do this, click the &quot;Save As...&quot; or &quot;Choose File&quot; options at the very top of the theming tray. The file will be downloaded as <code>theme.json</code>. </p>
<p>If you get a fresh instance and lose your theming, reloading a saved theme is a fast fix.</p>
</div>
</div>
<h4 id="projections"><a class="header" href="#projections">Projections</a></h4>
<p><em>Projecting</em> over a <code>sig</code> hides atoms of that <code>sig</code> in the visualizer and shows the rest of the instance as if that were the only atom of the projected <code>sig</code>. This can be a very useful for simplifying (e.g.) finite-trace instances, since much of the clutter will be eliminated. When a projection is active, the theming window will give the option to change which atom is being used.</p>
<h4 id="styles"><a class="header" href="#styles">Styles</a></h4>
<p>Style attributes such as font and line thickness for each <code>sig</code> and field can be customized. For fields only, clicking the &quot;display as attribute&quot; checkbox will tell Sterling to stop visualizing the field as an edge in the graph, and display it as an annotation on nodes.</p>
<p>Clicking a <code>sig</code> or field name will expand the style selection box for that <code>sig</code> or field. Click the name again to collapse the box.</p>
<div id="admonition-changing-source-and-target-nodes" class="admonition admonish-tip">
<div class="admonition-title">
<p>Changing source and target nodes</p>
<p><a class="admonition-anchor-link" href="running-models/sterling-visualizer.html#admonition-changing-source-and-target-nodes"></a></p>
</div>
<div>
<p>The default graph layout can sometimes be frustrating. For example, if you are modeling a weighted directed graph, you may have something like <code>sig Node { edges: set Node -&gt; Int }</code>. By default, Sterling will display each tuple in <code>edges</code> as an edge from the <em>first</em> tuple element to the <em>last</em> tuple element, meaning that you'll see a lot of arcs from nodes to numbers. </p>
<p>To fix this, set the &quot;Source Index&quot; and &quot;Target Index&quot; fields in the styling for a given field. In the above case, you would want a source index of <code>0</code> and a target index of <code>1</code>; Sterling would then move the weight to an edge label, resulting in a much more readable graph.</p>
</div>
</div>
<h3 id="visualizing-in-temporal-forge"><a class="header" href="#visualizing-in-temporal-forge">Visualizing in Temporal Forge</a></h3>
<p>In temporal mode, when the trace found is of length greater than 1, Sterling will enable a few new features:</p>
<ul>
<li>You can advance back and forth through the trace by using the arrow buttons in the <code>Time</code> drawer. Next to these buttons, Sterling will say which state the lasso loops back to. For instance, &quot;Loop: 1&quot; would mean that the lasso loops back to the second state (states are 0-indexed).</li>
<li>Rather than one &quot;Next&quot; button, you'll see two: one labeled &quot;Next&quot; and the other &quot;Next Config&quot;.
<ul>
<li>The &quot;Next Config&quot; button will ask the solver for a new trace that <em>varies the non-variable relations</em> of your model. If all your relations are variable, or if other constraints prevent a different non-variable subset of the instance from satisfying your run, this button will lead to a no-more-instances screen.</li>
<li>The &quot;Next&quot; button will ask the solver for a new trace that <em>holds the non-variable relations constant</em>. If there are no other traces possible without changing the non-variable relations, this button will lead to a no-more-instances screen.</li>
</ul>
</li>
</ul>
<p><img src="running-models/../images/temporal-minimap.png" alt="The trace viewer shows a cycle of 4 states, with the final state looping back to the first. A header says &quot;State 1 of 4&quot; between a forward and backward button." title="The trace viewer for temporal Forge" /></p>
<h2 id="the-evaluator"><a class="header" href="#the-evaluator">The Evaluator</a></h2>
<p>The evaluator provides a prompt that lets you query instances with Forge expressions. You can open the evaluator by clicking the &quot;Evaluator&quot; drawer on the far right of the Sterling window. Type a Forge expression and the evaluator will return its value in the current instance (assuming that Forge is still running). E.g.:</p>
<p><img src="running-models/../images/eval-ttt-places.png" alt="Evaluating an expression: the evaluator is open, and the user has just evaluated the expression \Board1.places. The result, ((A0 C0 X0))`, appears beneath the input box." title="Evaluating an Expression" /></p>
<p>Because the evaluator works with respect to a single instance, exact values of expressions are returned. These expressions are (as of January 2024) not always Forge syntax. E.g., relations are displayed using nested parentheses, and <code>false</code> is written as <code>#f</code>. Fields are displayed in row form, with every entry in the field grouped into a parenthesis; in the example above, the meaning is that there's only one move on the board: <code>X</code> moved at row <code>A</code>, column <code>C</code>.</p>
<div id="admonition-atoms-can-be-referenced" class="admonition admonish-tip">
<div class="admonition-title">
<p>Atoms can be referenced</p>
<p><a class="admonition-anchor-link" href="running-models/sterling-visualizer.html#admonition-atoms-can-be-referenced"></a></p>
</div>
<div>
<p>Individual atoms can be directly referenced by name in the evaluator, like in <code>inst</code> blocks (remember to prefix atom names with a backquote!) E.g., in the above example, <code>`Board1</code> was an atom name.</p>
</div>
</div>
<!-- The evaluator can also be given commands like `--version` (`-v`) to show the version of Forge being used or `--help` (`-h`) to show the file being run. -->
<h3 id="the-evaluator-in-temporal-forge"><a class="header" href="#the-evaluator-in-temporal-forge">The Evaluator in Temporal Forge</a></h3>
<p>If running in temporal mode, the evaluator is run in the context of the <em>first state</em> of the trace shown. To ask about later traces, use the <code>'</code> or <code>next_state</code> operators. Remember that <code>next_state</code> applies to formulas, and <code>'</code> applies to relational expressions. So in a directed graph you could ask whether there are <code>edges</code> in the second state via <code>some edges'</code> or <code>after some edges</code>.</p>
<h2 id="custom-visualizations-script-view"><a class="header" href="#custom-visualizations-script-view">Custom Visualizations: Script View</a></h2>
<p>Sterling also allows you to write and run scripts that produce your own custom visualizations. This documentation site contains a basic example here:</p>
<ul>
<li><a href="running-models/../example-models/vis/ttt.js">example visualization script</a></li>
<li><a href="running-models/../example-models/ttt.frg">Tic-tac-toe model to run the script with</a></li>
</ul>
<p>If you want to try out this example, do the following:</p>
<p><strong>Step 1:</strong> Open the Forge model and run it (<code>racket ttt.frg</code>). Sterling should open in your web browser, defaulting to the directed-graph visualization---which isn't very useful for this model. You should see something like this: </p>
<p><img src="running-models/../images/ttt-viz-1.png" alt="Default visualization for tic-tac-toe, comprising boxes and lines" title="Default Visualizer" /></p>
<p><strong>Step 2:</strong> Click the Script button on the upper-right of the window. This will switch to custom script view mode. Paste the script into the editor, then click the <code>Run</code> button. You should see something like this before clicking <code>Run</code>:</p>
<p><img src="running-models/../images/ttt-viz-2.png" alt="Custom visualizer before running. There is an editor in the middle of the window where the script has been pasted, and a button marked &quot;run&quot; above it." title="Custom Visualizer" /></p>
<div id="admonition-drawers" class="admonition admonish-tip">
<div class="admonition-title">
<p>Drawers</p>
<p><a class="admonition-anchor-link" href="running-models/sterling-visualizer.html#admonition-drawers"></a></p>
</div>
<div>
<p>If you don't like the &quot;Variables&quot; tab taking up space, just click the corresponding drawer on the far right. The tab should collapse, making more room for the editor and visualization area.</p>
</div>
</div>
<p>After running, you should see something like this, with a sequence of board states displayed on the left-hand side of the screen:</p>
<p><img src="running-models/../images/ttt-viz-3.png" alt="Custom visualizer after running. To the left, there is a sequence of boxes, each showing a board state of tic-tac-toe." title="Custom Visualizer (Run)" /></p>
<h3 id="more-information"><a class="header" href="#more-information">More Information</a></h3>
<p>For more complex examples, library documentation, instructions on writing your own visualizers, etc. see <a href="running-models/../sterling/custom-basics.html">Custom Visualizations</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="bounds"><a class="header" href="#bounds">Bounds</a></h1>
<p>Forge is a <em>bounded</em> model finder, meaning it can only look for instances up to a certain bound. You can specify bounds in two seperate ways in Forge: using numeric bounds or instance bounds.</p>
<hr />
<h2 id="numeric-bounds-also-called-scopes"><a class="header" href="#numeric-bounds-also-called-scopes">Numeric bounds (also called &quot;scopes&quot;)</a></h2>
<p>The most basic way of specifying bounds in Forge is providing a maximum number of objects for each <code>sig</code>. If no bound is specified, Forge defaults to allowing up to 4 of each <code>sig</code>. The default bound on <code>Int</code> is a <em>bitwidth</em> of 4 (16 integers total).</p>
<p>Numeric bounds can be provided explicitly per sig in a <code>run</code>, <code>assert</code>, etc. command by adding a trailing <code>for ...</code> after the constraint block (see <a href="running-models/running.html">Running</a>). </p>
<div id="admonition-applying-a-numeric-bound" class="admonition admonish-example">
<div class="admonition-title">
<p>Applying a numeric bound</p>
<p><a class="admonition-anchor-link" href="running-models/bounds.html#admonition-applying-a-numeric-bound"></a></p>
</div>
<div>
<p>E.g., to add a bound to a <code>run</code> command in a model with <code>Cat</code> and <code>Dog</code> sigs, you would write something like:</p>
<pre><code>run { ... } for 5 Cat
run { ... } for 5 Cat, 2 Dog
</code></pre>
<p>The first run will search for instances containing 0--5 cats and 0--4 dogs. The second run will search for instances containing 0--5 cats and 0--2 dogs.</p>
</div>
</div>
<p>Note that this sets an <strong>upper</strong> bound on the size of instances Forge will show you. In other words, Forge will search for instances of size <strong>up to</strong> the bound you specify. If you instead want to set an <strong>exact</strong> bound, you can add the <code>exactly</code> keyword per sig. You may mix and match exact and upper numeric bounds as desired.</p>
<div id="admonition-exact-and-upper-numeric-bounds" class="admonition admonish-example">
<div class="admonition-title">
<p>Exact and upper numeric bounds</p>
<p><a class="admonition-anchor-link" href="running-models/bounds.html#admonition-exact-and-upper-numeric-bounds"></a></p>
</div>
<div>
<pre><code>run { ... } for exactly 5 Cat
run { ... } for exactly 5 Cat, 2 Dog
</code></pre>
<p>The first run will search for instances containing exactly 5 cats and 0--4 dogs. The second run will search for instances containing exactly 5 cats and 0--2 dogs.</p>
</div>
</div>
<div id="admonition-two-important-exceptions" class="admonition admonish-warning">
<div class="admonition-title">
<p>Two Important Exceptions</p>
<p><a class="admonition-anchor-link" href="running-models/bounds.html#admonition-two-important-exceptions"></a></p>
</div>
<div>
<p>Although a numeric bound without <code>exact</code> generally means anything <strong>up to</strong> that bound, there are two important exceptions to this rule:</p>
<p>(1) The set of available integers is always fixed exactly by the bitwidth. E.g., <code>3 Int</code> corresponds to the 8 integers in the range -4 through 3 (inclusive). </p>
<p>(2) If the <code>&lt;field&gt; is linear</code> annotation is present, the <code>sig</code> to which the field belongs will become exact-bounded, even if you have not written <code>exactly</code> in the numeric bound.</p>
</div>
</div>
<h2 id="instance-bounds"><a class="header" href="#instance-bounds">Instance bounds</a></h2>
<p>Instance bounds allow you to encode specific partial instances that you want Forge to run on. When creating an instance bound, you give upper and lower bounds in terms of concrete objects, not numeric sizes. This allows you to test your predicates on a specific instance, which can be convenient (see <a href="running-models/../testing-chapter/testing.html#examples">Examples</a>). It is also useful for optimization in some cases (see <a href="running-models/./concrete-instance-bounds.html#instances">Partial Instances</a>, which use the same bounds syntax as examples). </p>
<div id="admonition-a-partial-instance" class="admonition admonish-example">
<div class="admonition-title">
<p>A partial instance</p>
<p><a class="admonition-anchor-link" href="running-models/bounds.html#admonition-a-partial-instance"></a></p>
</div>
<div>
<p>If we have defined a single sig with a single field:</p>
<pre><code>sig Person {
    spouse: lone Person
}
</code></pre>
<p>then this <code>inst</code> describes an instance for our model:</p>
<pre><code>inst exampleInstance {
    Person = `Person0 + `Person1 + `Person2
    spouse = `Person0 -&gt; `Person1 + `Person1 + `Person0
}
</code></pre>
<p>Similarly, we could write an example using the same syntax (assuming that <code>marriageRules</code> is defined as a predicate):</p>
<pre><code>example myExample is {marriageRules} for {
    Person = `Person0 + `Person1 + `Person2
    spouse = `Person0 -&gt; `Person1 + `Person1 + `Person0
}
</code></pre>
</div>
</div>
<p>Note that Forge expects concrete object names to be prefixed with a backquote; this is mandatory, and used to distinguish object names (which only make sense in the context of an instance or instances) from sigs, fields, predicates, and other kinds of identifiers that make sense in arbitrary formulas. </p>
<p>Instances defined via <code>inst</code> can be used in <code>run</code>, <code>assert</code>, etc. and may be combined with numeric bounds, provided they are consistent. Bounds annotations, such as <code>is linear</code>, can be included in instance bounds as well. See the <a href="running-models/./concrete-instance-bounds.html">Concrete Instances</a> section for more information about writing instance bounds.</p>
<div id="admonition-using-instance-bounds" class="admonition admonish-example">
<div class="admonition-title">
<p>Using Instance Bounds</p>
<p><a class="admonition-anchor-link" href="running-models/bounds.html#admonition-using-instance-bounds"></a></p>
</div>
<div>
<p>You may give the entire instance bound verbatim:</p>
<pre><code>run {} for 3 Int for {
    Person = `Person0 + `Person1 + `Person2
    spouse = `Person0 -&gt; `Person1 + `Person1 + `Person0
}
</code></pre>
<p>or you may use the instance name directly:</p>
<pre><code>run {} for 3 Int for exampleInstance
</code></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="concrete-instance-bounds"><a class="header" href="#concrete-instance-bounds">Concrete Instance Bounds</a></h1>
<p>The types of problems that Forge creates and solves consist of 3 mathematical objects:</p>
<ul>
<li>A set of signatures and relations (the <strong>language</strong> of the problem);</li>
<li>A set of logical/relational formulas (the <strong>constraints</strong> of the problem);</li>
<li>A set of bounds on sigs and relations (the <strong>bounds</strong> of the problem).</li>
</ul>
<h2 id="partial-instances"><a class="header" href="#partial-instances">Partial Instances</a></h2>
<p>Forge presents a syntax that helps users keep these concerns separated. The first two concerns are represented by <code>sig</code> and <code>pred</code> declarations. The third concern is often addressed by numeric bounds (also called &quot;scope&quot;), but numeric bounds are always converted (usually invisibly to the user!) into set-based bounds that concretely specify:</p>
<ul>
<li>the <em>lower</em> bounds, what <em>must</em> be in an instance; and </li>
<li>the <em>upper</em> bounds, what <em>may</em> be in an instance.</li>
</ul>
<p>The <code>inst</code> syntax provides the ability to manipulate these set-based bounds directly, instead of indirectly via numeric bounds. The same syntax is used in <code>example</code> tests. Because bounds declarations interface more directly with the solver than constraints, at times they can yield performance improvements.</p>
<p>Finally, because bounds declarations can concretely refer to atoms in the world, we will often refer to them as <em>partial instances</em>.</p>
<h2 id="inst-syntax"><a class="header" href="#inst-syntax"><code>inst</code> Syntax</a></h2>
<p>An <code>inst</code> declaration contains a <code>{}</code>-enclosed sequence of bind declarations.  A bind declaration is one of the following, where <code>A</code> is either a sig name or field name.</p>
<ul>
<li><code>#Int = k</code>: use bitwidth <code>k</code> (where <code>k</code> is an integer greater than zero); </li>
<li><code>A in &lt;bounds-expr&gt;</code>: specify <em>upper</em> bounds on a sig or field <code>A</code>;</li>
<li><code>A ni &lt;bounds-expr&gt;</code>: specify <em>lower</em> bounds on a sig or field <code>A</code>;</li>
<li><code>A = &lt;bounds-expr&gt;</code>: <em>exactly</em> specify the contents of the sig or field <code>A</code> (effectively setting both the lower and upper bounds to be the same);</li>
<li><code>no A</code>: specify that <code>A</code> is empty;</li>
<li><code>r is linear</code> : use bounds-based symmetry breaking to make sure field <code>r</code> is a linear ordering on its types (useful for optimizing model-checking queries in Forge); and</li>
<li><code>r is plinear</code> : similar to <code>r is linear</code>, but possibly not involving the entire contents of the sig. I.e., a total linear order on <code>A'</code>-&gt;<code>A'</code> for some subset <code>A'</code> of <code>A</code>.</li>
</ul>
<p>When binding fields, the binding can also be given <em>piecewise</em> per atom. Keep in mind that atom names should be prefixed by a backquote:</p>
<ul>
<li><code>AtomName.f in &lt;bounds-expr&gt;</code> (upper bound, restricted to <code>AtomName</code>);</li>
<li><code>AtomName.f ni &lt;bounds-expr&gt;</code> (lower bound, restricted to <code>AtomName</code>);</li>
<li><code>AtomName.f = &lt;bounds-expr&gt;</code> (exact bound, restricted to <code>AtomName</code>); and</li>
<li><code>no AtomName.f</code> (exact bound <em>contains nothing</em>, restricted to <code>AtomName</code>).
Piecewise bindings add no restrictions to <em>other</em> atoms, only those mentioned. They can improve readability if you're defining a field for many different atoms. There is an example below.</li>
</ul>
<p>The specifics of <code>&lt;bounds-expr&gt;</code> depend on which Forge language you are using. </p>
<div id="admonition-bounds-arent-the-same-as-constraints" class="admonition admonish-warning">
<div class="admonition-title">
<p>Bounds aren't the same as constraints!</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-bounds-arent-the-same-as-constraints"></a></p>
</div>
<div>
<p>The syntax of partial <code>inst</code>ances is very similar to the syntax you use to write constraints in <code>pred</code>icates. Always keep in mind that <strong>they are not the same</strong>; bindings have a far more restrictive syntax but allow you to refer to atoms directly---something constraints don't allow.</p>
</div>
</div>
<h3 id="froglet-style-bind-expressions"><a class="header" href="#froglet-style-bind-expressions">Froglet Style Bind Expressions</a></h3>
<p>In Froglet:</p>
<ul>
<li>a <code>&lt;bounds-expr&gt;</code> for a <code>sig</code> is a <code>+</code>-separated list of atom names (each prefixed by backquote), <code>sig</code> names that have already been bounded, and integers (without backquotes).</li>
<li>a <code>&lt;bounds-expr&gt;</code> for a field is a <code>+</code>-separated list of entries in that field, using atom names (each prefixed by a backquote), <code>sig</code> names that have already been bounded, and integers (without backquotes). Entries are defined using the <code>(arg1, arg2, ...) -&gt; result</code> syntax, and may be either complete or piecewise. 
<ul>
<li>a <em>complete</em> bind for a field </li>
</ul>
</li>
</ul>
<div id="admonition-froglet-style-bounds" class="admonition admonish-example">
<div class="admonition-title">
<p>Froglet-style bounds</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-froglet-style-bounds"></a></p>
</div>
<div>
<p>Suppose you have a Forge model like this:</p>
<pre><code>sig Person {
    gradeIn: pfunc Course -&gt; Grade
}
sig Course {}
abstract sig Grade {}
</code></pre>
<p>where <code>Person</code> has a partial-function field <code>gradeIn</code>, indicating which grade they got in a given course (if any).</p>
<p>Given this concrete bound for the <code>Person</code>, <code>Course</code>, and <code>Grade</code> <code>sig</code>s:</p>
<pre><code>Person = `Person0 + `Person1 + `Person2
Course = `Course0 + `Course1 + `Course2
Grade = `A + `B + `C 
</code></pre>
<p>you might define bounds for the <code>gradeIn</code> field of <code>Person</code> all at once, for everyone:</p>
<pre><code>gradeIn = (`Person0, `Course0) -&gt; `A + 
          (`Person0, `Course1) -&gt; `B + 
          (`Person1, `Course2) -&gt; `C
</code></pre>
<p>or piecewise, one <code>Person</code> at a time:</p>
<pre><code>`Person0.gradeIn = `Course0 -&gt; `A + 
                   `Course1 -&gt; `B
`Person1.gradeIn = `Course2 -&gt; `C
no `Person2.gradeIn
</code></pre>
<p>Note that in the piecewise version, we need to explicitly say that <code>\</code>Person2` hasn't taken courses; in the all-at-once version, that's implicit.</p>
<p><em>This model is available in full <a href="running-models/../example-models/piecewise-bounds.frg">here</a>.</em></p>
</div>
</div>
<div id="admonition-atom-names" class="admonition admonish-warning">
<div class="admonition-title">
<p>Atom names</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-atom-names"></a></p>
</div>
<div>
<p>Identifiers prefixed by a backquote (<code>\</code>) always denote atom names. You cannot name atoms like this in ordinary constraints! (Thus, in the example above there is no <code>one sig A extends Grade {}</code>; there is only the atom <code>\</code>A`.)</p>
</div>
</div>
<div id="admonition-in-vs-ni-vs-" class="admonition admonish-warning">
<div class="admonition-title">
<p><code>in</code> vs. <code>ni</code> vs. <code>=</code></p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-in-vs-ni-vs-"></a></p>
</div>
<div>
<p>Bound expressions must not mix the <code>=</code>, <code>in</code> and <code>ni</code> operators for the same <code>sig</code> or field, even within a piecewise definition. It's OK to use <code>ni</code> for one field and <code>in</code> for another, but always use exactly one of them for each field. You should also not mix operators between sigs that are related by <code>extends</code>.</p>
</div>
</div>
<p><strong>This style of bind expression is still allowed in Relational Forge, so if you prefer it, feel free to continue using it!</strong> </p>
<h3 id="relational-forge-style-bind-expressions"><a class="header" href="#relational-forge-style-bind-expressions">Relational-Forge Style Bind Expressions</a></h3>
<p>From the relational perspective, a <code>&lt;bounds-expr&gt;</code> is a union (<code>+</code>) of products (<code>-&gt;</code>) of object names (each prefixed by backquote), <code>sig</code> names, and integers. Bounds expressions must be of appropriate arity for the sig or field name they are bounding. </p>
<div id="admonition-relational-bounds-expressions" class="admonition admonish-example">
<div class="admonition-title">
<p>Relational bounds expressions</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-relational-bounds-expressions"></a></p>
</div>
<div>
<pre><code>A = `Alice+`Alex+`Adam
f = `Alice-&gt;`Alex + 
    `Adam-&gt;`Alex
g in `Alice-&gt;2 
</code></pre>
<p>where <code>A</code> is a sig, <code>f</code> is a field of <code>A</code> with value in <code>A</code>, and <code>g</code> is a field of <code>A</code> with integer value. Note that integers should be used directly, without backquotes.</p>
</div>
</div>
<div id="admonition-common-errors" class="admonition admonish-tip">
<div class="admonition-title">
<p>Common errors</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-common-errors"></a></p>
</div>
<div>
<p><strong>Arity mismatches between the left and right-hand sides.</strong> E.g., in a standard directed graph where <code>edges</code> is a binary relation on <code>Node</code>s:</p>
<pre><code>edges in Node
</code></pre>
<p>would produce an error, even though the way you declare the field in Forge hides the extra column in the relation:</p>
<pre><code>sig Node { edges: set Node }
</code></pre>
<p><strong>Leaving parent <code>sig</code>s unbounded.</strong> Forge currently (January 2024) will not permit binding a child <code>sig</code> without first binding its parent <code>sig</code>. E.g., this results in an error if <code>Student</code> is a child <code>sig</code> of <code>Person</code>:</p>
<pre><code>Student = `Student0 + `Student1
</code></pre>
<p>To fix the problem, just add the same kind of bound for <code>Person</code>:</p>
<pre><code>Student = `Student0 + `Student1
Person = Student + `Teacher0
</code></pre>
</div>
</div>
<h3 id="inst-in-temporal-forge"><a class="header" href="#inst-in-temporal-forge"><code>inst</code> in Temporal Forge</a></h3>
<p>Temporal Forge also supports <code>inst</code> using the same syntax above. </p>
<div id="admonition-bounds-apply-to-all-states-at-once" class="admonition admonish-warning">
<div class="admonition-title">
<p>Bounds apply to all states at once!</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-bounds-apply-to-all-states-at-once"></a></p>
</div>
<div>
<p>If you use a partial instance with a Temporal Forge model, be aware that there's no way to bind sigs or fields <em>per state</em>. Each binding is applied globally, so they can be very useful for optimization, but don't try to write <code>example</code>s with <code>inst</code> in Temporal Forge---you have no recourse to temporal operators in binding expressions!</p>
</div>
</div>
<h2 id="notes-on-semantics"><a class="header" href="#notes-on-semantics">Notes on Semantics</a></h2>
<p>Bounds declarations are resolved <em>in order</em> before the problem is sent to the solver. The right-hand side of each declaration is evaluated given all preceding bounds declarations, which means that using <code>sig</code> names on the right-hand side is allowed so long as those sigs are <em>exact bounded</em> by some preceding bounds declaration. </p>
<p>A bounds declaration cannot define bounds for a sig unless bounds for its ancestors are also defined. Bounds inconsistencies will produce an error message.</p>
<h3 id="mixing-numeric-scope-and-inst"><a class="header" href="#mixing-numeric-scope-and-inst">Mixing Numeric Scope and <code>inst</code></a></h3>
<p>You can mix both styles; just give the set-based bounds after the numeric ones. </p>
<div id="admonition-example-run-mixing-both-styles" class="admonition admonish-example">
<div class="admonition-title">
<p>Example <code>run</code> mixing both styles</p>
<p><a class="admonition-anchor-link" href="running-models/concrete-instance-bounds.html#admonition-example-run-mixing-both-styles"></a></p>
</div>
<div>
<pre><code>run {myPred} for 5 Person for {Class = `Class0 + `Class1}
</code></pre>
</div>
</div>
<p>However, beware of inconsistencies! Numeric and <code>inst</code> bounds are (as of January 2024) only reconciled right before the solver is invoked, so you might receive confusing error messages of &quot;last resort&quot; in case of inconsistency between the two. </p>
<!-- The semantics of comparison commands using `=`, `in`, or `ni` are asymmetrical.  -->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="options"><a class="header" href="#options">Options</a></h1>
<p>Forge has a number of options that affect how it functions and how its solver is configured. They all have the same form: <code>option &lt;key&gt; &lt;value&gt;</code>. <strong>Settings are case sensitive.</strong> The available setting keys are:</p>
<ul>
<li><code>verbose</code>: governs the amount of information provided in the REPL. <code>1</code> is standard; <code>0</code> will omit statistical information (useful for test suites); <code>10</code> will print exceedingly verbose debugging information. Values between <code>1</code> and <code>10</code> gradually increase verbosity.</li>
<li><code>solver</code>: sets the solver used by Forge's worker process. The default is <code>SAT4J</code>, a Java-based solver. Other solvers can be more performant, and produce different instance orderings, depending on model. The <code>MiniSatProver</code> solver will enable extraction of unsat cores. Support for native solvers varies by OS. Currently: 
<ul>
<li>MacOS (x64 and arm64 <code>.dylib</code>):
<ul>
<li><code>MiniSat</code>, <code>MiniSatProver</code>, and <code>Glucose</code></li>
</ul>
</li>
<li>Linux (<code>.so</code>): 
<ul>
<li><code>MiniSat</code>, <code>MiniSatProver</code>, and <code>Glucose</code></li>
</ul>
</li>
<li>Windows (<code>.dll</code>):
<ul>
<li><code>MiniSatProver</code></li>
</ul>
</li>
<li>All: 
<ul>
<li><code>&quot;&lt;path-to-solver&gt;&quot;</code>, which lets you run a solver of your own that accepts DIMACS input (see the section below for instructions). </li>
</ul>
</li>
</ul>
</li>
<li><code>logtranslation</code>: controls how much of the translation from Forge to boolean logic is logged. The default is <code>0</code>; must be <code>1</code> or higher to extract unsatisfiable cores.</li>
<li><code>coregranularity</code>: controls how fine-grained an unsatisfiable core will be returned. Default is <code>0</code>. Suggested value is <code>1</code> if you want to see cores.</li>
<li><code>core_minimization</code>: controls whether cores are guaranteed minimal. Default is <code>off</code>. For minimal cores, use <code>rce</code>; <code>hybrid</code> is not guaranteed minimal but is often better than <code>off</code> while being faster than <code>rce</code>.</li>
<li><code>sb</code>: controls maximum size of symmetry-breaking predicate. <code>20</code> is default. Higher numbers increase Forge's ability to rule out equivalent instances, at a potential performance cost.</li>
<li><code>skolem_depth</code>: gives how many layers of universal quantifiers to Skolemize past. Default is <code>0</code>; to disable Skolemization, give <code>-1</code>.</li>
<li><code>engine_verbosity</code>: sets the Logger level used by Pardinus (default=0). The following table is current as of version 1.5.0 (when the option was added):</li>
</ul>
<pre><code>case 0 : return Level.OFF;
case 1 : return Level.SEVERE;
case 2 : return Level.WARNING;
case 3 : return Level.INFO;
case 4 : return Level.FINE;
case 5 : return Level.FINER;
case 6 : return Level.FINEST;
default : return Level.ALL;
</code></pre>
<ul>
<li><code>run_sterling</code>: decides whether to use the Sterling visualizer. Default is <code>on</code>. To disable, give <code>off</code>. Alternatively, pass a string containing the file path of a visualizer script to auto-load it in Sterling.</li>
<li><code>sterling_port</code>: sets the port used by the Racket web-server that Sterling connects to. The default picks an unused ephemeral port.</li>
<li><code>test_keep</code>: controls Forge's behavior when running test suites. The default (<code>first</code>) will cause Forge to stop immediately on the first test failure. The only currently-supported alternative (<code>last</code>) will cause Forge to run all tests and print a report at the end; only the <em>final test failure</em> will remain open for use with Sterling.</li>
<li><code>problem_type</code>: used to enable <code>temporal_mode</code> for Alloy6-style LTL support. <strong>This option is deprecated in favor of using <code>#lang forge/temporal</code> instead</strong>, and may be removed in future versions.</li>
<li><code>no_overflow</code> (default: <code>false</code>): when set to <code>true</code>, enables the Pardinus/Kodkod backend's overflow protection. This will <em>exclude</em> instances which satisfy the given problem only due to bitwidth overflow semantics. E.g., <code>Counter.x = add[2,2]</code> would not be satisfiable at bitwidth <code>3</code> with this option set to <code>true</code>, because <code>4</code> is greater than the maximum value available with 3 bits.</li>
</ul>
<div id="admonition-location-matters" class="admonition admonish-warning">
<div class="admonition-title">
<p>Location matters!</p>
<p><a class="admonition-anchor-link" href="running-models/options.html#admonition-location-matters"></a></p>
</div>
<div>
<p>Options apply from the point they occur onward until either the file ends or the same setting is changed. For instance, only the second <code>run</code> command in this example will print verbose debugging information.</p>
<pre><code>sig Node {edges: set Node}
run {}
option verbose 10
run {}
option verbose 1
run {}
</code></pre>
</div>
</div>
<h2 id="custom-solvers"><a class="header" href="#custom-solvers">Custom Solvers</a></h2>
<p>Forge can use a solver of your choice to produce instances; this is most often used to experiment with the solver you build in the DPLL homework. There are a few factors to be aware of.</p>
<h3 id="limitations"><a class="header" href="#limitations">Limitations</a></h3>
<p>While the &quot;Next&quot; button will be enabled in Sterling, the custom solver functionlity will always return the <em>first</em> instance found by the custom solver. There is also no support for unsatisfiable-core extraction; the custom solver will only report &quot;unsat&quot; for an unsatisfiable problem. </p>
<h3 id="instructions"><a class="header" href="#instructions">Instructions</a></h3>
<p>To invoke a custom solver, provide a double-quoted filepath literal as the solver name:</p>
<pre><code>option solver &quot;&lt;filepath-to-solver&gt;&quot;
</code></pre>
<p>Note that:</p>
<ul>
<li>the file must exist at the path specified;</li>
<li>the file must be executable;</li>
<li>the file must implement the DIMACS input/output format given in the DPLL assignment stencil;</li>
<li>if the file is a script using a <code>#!</code> preamble, the preamble must point to the correct location. E.g., if the file is a Python script that begins with <code>#!/usr/bin/python3</code>, your Python 3 executable must reside at <code>/usr/bin/python3</code>. </li>
</ul>
<p>The solver engine doesn't return rich information in the case of failure. Should any of these conditions not be met, you'll see a generic Pardinus crash error. </p>
<div id="admonition-note" class="admonition admonish-note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="running-models/options.html#admonition-note"></a></p>
</div>
<div>
<p>If you're using Windows directly (rather than the Linux subsystem), extensions like <code>.py</code> will not be treated as executable. It may be useful to create a batch file (<code>.bat</code> extension) that invokes your solver, and give that batch file as the path in <code>option solver</code> instead.</p>
</div>
</div>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>If you want to create a batch script on MacOS or Linux, you might try something like this in a <code>run.sh</code> file: </p>
<pre><code>#!/bin/sh
python3 solver.py $1
</code></pre>
<p>On windows, you could try something like this, in a <code>run.bat</code> file:</p>
<pre><code>@ECHO OFF
python3 solver.py %1
</code></pre>
<p>You might then invoke your solver via a <code>.frg</code> file like this:</p>
<pre><code>#lang forge

-- MacOS or Linux:
option solver &quot;./run.sh&quot;

-- Windows:
-- option solver &quot;./run.bat&quot;


sig Node {edges: set Node}

test expect {
    s: {some edges} for 1 Node is sat
    u: {no edges 
        all n: Node | some n.edges} for exactly 1 Node is unsat
        
}

-- This will work, but will only ever show one instance:
--run {}
</code></pre>
<p>If your script can be executed directly, then you can replace <code>./run.sh</code> in the above with the path to your script, including filename. On Windows, you will only be able to reference <code>.bat</code> or <code>.exe</code> files in your Forge solver option.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="target-oriented-model-finding-tomf-in-forge"><a class="header" href="#target-oriented-model-finding-tomf-in-forge">Target-oriented model finding (TOMF) in Forge</a></h1>
<p><strong>CAUTION: This feature of Forge is experimental and subject to change. It will be added as a preview feature in version 4.3.</strong></p>
<p>Forge uses a modified version of the <a href="https://github.com/haslab/Pardinus">Pardinus model finder</a> as its back end. Pardinus supports a form of optimization that targets a specific goal instance (which may or may not satisfy the given constraints). We are grateful to Alcino Cunha, Nuno Macedo, and Tiago Guimarães for their engineering work and <a href="https://link.springer.com/content/pdf/10.1007/978-3-642-54804-8_2.pdf">technical paper</a> on target orientation.</p>
<h2 id="how-to-enable-tomf"><a class="header" href="#how-to-enable-tomf">How to enable TOMF</a></h2>
<p>To enable target-oriented mode, switch solvers to partial max-SAT and use the <code>target</code> problem type:</p>
<pre><code>option problem_type target
option solver PMaxSAT4J
</code></pre>
<p><strong>This should only be done in Relational Forge (<code>#lang forge</code>).</strong> Do not attempt to use <code>target</code> mode in Temporal Forge, which requires a different backend solver mode.</p>
<!-- The `target_mode` option provides the global default for how the solver treats the target. There are 5 options currently available:
* `close_noretarget`: Get as close to the target as possible. When enumerating instances, keep targeting the original target.
* `far_noretarget`: Get as far from the target as possible (up to the given bounds). When enumerating instances, keep targeting the original target.
* `close_retarget`: Get as close to the target as possible. When enumerating instances, reset the target to the last produced instance. **(Not yet reliable)**
* `far_retarget`: Get as far from the target as possible (up to the given bounds). When enumerating instances, reset the target to the last produced instance. **(Not yet reliable)**
* `hamming_cover`: View instances as vectors of boolean variables, where each variable corresponds to a potential tuple membership in a relation. Define the distance between two instances to be the Hamming distance between their boolean vectors. Enumerate instances that maximize the distance from previously produced instances. **(Not yet reliable)** -->
<!-- Absent an explicit target, the engine will target the first instance generated. Therefore, use the global option if you don't have a specific target in mind, but want to customize the enumeration strategy that the solver follows.  -->
<!-- If you do have a specific target in mind, give it as part of a `run` command, following the target. E.g.:

```
tomf_close_fixed: run {} for 3 Node 
  target_pi {no Node} close_noretarget 
``` -->
<h2 id="mode-targeting-a-partial-instance"><a class="header" href="#mode-targeting-a-partial-instance">Mode: Targeting a partial instance</a></h2>
<p>To prioritize instances as close as possible to a target, use the <code>target_pi</code> keyword in a <code>run</code> command. The argument may be either be the name of a pre-defined <code>inst</code> or a <code>{}</code>-delimited partial-instance block. </p>
<h3 id="example-minimal-instances"><a class="header" href="#example-minimal-instances">Example: Minimal Instances</a></h3>
<p>This example will produce the empty instance first, then a graph of 1 node, etc. </p>
<pre><code>#lang forge
option problem_type target
option solver PMaxSAT4J
sig Node { edges: pfunc Node -&gt; Int }
inst emptyGraph { no Node }
tomf_test_close_noretarget_noNode: run {}
  target_pi emptyGraph
</code></pre>
<h2 id="mode-targeting-an-integer-expression"><a class="header" href="#mode-targeting-an-integer-expression">Mode: Targeting an integer expression</a></h2>
<p>It can sometimes be useful to minimize an <em>integer</em> expression, rather than a set. To do this, use either the <code>minimize_int</code> or <code>maximize_int</code> keywords, providing an integer-valued expression. </p>
<p>When optimizing with respect to an integer expression, keep in mind the bitwidth. E.g., the default bitwidth of <code>4</code> will instantiate the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span></span></span></span> integers in the interval <code>[-8, 7]</code>. Thus, minimizing an integer expression when the default bitwidth is in effect will target <code>-8</code>. </p>
<h3 id="example-minimizing-total-edge-weight"><a class="header" href="#example-minimizing-total-edge-weight">Example: Minimizing total edge weight</a></h3>
<p>This example will produce graphs with minimal total edge weight, modulo potential underflow. E.g., the example may produce a graph with a single edge of weight <code>-8</code>, but it might also produce a graph with three distinct <code>-8</code>-weight edges. </p>
<pre><code>#lang forge
option problem_type target
option solver PMaxSAT4J
sig Node { edges: pfunc Node -&gt; Int }
tomf_test_close_noretarget_int_totalWeight4: run {} for exactly 2 Node
  minimize_int {sum m: Node | sum n: Node | m.edges[n]} 
</code></pre>
<p>If this example used <code>maximize_int</code> rather than <code>minimize_int</code>, the solver would anti-target <code>-8</code> and in effect target the maximum integer value <code>7</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<p>Forge supports several different testing constructs. Chiefly:</p>
<ul>
<li><code>example</code>, for expressing that <em>specific instances</em> should satisfy (or not satisfy) a predicate; </li>
<li><code>assert</code>, for expressing that a predicate should be...
<ul>
<li>sufficient to satisfy another (<code>is sufficient for</code>); </li>
<li>necessary for another to be satisfied (<code>is necessary for</code>);</li>
<li>is consistent with another, i.e., that the combination of the two predicates can be satisfied by at least one instance (<code>is consistent with</code>);</li>
<li>is satisfiable or unsatisfiable (<code>is sat</code> and <code>is unsat</code>).</li>
</ul>
</li>
</ul>
<p>Assertions largely subsume an older testing form, <code>test expect</code> blocks, which are less structured and used mostly within Forge's internal test cases.</p>
<p><strong>Note on terminology</strong>: we will sometimes refer to tests, particularly assertions of necessity and sufficiency, as <em>property tests</em>. This is because they can be used to express sweeping expectations about predicates, rather than just the point-wise, single-instance expectations that <code>example</code> can. We also sometimes refer to a test as a <em>test of exclusion</em> (if it asserts that some set of instances shouldn't be admitted by a predicate) or <em>test of inclusion</em> (to assert that some set of instances should be admitted, or that such an instance exists). </p>
<div id="admonition-shared-context" class="admonition admonish-note">
<div class="admonition-title">
<p>Shared Context</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-shared-context"></a></p>
</div>
<div>
<p>All the subsections below contain tests for the same small model of tic-tac-toe:</p>
<pre><code>abstract sig Player {}
one sig X, O extends Player {}
sig Board { board: pfunc (Int -&gt; Int) -&gt; Player }
pred wellformed {
  all b: Board | all row, col: Int | {
    (row &lt; 0 or row &gt; 2 or col &lt; 0 or col &gt; 2) implies
      no b.board[row][col] 
  } 
}
</code></pre>
</div>
</div>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<p>The <code>example</code> syntax lets you test whether a specific instance is satisfied by some predicate in your model. An <code>example</code> contains three parts:</p>
<ul>
<li>a name for the example;</li>
<li>which predicate the instance should satisfy (or not satisfy); and </li>
<li>the instance itself. </li>
</ul>
<div id="admonition-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-example"></a></p>
</div>
<div>
<p>This <code>example</code>, named <code>diagonalPasses</code>, expresses that a board where X has moved in the upper-left, middle, and lower-right squares (and <code>O</code> has made no moves at all) should satisfy the <code>wellformed</code> predicate:</p>
<pre><code>example diagonalPasses is {wellformed} for {
  Board = `Board0
  X = `X0 
  O = `O0
  A = `A0
  B = `B0
  C = `C0
  `Board0.board = (0,0)-&gt;`X + (1,1)-&gt;`X + (2,2)-&gt;`X
}
</code></pre>
<p>Notice that the <code>example</code> needs to give a value for <em>all</em> <code>sig</code>s and <em>all</em> fields, even the <code>one sig</code>s.</p>
</div>
</div>
<p>Examples are analogous to unit tests in Forge. Every example says that if the instance were passed to the predicate, the predicate would return true (or false). This means that examples are a great way to explore potential design choices and map out your intent when modeling.</p>
<div id="admonition-temporal-forge" class="admonition admonish-warning">
<div class="admonition-title">
<p>Temporal Forge</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-temporal-forge"></a></p>
</div>
<div>
<p>The <code>example</code> keyword is not supported in Temporal Forge.</p>
</div>
</div>
<h4 id="how-do-examples-work"><a class="header" href="#how-do-examples-work">How do examples work?</a></h4>
<p>An example passes if and only if the instance given is consistent with the predicate given. </p>
<div id="admonition-total-vs-partial-instances" class="admonition admonish-warning">
<div class="admonition-title">
<p>Total vs. partial instances</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-total-vs-partial-instances"></a></p>
</div>
<div>
<p>If you leave a sig or field unbound in an <code>example</code>, Forge is free to assign that sig or field in any way to achieve consistency with the predicate. The consequence is that it is possible to write apparently contradictory examples that pass. E.g., in the above example, if we left out the binding for <code>board</code>:</p>
<pre><code>example exampleYes is {wellformed} for {
  Board = `Board0
  X = `X0 
  O = `O0
  A = `A0
  B = `B0
  C = `C0  
}
example exampleNo is {not wellformed} for {
  Board = `Board0
  X = `X0 
  O = `O0
  A = `A0
  B = `B0
  C = `C0  
}
</code></pre>
<p><strong>Both</strong> of these examples would pass vs. the <code>wellformed</code> predicate, because Forge can find values for the <code>board</code> field that either satisfy or dissatisfy the <code>wellformed</code> predicate.</p>
</div>
</div>
<h3 id="notes-on-example-syntax"><a class="header" href="#notes-on-example-syntax">Notes on Example Syntax</a></h3>
<p>The block within the second pair of braces must always be a concrete instance. That is, a series of assignments for each sig and field to some set of tuples, defined over atom names. Atom names must be preceded by a backquote; this reinforces the idea that they are atoms in a specific instance, rather than names in the model. You will not be able to refer to these atoms in predicates and most other Forge syntax.</p>
<p><em>Don't</em> try to assign to the same field twice. If you want a field to contain multiple entries, use <code>+</code> instead. Remember that <code>=</code> in the context of an instance is <em>assignment</em>, not a constraint, and that most constraints won't work inside an instance.</p>
<p>Names of <code>sig</code>s may be used on the right-hand-side of an assignment only if the block has previously defined the value of that `sig`` exactly, allowing straightforward substitution.</p>
<h2 id="assert"><a class="header" href="#assert">Assert</a></h2>
<p>The <code>assert</code> syntax allows you to write tests at a more abstract level than examples do. An assert has these parts:</p>
<ul>
<li>an optional name, followed by a colon;</li>
<li>an optional block of <code>all</code>-quantified variables;</li>
<li>the keyword <code>assert</code>, followed by a predicate name or <code>{}</code>-delimited constraint block;</li>
<li>the assertion type: <code>is necessary for</code>, <code>is sufficient for</code>, <code>is consistent with</code>, <code>is sat</code>, or <code>is unsat</code>; and </li>
<li>for <code>is necessary for</code>, <code>is sufficient for</code>, and <code>is consistent with</code> asserts, a predicate name. </li>
</ul>
<div id="admonition-assertions" class="admonition admonish-example">
<div class="admonition-title">
<p>Assertions</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-assertions"></a></p>
</div>
<div>
<p>If we first define these two predicates:</p>
<pre><code>pred fullFirstRow {some b: Board | b.board[0][0] = X and b.board[0][1] = X and b.board[0][2] = X}
pred someMoveTaken {some b: Board, row, col: Int | some b.board[row][col] }
</code></pre>
<p>we can then write two assertions:</p>
<pre><code>assert fullFirstRow is sufficient for winning for 1 Board
assert someMoveTaken is necessary for winning for 1 Board
</code></pre>
<p>which should both pass, since:</p>
<ul>
<li>if <code>X</code> occupied the entire first row, it has won; and </li>
<li>if someone has won the game, there must be moves taken on the board.</li>
</ul>
<p>But surely we also wish to make sure that these don't pass only because <code>fullFirstRow</code> and <code>someMoveTaken</code> are unsatisfiable!</p>
<pre><code>assert fullFirstRow is sat
assert someMoveTaken is sat
</code></pre>
<p>or even better (and with names, too):</p>
<pre><code>nonvacuous_fullFirstRow: assert fullFirstRow is consistent with wellformed
nonvacuous_someMoveTaken: assert someMoveTaken is consistent with wellformed
</code></pre>
</div>
</div>
<p>Assertions also support universal quantification (i.e. <code>all</code>, but not <code>some</code>, <code>one</code>, <code>lone</code>, etc). For example, if you instead wrote the predicates:</p>
<div id="admonition-assertionsquant" class="admonition admonish-example">
<div class="admonition-title">
<p>AssertionsQuant</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-assertionsquant"></a></p>
</div>
<div>
<pre><code>pred fullFirstRow[b : Board] {b.board[0][0] = X and b.board[0][1] = X and b.board[0][2] = X}
pred someMoveTaken[b : Board, row : Int, col : Int] {some b.board[row][col] }
</code></pre>
<p>You could write the assertions</p>
<pre><code>assert all b : Board | fullFirstRow[b] is sufficient for winning for 1 Board
assert all b : Board, row, col : Int | someMoveTaken[b, row, col] is necessary for winning for 1 Board
</code></pre>
</div>
</div>
<p>Assertions are an excellent way to check and document your goals and assumptions about your model. In a more complex setting, we might write assertions that enforce:</p>
<ul>
<li>Dijkstra's algorithm doesn't terminate until the destination vertex has been reached; </li>
<li>for a game of chess to be won, a king must be in check; </li>
<li>someone must first be logged into Gmail to read their mail;
or confirm that:</li>
<li>it is possible to generate a run of Dijkstra's algorithm in the model;</li>
<li>it is possible to generate a chess configuration where the king is in check; or</li>
<li>someone can log into Gmail to begin with. </li>
</ul>
<h3 id="notes-on-assert-syntax"><a class="header" href="#notes-on-assert-syntax">Notes on Assert Syntax</a></h3>
<p>The right-hand-side of the assertion must be a predicate name. That is, you <em>cannot</em> provide arbitrary formulas enclosed in brackets to an <code>assert</code>. This restriction eases some analysis but also encourages you to create reusable predicates.</p>
<h2 id="suites-organizing-your-tests"><a class="header" href="#suites-organizing-your-tests">Suites: Organizing Your Tests</a></h2>
<p>You should organize your tests into <code>test suite</code>s for each predicate you plan to test.</p>
<div id="admonition-test-suite" class="admonition admonish-example">
<div class="admonition-title">
<p>Test Suite</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-test-suite"></a></p>
</div>
<div>
<p>For example, you could combine all the above forms into one suite for the <code>winning</code> predicate:</p>
<pre><code>test suite for winning {
  assert fullFirstRow is sufficient for winning for 1 Board
  assert someMoveTaken is necessary for winning for 1 Board
  
  test expect { possibleToWin_withoutFullFirstRow: {winning and not fullFirstRow} is sat } 
  
  example diagonalWin is {winning} for {
    Board = `Board0
    X = `X0 
    O = `O0
    A = `A0
    B = `B0
    C = `C0
    `Board0.board = (0,0)-&gt;`X + (1,1)-&gt;`X + (2,2)-&gt;`X
  }
}   
</code></pre>
</div>
</div>
<h2 id="test-expect-blocks"><a class="header" href="#test-expect-blocks">Test-Expect Blocks</a></h2>
<p>We generally suggest using assertions rather than test-expect blocks if you can do so. </p>
<p>Every <code>test expect</code> contains a set of individual checks. Each has:</p>
<ul>
<li>an optional test name;</li>
<li>a predicate block; and </li>
<li>an intention (<code>is sat</code>, <code>is unsat</code>, <code>is checked</code>, or <code>is forge_error</code>). </li>
</ul>
<p>The meaning of each intention is:</p>
<ul>
<li><code>is sat</code>: the predicate block is satisfiable under the given bounds; </li>
<li><code>is unsat</code>: the predicate block is unsatisfiable under the given bounds; and </li>
<li><code>is checked</code>: the predicate block's <em>negation</em> is unsatisfiable under the given bounds.</li>
<li><code>is forge_error</code>: the predicate block produces a forge error when run.</li>
</ul>
<p>Like the other test forms, each test may be accompanied by numeric scopes and <code>inst</code> bounds.</p>
<div id="admonition-test-expect" class="admonition admonish-example">
<div class="admonition-title">
<p>Test expect</p>
<p><a class="admonition-anchor-link" href="testing-chapter/testing.html#admonition-test-expect"></a></p>
</div>
<div>
<p>This expresses that it's possible to satisfy the <code>someMoveTaken</code> predicate:</p>
<pre><code>test expect { possibleToMove: {someMoveTaken} is sat }  
</code></pre>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="integers"><a class="header" href="#integers">Integers</a></h1>
<p>Forge supports <em>bit-vector</em> integers. That is, the Forge <code>Int</code> sig does not contain an infinite set of mathematical integers. Rather, an instance's <code>Int</code> sig contains a representation of a <em>subset</em> of the integers following <a href="https://en.wikipedia.org/wiki/Two%27s_complement">two's-complement encoding</a> for a specific number of bits. Concretely, if the bitwidth is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>, the integers in an instance will be the interval <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>. The default bitwidth is 4.</p>
<div id="admonition-bitwidths" class="admonition admonish-example">
<div class="admonition-title">
<p>Bitwidths</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/integers.html#admonition-bitwidths"></a></p>
</div>
<div>
<p>If we run with a bitwidth of <code>2</code>, we only expect <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> available integers: <code>-2</code> through <code>1</code>, inclusive.</p>
</div>
</div>
<div id="admonition-bounded-integers-and-overflow" class="admonition admonish-warning">
<div class="admonition-title">
<p>Bounded integers and overflow</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/integers.html#admonition-bounded-integers-and-overflow"></a></p>
</div>
<div>
<p>Remember that a bound on <code>Int</code> is the <em>bitwidth</em> allowed, not the number of integers! This is different from all other types in Forge.</p>
<p>Moreover, performing arithmetic on Forge integers may trigger integer overflow or underflow.</p>
<p><strong>Example</strong>: With a bitwidth of <code>4</code>, <code>add[7, 1]</code> evaluates to <code>-8</code>.</p>
<p>For more on integer bounds, see [[Bounds|Bounds]].</p>
</div>
</div>
<h2 id="remark"><a class="header" href="#remark">Remark</a></h2>
<p>There are <em>technically</em> two types of &quot;integers&quot; in Forge: integer <strong>values</strong> (e.g. 4) and integer <strong>atoms</strong> (e.g. the atom representing 4 in a given instance). You can think of this as roughly similar to the primitive-<code>int</code> vs. object-<code>Integer</code> distinction in Java, although the analogy is not perfect. Forge will usually be able to automatically convert between these two, and you shouldn't usually have to think about the difference. We still mention it here for completeness.</p>
<h2 id="integer-operators"><a class="header" href="#integer-operators">Integer Operators</a></h2>
<p>In the following, <code>&lt;atoms&gt;</code> represents a set of integer atoms and <code>&lt;value&gt;</code>, <code>&lt;value-a&gt;</code> and <code>&lt;value-b&gt;</code> are integer values. </p>
<ul>
<li><code>add[&lt;value-a&gt;, &lt;value-b&gt; ...]</code>: returns the value of the sum <code>value-a</code> + <code>value-b</code> + ...</li>
<li><code>subtract[&lt;value-a&gt;, &lt;value-a&gt; ...]</code>: returns the value of the difference <code>value-a</code> - <code>value-b</code> - ... </li>
<li><code>multiply[&lt;value-a&gt;, &lt;value-b&gt; ...]</code>: returns the value of the product <code>value-a</code> * <code>value-b</code> * ...</li>
<li><code>divide[&lt;value-a&gt;, &lt;value-b&gt; ...]</code>: returns the value of the left-associative integer quotient (<code>value-a</code> / <code>value-b</code>) / ...</li>
<li><code>remainder[&lt;value-a&gt;, &lt;value-b&gt;]</code>: returns the remainder for doing integer division. Note that if <code>value-a</code> is negative, the result will also be negative, and that integer wrap-around may affect the answer.</li>
<li><code>abs[&lt;value&gt;]</code>: returns the absolute value of <code>value</code></li>
<li><code>sign[&lt;value&gt;]</code>: returns 1 if <code>value</code> is &gt; 0, 0 if <code>value</code> is 0, and -1 if <code>value</code> is &lt; 0</li>
</ul>
<h2 id="comparison-operators-on-values"><a class="header" href="#comparison-operators-on-values">Comparison operators on values</a></h2>
<p>You can compare integer values using the usual <code>=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, and <code>&gt;=</code>.</p>
<h2 id="counting"><a class="header" href="#counting">Counting</a></h2>
<p>Given an arbitrary expression <code>e</code>, the expression <code>#e</code> evaluates to the cardinality of (i.e., number of elements in) <code>e</code>. In Froglet, this is nearly always either <code>0</code> or <code>1</code>, although full Forge allows expressions that evaluate to sets of arbitrary size.</p>
<div id="admonition-if-youre-counting-check-the-bitwidth" class="admonition admonish-warning">
<div class="admonition-title">
<p>If you're counting, check the bitwidth!</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/integers.html#admonition-if-youre-counting-check-the-bitwidth"></a></p>
</div>
<div>
<p>Forge only represents <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span> possible integers, where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> is the bitwidth. If you attempt to count beyond that (or do arithmetic that falls outside the available integers) Forge's solver will follow the two's complement convention and <em>wrap</em>. Thus, at a bitwidth of <code>4</code>, which allows counting between <code>-8</code> and <code>7</code> (inclusive), <code>add[7,1]</code> is <code>-8.</code></p>
</div>
</div>
<h3 id="counting-in-froglet"><a class="header" href="#counting-in-froglet">Counting in Froglet</a></h3>
<p>It is often useful to count even in Froglet, where expressions usually evaluate to either <code>none</code> or some singleton object. For example, in a tic-tac-toe model we might want to count the number of <code>X</code> entries on the board. In both Froglet and Forge, we can write this using a combination of <code>#</code> and <a href="forge-standard-library/../building-models/constraints/expressions/relational-expressions/relational-expressions.html">set comprehension</a> (normally not available in Froglet): <code>#{row, col: Int | b.board[row][col] = X}</code>. </p>
<p>Concretely:</p>
<blockquote>
<p><code>#{x1: T1, ..., xn: Tn | &lt;fmla&gt;}</code> </p>
</blockquote>
<p>evaluates to an integer value reflecting the number of tuples <code>o1, ... on</code> where <code>&lt;fmla&gt;</code> is satisfied when <code>x1</code> takes the value <code>o1</code>, etc. </p>
<h2 id="aggregation-and-conversion"><a class="header" href="#aggregation-and-conversion">Aggregation and Conversion</a></h2>
<p>To convert between sets of integer atoms and integer values there are the following operations:</p>
<ul>
<li><code>sing[&lt;value&gt;]</code>: returns an integer atom representing the given value;</li>
<li><code>sum[&lt;atoms&gt;]</code>: returns an integer value: the sum of the values that are represented by each of the int atoms in the set;</li>
<li><code>max[&lt;atoms&gt;]</code>: returns an integer value: the maximum of all the values represented by the int atoms in the set; and</li>
<li><code>min[&lt;atoms&gt;]</code>: returns an integer value: the minimum of all the values represented by the int atoms in the set.</li>
</ul>
<p>While you might use <code>sum</code>, <code>max</code>, and <code>min</code>, you shouldn't need to use <code>sing</code>---Forge automatically converts between integer values and integer objects. If you do find you need to use <code>sing</code>, notify us ASAP!</p>
<h2 id="sum-aggregator"><a class="header" href="#sum-aggregator">Sum Aggregator</a></h2>
<p>You should be cautious using <code>sum[...]</code> once you start using the Relational Forge language. Suppose you have <code>sig A { i: one Int }</code>, and want to sum over all of the <code>i</code> values for every <code>A</code>. Duplicate values for <code>i</code> may exist across multiple <code>A</code> atoms. Then <code>sum[A.i]</code> would <em>not</em> count duplicates separately, since <code>A.i</code> evaluates to a <em>set</em>, which can have no duplicates!</p>
<p>Because of this problem, Forge provides a second way to use <code>sum</code> which does count duplicates:</p>
<pre><code>sum &lt;x&gt;: &lt;set&gt; | { &lt;int-expr&gt; }
</code></pre>
<p>Above, <code>x</code> is a variable name, <code>set</code> is the set you are quantifying over (currently only arity-1 sets are supported), and <code>int-expr</code> is an expression that evaluates to an <strong>integer value</strong>. The result of this entire expression is also an <strong>integer value</strong>. This counts duplicate integer values provided the atoms (of any type) in &quot;relation&quot; are different. The following example illustrates the difference between the two different uses of <code>sum</code>.</p>
<div id="admonition-sum-aggregator" class="admonition admonish-example">
<div class="admonition-title">
<p>Sum aggregator</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/integers.html#admonition-sum-aggregator"></a></p>
</div>
<div>
<p>In the instance:</p>
<pre><code>inst duplicates {
    A = `A0 + `A1
    time = `A0 -&gt; 1 + `A1 -&gt; 1
}
</code></pre>
<ul>
<li><code>sum[A.time]</code> evaluates to the value 1; and</li>
<li><code>sum a: A | sum[a.time]</code>  evaluates to the value 2.</li>
</ul>
</div>
</div>
<div id="admonition-only-one-variable-at-a-time" class="admonition admonish-warning">
<div class="admonition-title">
<p>Only one variable at a time</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/integers.html#admonition-only-one-variable-at-a-time"></a></p>
</div>
<div>
<p>The <code>sum</code> aggregator doesn't support multiple variables at once. If you want to express something like <code>sum x, y: A | ...</code>, write <code>sum x: A | sum y : A | ...</code> instead.</p>
</div>
</div>
<h2 id="the-successor-relation"><a class="header" href="#the-successor-relation">The Successor Relation</a></h2>
<p>Forge also provides a successor relation, <code>succ</code> (<code>Int -&gt; Int</code>) where each <code>Int</code> atom points to its successor (e.g. the <code>Int</code> atom 4 points to 5). The maximum <code>Int</code> atom does not point to anything.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="constants--keywords"><a class="header" href="#constants--keywords">Constants &amp; Keywords</a></h1>
<h2 id="constants"><a class="header" href="#constants">Constants</a></h2>
<p>Forge provides a few built-in constants:</p>
<ul>
<li><code>univ</code> (arity 1): the set of all objects in the universe (including <code>Int</code>s);</li>
<li><code>none</code> (arity 1): the empty set (to produce higher-arity empty relations, use the <code>-&gt;</code> operator. E.g., a 2-ary empty relation would be represented as <code>none -&gt; none</code> 
);</li>
<li><code>iden</code>: the identity relation (a total function from all objects in the universe to themselves, including <code>Ints</code>);</li>
<li><code>Int</code>: the set of available integer objects. By default it contains <code>-8</code> to <code>7</code> inclusive, since the default bitwidth is <code>4</code>. See <a href="forge-standard-library/../forge-standard-library/integers.html">Integers</a> for more information.</li>
</ul>
<h2 id="keywords"><a class="header" href="#keywords">Keywords</a></h2>
<p>The following is a list of keywords in Forge that may not be used as names for relations, sigs, predicates, and runs. These include:</p>
<ul>
<li><code>state</code>, <code>transition</code> (reserved for future use)</li>
<li><code>sig</code>, <code>pred</code>, <code>fun</code></li>
<li><code>test</code>, <code>expect</code>, <code>assert</code>, <code>run</code>, <code>check</code>, <code>is</code>, <code>for</code></li>
<li>names of arithmetic operators, helpers, and built-in constants (e.g., <code>add</code>, <code>univ</code>, and <code>reachable</code>)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="helpers"><a class="header" href="#helpers">Helpers</a></h1>
<p>Forge and Frglet provide a number of built-in helpers to ease your work in the language.</p>
<h2 id="sequences"><a class="header" href="#sequences">Sequences</a></h2>
<p>A sequence is a field <code>f</code> of the form <code>f: pfunc Int -&gt; A</code> (where <code>A</code> can be any <code>sig</code>) such that:</p>
<ul>
<li><code>f</code> is a partial function (i.e., each <code>Int</code> has at most one corresponding entry);</li>
<li>no index <code>Int</code> is less than zero; and</li>
<li>indexes are contiguous (e.g., if there are entries at index <code>1</code> and index <code>3</code>, there must be one at index <code>2</code>).</li>
</ul>
<p>You can think of sequences as roughly analogous to fixed-size arrays in a language like Java. To tell Forge that a partial-function field <code>f</code> is a sequence, use the <code>isSeqOf</code> predicate.</p>
<p>Hint: make sure that you use <code>isSeqOf</code> in any test or run that you want to enforce that <code>f</code> is a sequence. The <code>isSeqOf</code> predicate is just another constraint: it's not a persistent declaration like <code>pfunc</code> is.</p>
<h4 id="isseqof"><a class="header" href="#isseqof">isSeqOf</a></h4>
<ul>
<li><code>isSeqOf[f, A]</code>: a predicate that holds if and only if <code>f</code> is a sequence of values in <code>A</code>.</li>
</ul>
<h3 id="sequence-helpers"><a class="header" href="#sequence-helpers">Sequence Helpers</a></h3>
<p>The following helpers are also available, but should only be used when <code>f</code> is a sequence:</p>
<h4 id="sequence-helper-functions"><a class="header" href="#sequence-helper-functions">Sequence Helper Functions:</a></h4>
<ul>
<li><code>seqFirst[f]</code>: returns the first element of <code>f</code>, i.e. <code>f[0]</code>.</li>
<li><code>seqLast[f]</code>: returns the last element of <code>f</code>.</li>
<li><code>indsOf[f, e]</code>: returns all the indices of <code>e</code> in <code>f</code>.</li>
<li><code>idxOf[f, e]</code>: returns the first index of <code>e</code> in <code>f</code>.</li>
<li><code>lastIdxOf[f, e]</code>: returns the last index of <code>e</code> in <code>f</code>.</li>
<li><code>elems[f]</code>: returns all the elements of <code>f</code>.</li>
<li><code>inds[f]</code>: returns all the indices of <code>f</code>.</li>
</ul>
<h4 id="sequence-helper-predicates"><a class="header" href="#sequence-helper-predicates">Sequence Helper Predicates:</a></h4>
<ul>
<li><code>isEmpty[f]</code>: true if and only if sequence <code>f</code> is empty.</li>
<li><code>hasDups[f]</code>: true if and only if sequence <code>f</code> has duplicates (i.e., there are at least two indices that point to the same value).</li>
</ul>
<h2 id="reachability"><a class="header" href="#reachability">Reachability</a></h2>
<p>Forge provides a convenient way to speak of an object being reachable via fields of other objects.</p>
<ul>
<li><code>reachable[a, b, f]</code>: object <code>a</code> is reachable from <code>b</code> through recursively applying field <code>f</code>. This predicate only works if <code>a.f</code> is well-defined.</li>
<li><code>reachable[a, b, f1, f2, ...]</code>: an extended version of <code>reachable</code> which supports using more than one field to reach <code>a</code> from <code>b</code>.</li>
</ul>
<p>The extended version of reachable is useful if you wish to model, e.g., binary trees where nodes have a <code>left</code> and <code>right</code> field. In such a model, if you want to quantify over all descendents of a <code>parent</code> node, you might write <code>all n: Node | reachable[n, parent, left, right]</code>.</p>
<div id="admonition-order-matters" class="admonition admonish-note">
<div class="admonition-title">
<p>Order matters!</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/helpers.html#admonition-order-matters"></a></p>
</div>
<div>
<p>Beware: the order of arguments in <code>reachable</code> matters! The first argument is the object <em>to be reached</em>, and the second argument is the <em>starting object</em>. Getting these reversed is a common source of errors.</p>
</div>
</div>
<div id="admonition-the-value-none-is-reachable-from-anything" class="admonition admonish-note">
<div class="admonition-title">
<p>The value <code>none</code> is reachable from anything</p>
<p><a class="admonition-anchor-link" href="forge-standard-library/helpers.html#admonition-the-value-none-is-reachable-from-anything"></a></p>
</div>
<div>
<p>Beware: if you pass something that might be <code>none</code> as the first argument of <code>reachable</code>, in such cases <code>reachable</code> will evaluate to true. E.g., <code>reachable[p.spouse, p, father]</code> will evaluate to true if <code>p</code> happens to be unmarried.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="temporal-forge-overview"><a class="header" href="#temporal-forge-overview">Temporal Forge Overview</a></h1>
<p>Temporal mode extends Forge with temporal operators to ease specification and checking of dynamic systems. This mode draws heavily on the <a href="http://haslab.github.io/Electrum/">Electrum work</a> by INESC TEC and ONERA, and the newer Alloy 6 version, but there are (slight) differences.</p>
<p>To use Temporal Forge, just use <code>#lang forge/temporal</code>. This will cause a number of changes in how Forge processes your models, the largest one being that it will now always search for <strong>lasso traces</strong> (see below) rather than arbitrary instances. The maximum length of the trace is given by <code>option max_tracelength &lt;k&gt;</code> and defaults to <code>5</code>. The minimum length of the trace is given by <code>option min_tracelength &lt;k&gt;</code> and defaults to <code>1</code>. </p>
<div id="admonition-using-minimum-trace-length" class="admonition admonish-info">
<div class="admonition-title">
<p>Using Minimum Trace Length</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-using-minimum-trace-length"></a></p>
</div>
<div>
<p>The temporal solver works by iterative deepening: try length 1, then length 2, ... and so <em>sometimes</em> (not always) a longer minimum trace length can speed up the process.</p>
</div>
</div>
<h2 id="variable-state-var"><a class="header" href="#variable-state-var">Variable state (<code>var</code>)</a></h2>
<p>Temporal Forge allows <code>var</code> annotations to be placed on <code>sig</code> and field definitions. Such an annotation indicates that the contents of the corresponding relation may vary over time. Any sigs or fields that are not declared <code>var</code> will <em>not</em> vary over time.</p>
<div id="admonition-importance-of-var" class="admonition admonish-warning">
<div class="admonition-title">
<p>Importance of <code>var</code></p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-importance-of-var"></a></p>
</div>
<div>
<p>If no sigs or fields are declared <code>var</code>, the temporal solver cannot change anything from state to state.</p>
</div>
</div>
<div id="admonition-var-declarations" class="admonition admonish-example">
<div class="admonition-title">
<p><code>var</code> declarations</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-var-declarations"></a></p>
</div>
<div>
<p>Writing <code>sig Vertex { var edges: set Vertex }</code> defines a directed graph whose edge relation may vary. </p>
<p>Writing <code>var sig Student {}</code> denotes that the set of students need not remain constant.</p>
</div>
</div>
<h2 id="temporal-mode-semantics-informally"><a class="header" href="#temporal-mode-semantics-informally">Temporal Mode Semantics (Informally)</a></h2>
<p>When the temporal solver is enabled, instances are always traces, and a trace is an <strong>infinite</strong> object, containing a state for every natural number <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>. However, the solver underlying Forge needs to finitize the problem in order to solve it. The solution to this, given a finite state-space, is to invoke the Pigeonhole Principle and seek traces that end in a loop: &quot;lassos&quot;.</p>
<div id="admonition-lassos-must-loop-back" class="admonition admonish-warning">
<div class="admonition-title">
<p>Lassos must loop back!</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-lassos-must-loop-back"></a></p>
</div>
<div>
<p>If your system needs more steps before it loops back than the maximum trace length (e.g., an integer counter that overflows with a small trace length), Forge may tell you that there are no traces. Always pay attention to your <code>max_tracelength</code> option, and be convinced that it is sufficient to include the lassos you're interested in.</p>
</div>
</div>
<p>Temporal formulas and expressions are always evaluated with respect to a state index. At the top level of any formula, the index is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> (the first state of the trace). Temporal operators either change or &quot;fan out&quot; across multiple state indexes to let you express things like:</p>
<ul>
<li>&quot;in the next state, ...&quot; (add 1 to the state index)</li>
<li>at some point in the future, ... (search for <code>some</code> state index)</li>
<li>at all points in the future, ... (check <code>all</code> future indexes)</li>
<li>...</li>
</ul>
<h2 id="added-relational-operators-priming"><a class="header" href="#added-relational-operators-priming">Added relational operators: priming</a></h2>
<p>Temporal Forge adds one relational operator: priming (<code>'</code>). Any relational expression that is primed implicitly means &quot;this expression <strong>in the next state</strong>&quot;. Thus, you can use priming to concisely write transition effects. </p>
<div id="admonition-priming" class="admonition admonish-example">
<div class="admonition-title">
<p>Priming</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-priming"></a></p>
</div>
<div>
<p>Writing <code>cookies' in cookies</code> would mean that in every transition, the set of <code>cookies</code> never grows over time (will either shrink or remain the same).</p>
</div>
</div>
<h2 id="added-formula-operators"><a class="header" href="#added-formula-operators">Added formula operators</a></h2>
<p>Temporal Forge adds a number of formula operators, corresponding to those present in Linear Temporal Logic (LTL) and Past-Time Linear Temporal Logic.</p>
<h3 id="traditional-ltl-future-time"><a class="header" href="#traditional-ltl-future-time">Traditional LTL (future time)</a></h3>
<h4 id="next-state"><a class="header" href="#next-state">Next State</a></h4>
<ul>
<li><code>next_state &lt;fmla&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla</code> holds in state <code>i+1</code>.</li>
</ul>
<div id="admonition-next_state" class="admonition admonish-example">
<div class="admonition-title">
<p>next_state</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-next_state"></a></p>
</div>
<div>
<p>In a model with <code>one sig Nim { var cookies: set Cookie }</code>, writing <code>next_state no Nim.cookies</code> expresses the sad fact that, in the next state, Nim has no cookies.</p>
</div>
</div>
<div id="admonition-let-and-temporal-operators" class="admonition admonish-warning">
<div class="admonition-title">
<p>Let and temporal operators</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-let-and-temporal-operators"></a></p>
</div>
<div>
<p>Don't try to write something like:</p>
<pre><code>let oldCount = Counter.count | 
    next_state Counter.count = add[oldCount, 1]
</code></pre>
<p>The <code>let</code> construct is implemented with substitution, and so the above will be rewritten to:</p>
<pre><code>next_state Counter.count = add[Counter.count, 1]
</code></pre>
<p>which expresses that, in the next state, the counter must be one greater than itself. This will be unsatisfiable.</p>
</div>
</div>
<h4 id="always-now-and-in-the-future"><a class="header" href="#always-now-and-in-the-future">Always (now and in the future)</a></h4>
<ul>
<li><code>always &lt;fmla&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla</code> holds in every state <code>&gt;=i</code>.</li>
</ul>
<div id="admonition-always" class="admonition admonish-example">
<div class="admonition-title">
<p>always</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-always"></a></p>
</div>
<div>
<p>In a model with <code>one sig Nim { var cookies: set Cookie }</code>, writing <code>always no Nim.cookies</code> expresses an alarming universal truth: from now on, Nim will never have any cookies.</p>
<p>Of course, operators like <code>always</code> can be used inside other operators. So this lamentable destiny might be avoided. E.g., <code>not always no Nim.cookies</code> would mean the reverse: at some point, Nim will in fact have cookies.</p>
</div>
</div>
<h4 id="eventually-now-or-sometime-in-the-future"><a class="header" href="#eventually-now-or-sometime-in-the-future">Eventually (now or sometime in the future)</a></h4>
<ul>
<li><code>eventually &lt;fmla&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla</code> holds in some state <code>&gt;=i</code>.</li>
</ul>
<div id="admonition-eventually" class="admonition admonish-example">
<div class="admonition-title">
<p>eventually</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-eventually"></a></p>
</div>
<div>
<p>In a model with <code>one sig Nim { var cookies: set Cookie }</code>, writing <code>eventually no Nim.cookies</code> expresses that at some point either now or in the future, Nim will lack cookies. Before and after that point, nothing prevents Nim from acquiring cookies.</p>
</div>
</div>
<h4 id="until-and-release-obligations"><a class="header" href="#until-and-release-obligations">Until and Release (obligations)</a></h4>
<ul>
<li><code>&lt;fmla-a&gt; until &lt;fmla-b&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla-b</code> holds in some state <code>j&gt;=i</code> and <code>fmla-a</code> holds in all states <code>k</code> where <code>i &lt;= k &lt; j</code>. Note that the obligation to see <code>fmla-a</code> ceases in the state where <code>fmla-b</code> holds.</li>
</ul>
<div id="admonition-until" class="admonition admonish-example">
<div class="admonition-title">
<p>until</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-until"></a></p>
</div>
<div>
<p>In a model with <code>one sig Nim { var cookies: set Cookie }</code>, writing <code>no Nim.cookies until some Nim.vegetables</code> expresses that, <em>starting at this point in time</em>, Nim must have no cookies until they also have vegetables. Once Nim obtains vegetables (including at this point in time), the obligation ends (and thus after that point Nim may have only cookies but no vegetables).</p>
</div>
</div>
<p>A natural question to ask is: what happens if <code>fmla-b</code> holds at multiple points in the future? However, this turns out not to matter: the definition says that the <code>until</code> formula is true in the current state if <code>fmla-b</code> holds at <strong>some</strong> point in the future (and <code>fmla-a</code> holds until then).</p>
<p>There is an alternative way to express obligations, which we won't use much:</p>
<ul>
<li><code>&lt;fmla-a&gt; releases &lt;fmla-b&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla-a</code> holds in some state <code>j&gt;=i</code> and <code>fmla-b</code> holds in all states <code>k</code> where <code>i &lt;= k &lt;= j</code>, or <code>fmla-a</code> never occurs in a later state and <code>fmla-b</code> holds forever after. Note that the intuitive role of the two formulas is reversed between <code>until</code> and <code>releases</code>, and that, unlike <code>until</code>, the obligation extends to the state where <code>fmla-a</code> holds.</li>
</ul>
<h3 id="past-time-ltl"><a class="header" href="#past-time-ltl">Past-time LTL</a></h3>
<p><em>Past-time</em> operators are useful for concisely expressing some constraints. They don't add more expressive power to the temporal language, but they do sometimes make it easier to avoid adding state, etc.</p>
<h4 id="previous-state"><a class="header" href="#previous-state">Previous State</a></h4>
<ul>
<li><code>prev_state &lt;fmla&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla</code> holds in state <code>i-1</code>. </li>
</ul>
<div id="admonition-there-is-nothing-before-the-first-state" class="admonition admonish-warning">
<div class="admonition-title">
<p>There is nothing before the first state</p>
<p><a class="admonition-anchor-link" href="electrum/electrum-overview.html#admonition-there-is-nothing-before-the-first-state"></a></p>
</div>
<div>
<p>The formula <code>prev_state &lt;fmla&gt;</code> is canonically false if <code>i=0</code>, since there is no prior state. This holds regardless of what <code>&lt;fmla&gt;</code> contains; <code>prev_state</code> asserts the existence of a prior state.</p>
</div>
</div>
<h4 id="historically-always-in-the-past"><a class="header" href="#historically-always-in-the-past">Historically (always in the past)</a></h4>
<ul>
<li><code>historically &lt;fmla&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla</code> holds in every state <code>&lt;=i</code>.</li>
</ul>
<h4 id="once-at-some-point-in-the-past"><a class="header" href="#once-at-some-point-in-the-past">Once (at some point in the past)</a></h4>
<ul>
<li><code>once &lt;fmla&gt;</code> is true in a state <code>i</code> if and only if: <code>fmla</code> holds in some state <code>&lt;=i</code>.</li>
</ul>
<h2 id="note-for-alloy-users"><a class="header" href="#note-for-alloy-users">Note for Alloy Users</a></h2>
<p>Alloy 6 and Electrum use the keywords <code>after</code> and <code>before</code> where Forge uses <code>next_state</code> and <code>prev_state</code>. We changed Forge to use these (admittedly more verbose) keywords in the hopes they are more clear. For example, <code>after</code> sounds like it could be a binary operator; in English, we might say &quot;turn left after 3 stops&quot;. Also, <code>next_state</code> is definitely a formula about the following state whereas <code>after</code> does not communicate the same sense of immediacy.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="cope-and-drag-cnd"><a class="header" href="#cope-and-drag-cnd">Cope and Drag (CnD)</a></h1>
<p>CnD is a midpoint between the default visualizer and full, domain-specific custom visualization. CnD gives users much more control over the default kind of visualization. One example might be a model of binary search trees: the default visualizer is free to lay out nodes so that left children go to the <em>right</em> and right children go to the <em>left</em> (or, worse, some mix of the two). In CnD, we can express that left means left, and right means right. </p>
<p>To use CnD, go to the Layout tab in sterling and click &quot;Load Layout&quot;. (Don't worry about pasting in anything here, the CnD interface is generally easier to work with directly.)</p>
<p>For more information on how to use CnD, see <a href="https://sidprasad.github.io/copeanddrag/">the latest CnD docs</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="custom-visualization-basics"><a class="header" href="#custom-visualization-basics">Custom Visualization Basics</a></h1>
<p>As seen in the <a href="sterling/../running-models/sterling-visualizer.html">Sterling Visualizer</a> section, Forge uses an adapted version of the <a href="https://sterling-js.github.io/">Sterling</a> visualization tool. One of the advantages of using Sterling is that users can create their own custom visualization scripts.</p>
<h2 id="script-view-and-modes"><a class="header" href="#script-view-and-modes">Script View and Modes</a></h2>
<p>When viewing an instance in Sterling, there are three options for viewing an instance: Graph, Table, and Script. To swap to script-view mode, click on Script. Most of the screen will be taken up by 3 new panes:</p>
<ul>
<li>the visualization canvas (blank by default); </li>
<li>the script editor; and </li>
<li>a list of available variables that are available for scripts to use.</li>
</ul>
<p>Where the &quot;Next&quot; button was in the graph visualizer, there will now be 4 more buttons: </p>
<ul>
<li>Run executes the visualization script when clicked.</li>
<li><code>&lt;div&gt;</code>, <code>&lt;canvas&gt;</code> and <code>&lt;svg&gt;</code> swap between visualization modes. The default is <code>&lt;svg&gt;</code>. 
This documentation focuses on the <code>&lt;svg&gt;</code> mode, because that is where most of the library support is. </li>
</ul>
<div id="admonition-a-basic-script" class="admonition admonish-example">
<div class="admonition-title">
<p>A Basic Script</p>
<p><a class="admonition-anchor-link" href="sterling/custom-basics.html#admonition-a-basic-script"></a></p>
</div>
<div>
<p>Try entering some visualization code in the script window and clicking &quot;Run&quot;:</p>
<pre><code>const stage = new Stage()
stage.add(new TextBox({
  text: 'Hello!', 
  coords: {x:100, y:100},
  color: 'black',
  fontSize: 16
}))
stage.render(svg, document)
</code></pre>
<p>This will create a <code>TextBox</code> in the visualization area that says &quot;Hello!&quot;.</p>
</div>
</div>
<p>Custom scripts are written in JavaScript. JavaScript constructs like looping, mapping over lists, etc. are all available for your use.</p>
<div id="admonition-javascript" class="admonition admonish-warning">
<div class="admonition-title">
<p>JavaScript</p>
<p><a class="admonition-anchor-link" href="sterling/custom-basics.html#admonition-javascript"></a></p>
</div>
<div>
<p>At the moment (February 2023), the script editor works only with &quot;vanilla&quot; JavaScript; Sterling will not run (e.g.) a TypeScript compiler on the code. Moreover, importing external libraries is somewhat restricted.</p>
</div>
</div>
<h2 id="working-with-an-instance"><a class="header" href="#working-with-an-instance">Working with an Instance</a></h2>
<p>Sterling uses a number of JavaScript classes to represent an instance. <a href="https://alloy-js.github.io/alloy-ts/">The <code>alloy-ts</code> library documentation</a> describes these in more detail, but you should be aware of the following:</p>
<h3 id="the-instance"><a class="header" href="#the-instance">The Instance</a></h3>
<p>The <code>instance</code> variable provides access to the current instance. If temporal mode is active, <code>instance</code> will refer to the current state; to get the entire list of states, use <code>instances</code> instead (which is only available in temporal mode). </p>
<h3 id="accessing-sigs-and-fields"><a class="header" href="#accessing-sigs-and-fields">Accessing Sigs and Fields</a></h3>
<p>You can use the <code>.signature(name)</code> method of an instance to obtain an object representing a <code>sig</code> in the instance. Likewise, <code>.field(name)</code> will yield an object representing a particular field. </p>
<div id="admonition-a-basic-script-1" class="admonition admonish-example">
<div class="admonition-title">
<p>A Basic Script</p>
<p><a class="admonition-anchor-link" href="sterling/custom-basics.html#admonition-a-basic-script-1"></a></p>
</div>
<div>
<p>If you're viewing an instance of the <a href="https://csci1710.github.io/2023/livecode/feb15_feb17_binarysearch.frg">binary search model</a> from class, you can run this script directly. (If you use this model, uncomment the <code>run</code> at the bottom of the file!)</p>
<pre><code>const stage = new Stage()
stage.add(new TextBox({
  text: `${instance.signature('IntArray')}`, 
  coords: {x:100, y:100},
  color: 'black',
  fontSize: 16
}))
stage.render(svg, document)
</code></pre>
<p>This will create a <code>TextBox</code> in the visualization area whose text is a string representation of the <code>Int</code> sig in whatever instance you're viewing. The string won't be very useful yet; it will be something like &quot;[IntArray]&quot;. Next, change <code>instance.signature('IntArray')</code> to <code>instance.signature('IntArray').atoms()[0]</code>---the first (and in this case, only) <code>IntArray</code> object in the instance. You'll see the sig name become an object id like <code>[IntArray0]</code>.</p>
<p>All <code>IntArray</code> objects have an <code>elements</code> field. We can get access to the field and print its contents by <em>joining</em> the object to its field:</p>
<pre><code>const stage = new Stage()
const theArray = instance.signature('IntArray').atoms()[0]
const elementsField = instance.field('elements')
stage.add(new TextBox({
  text: `${theArray.join(elementsField)}`, 
  coords: {x:100, y:100},
  color: 'black',
  fontSize: 16}))
stage.render(svg, document)
</code></pre>
<p>This should display something like &quot;1, 7 2, 7 3, 7 4, 7 5, 7 6, 7 7, 7&quot;. Again, not very useful. Sterling is printing the contents of the array in <code>index,value</code> form, but separating elements with space. We can fix this, though!</p>
</div>
</div>
<hr />
<h2 id="built-in-library-shapes"><a class="header" href="#built-in-library-shapes">Built-in Library Shapes</a></h2>
<p>Scripts in <code>&lt;svg&gt;</code> mode use the <a href="https://d3-graph-gallery.com/graph/shape.html">D3 visualization library</a> by default. However, D3 can be fairly complex to use, and so various <a href="sterling/./d3fx.html">built-in helpers</a> are also available. We encourage using the helper library, although in more advanced cases you may wish to use D3 directly.</p>
<hr />
<h2 id="potential-pitfalls-and-debugging"><a class="header" href="#potential-pitfalls-and-debugging">Potential Pitfalls and Debugging</a></h2>
<p>Sterling presents a &quot;full Forge&quot; view of instances, and one that's closer to the way the solver works. All sigs and fields are represented as <em>sets</em> in the instance. Each set contains <code>AlloyTuple</code> objects, which themselves contain lists of <code>AlloyAtom</code>s. Because (at the moment) there is no support for types in the script editor, it can sometimes be troublesome to remember which kind of datum you're working with. The <code>alloy-ts</code> docs below provide much more detail, but in brief:</p>
<ul>
<li>if the object has an <code>.atoms()</code> method, it's an <code>AlloyTuple</code>;</li>
<li>if the object has an <code>.id()</code> method, it's an <code>AlloyAtom</code>; and</li>
<li>signatures, fields, tuples, and atoms are all <code>AlloySets</code> and provide a <code>.tuples()</code> method.</li>
</ul>
<p>In order to do a Froglet-style field access, you should use the <code>.join</code> method. (E.g., in the example above, we wrote <code>theArray.join(elementsField)</code> rather than <code>theArray.elementsField</code> or <code>theArray.elements</code>.)</p>
<p>We suggest using <code>TextBox</code>es to visualize debugging information. As a fallback, you can also use <code>console.log(...)</code> as normally in JavaScript, but the web-developer console in Sterling can be somewhat congested. Printing raw <code>AlloySet</code> objects via <code>console.log</code> will also not be immediately useful, since Sterling uses a proxy to manage the difference between the set as <em>Forge syntax</em> and the set as <em>a value in the instance</em>.</p>
<hr />
<h2 id="further-resources-and-examples"><a class="header" href="#further-resources-and-examples">Further Resources and Examples</a></h2>
<p>Further chapters:</p>
<ul>
<li><a href="sterling/./d3fx_apr23.html">Visualization Helper Library</a> describes helpers (e.g., text boxes, grids, etc.) for visualization that don't require D3 knowledge.</li>
<li><a href="sterling/./svg-tips.html">Working with SVG and Imports</a> explains how to (e.g.) increase the size of the rendering area.</li>
</ul>
<p>External resources:</p>
<ul>
<li><a href="https://www.w3schools.com/graphics/svg_intro.asp">What is the SVG format?</a></li>
<li><a href="https://docs.google.com/document/d/10pqJuWVp6ap-6JoEE5nDqrCKFpYcuzN81oItnYO3yS4/edit#heading=h.4p6wkcmc113e">D3FX helpers design documentation</a>---<strong>beware, this is actively being worked on and edited, and thus subject to change!</strong></li>
</ul>
<p>Examples using D3:</p>
<ul>
<li><a href="https://github.com/miasantomauro/lets-get-visual">Mia Santomauro's 2021 Guide</a> for custom visualization in Forge is still useful, but was made before most of the helper functions and classes above existed. If you're interested in using D3 directly with Sterling, it's a great starting point.</li>
<li>Tim's 2022 visualizer script examples also use D3 directly, rather than leveraging helpers, but may also be a useful reference:
<ul>
<li><a href="https://github.com/csci1710/public-examples/tree/main/2022/sudoku_opt_viz">Sudoku Synthesizer</a></li>
<li><a href="https://github.com/csci1710/public-examples/tree/main/2022/queue">Queue</a></li>
<li><a href="https://github.com/csci1710/public-examples/tree/main/2022/lights_puzzle">Lights Puzzle (temporal mode)</a> </li>
</ul>
</li>
<li>Tim and Mia also wrote a <a href="https://github.com/miasantomauro/mia-isp-spring-2021/tree/main/musical%20scales">&quot;visualizer&quot; that plays musical scales</a> generated by a model Tim wrote to understand music a bit better.</li>
</ul>
<div id="admonition-collaborators" class="admonition admonish-note">
<div class="admonition-title">
<p>Collaborators</p>
<p><a class="admonition-anchor-link" href="sterling/custom-basics.html#admonition-collaborators"></a></p>
</div>
<div>
<p>Work on custom visualization in Sterling is an ongoing collaborative effort. We are grateful to Tristan Dyer for working to expand Sterling for Forge. We are also grateful for contributions from (in alphabetic order):</p>
<ul>
<li>Ethan Bove</li>
<li>Sidney LeVine</li>
<li>Mia Santomauro</li>
</ul>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="d3fx-helpers"><a class="header" href="#d3fx-helpers">D3FX Helpers</a></h1>
<p>The D3FX helpers library was designed as an interface between Sterling users and the D3 visualization library in Javascript. D3 was originally the primary way that Forge users wrote custom visualizations. However, we have found that using D3 in Sterling can involve a large amount of learning and prep time--especially for those without much experience with JavaScript.</p>
<p>D3FX was created to ease writing custom visualizations in Sterling. It contains a library of shapes and objects that were commonly used in the past, such as grid layouts and labeled arrows. Since custom visualizations are still written in JavaScript, using D3FX requires some knowledge of the language, but its object-oriented design is meant to ease basic use for those who might be familiar with languages like Java or Python.</p>
<p>This page contains documentation for all classes in D3FX, along with small examples of how to create and work with them. Complete, runnable examples can be found in the Forge repository's <a href="https://github.com/tnelson/Forge/tree/dev/viz-examples"><code>viz-examples</code> directory</a>. </p>
<div id="admonition-warning" class="admonition admonish-warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-warning"></a></p>
</div>
<div>
<p>There has been one major change in the library since the start of Spring 2023. Constructors now take a single object, rather than a varying number of parameters. This makes it easier to add new parameters without breaking existing code, and avoids confusion about how to order parameters. However, this required a one-time breaking change. </p>
<p>If you've already written some visualizations based on the old method, converting should be easy. For example, our Dining Smiths lab visualization created a new text box with: </p>
<pre><code>new TextBox(`State:${idx}${lb}`,{x:0,y:0},'black',16)
</code></pre>
<p>This would need to be updated to :</p>
<pre><code>new TextBox({text: `State:${idx}${lb}`, coords: {x:0,y:0}, color: 'black', fontSize: 16})
</code></pre>
</div>
</div>
<h2 id="further-resources"><a class="header" href="#further-resources">Further Resources</a></h2>
<p>In addition to this page, you can view supplementary examples in the Forge repository <a href="https://github.com/tnelson/Forge/tree/dev/viz-examples">here</a>. Each contains both a Forge model to run (<code>.frg</code>) and the corresponding script file (<code>.js</code>).</p>
<h2 id="the-stage-and-visualobjects"><a class="header" href="#the-stage-and-visualobjects">The <code>Stage</code> and <code>VisualObjects</code></a></h2>
<p>Every element D3FX displays on the screen is represented by a <code>VisualObject</code>, which includes shapes like squares or circles, as well as more complicated objects like grids or trees.</p>
<p>To render visual objects, a <code>Stage</code> object needs to be created to contain them. After creating, the user can call <code>stage.add(...)</code> to place the visual object in the stage. To render all added <code>VisualObject</code>s, call <code>stage.render(...)</code>. Below is some important information for interacting with these objects, specifically for those without JavaScript experience.</p>
<div id="admonition-note" class="admonition admonish-note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-note"></a></p>
</div>
<div>
<p>Most commonly, <code>render</code> takes two parameters which are already defined in the script environment: <code>stage.render(svg, document)</code>.</p>
</div>
</div>
<h3 id="props-and-optional-parameters"><a class="header" href="#props-and-optional-parameters">Props and Optional Parameters</a></h3>
<p>All <code>VisualObject</code>s will take in a <em>props</em> (short for &quot;properties&quot;) object. Props objects have a number of fields with designated types. These fields can be entered in any order with their corresponding names. For example:</p>
<pre><code>new Rectangle({
    height: 100,
    width: 200,
    coords: {x: 100, y: 50},
    color: 'red',
    label: 'Hello'
})
</code></pre>
<p>For ease of use, we've written out a template for each of these props objects in terms of an <code>interface</code>, like the following:</p>
<pre><code>interface Coords {
    x: number,
    y: number
}
</code></pre>
<p>Fields in such interface declarations may include a <code>?</code>. This denotes that the field is <em>optional</em>.</p>
<div id="admonition-warning-1" class="admonition admonish-warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-warning-1"></a></p>
</div>
<div>
<p>While these definitions are useful tools, and these <code>interface</code> structures do exist in TypeScript (the language we wrote D3FX in), they <strong>do not</strong> exist in the raw JavaScript you'll use to write your visualizations! </p>
<p>That said, instantiating a props object with <code>{field1: value, field2: value, ...}</code> will still be understood by the library as if JavaScript understood this wider interface system. Just don't include types, or try to reference the interfaces directly.</p>
</div>
</div>
<div id="admonition-note-1" class="admonition admonish-note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-note-1"></a></p>
</div>
<div>
<p>When implementing one of the classes listed later on, you may be prompted with a type hint of the form <code>text: string | () =&gt; string</code>. This means that the field <code>text</code> can take in either or a string, or an anonymous funtion that produces a string. For simple use, you can more or less ignore this distinction, and choose only to pass in a string. For ease of reading, any type of this form (<code>T | () =&gt; T</code>) has been collapsed to just <code>T</code> in all library documentation.</p>
</div>
</div>
<h2 id="primitive-objects"><a class="header" href="#primitive-objects">Primitive Objects</a></h2>
<p>A <em>primitive</em> object is one that doesn't visually contain any other D3FX objects. </p>
<h3 id="textbox"><a class="header" href="#textbox"><code>TextBox</code></a></h3>
<p>Text boxes render text to the screen at a given location. Their constructor accepts a props object of the following form:</p>
<pre><code>interface TextBoxProps {
    text? : string,
    coords?: Coords,
    color?: string,
    fontSize?: number
}
</code></pre>
<p>Here is an example <code>TextBox</code> using these props:</p>
<pre><code>let text = new TextBox({
    text: 'hello',
    coords: {x: 50, y:50},
    color: 'black',
    fontSize: 12
}) 
</code></pre>
<div id="admonition-note-2" class="admonition admonish-note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-note-2"></a></p>
</div>
<div>
<p>All parameters can be changed after initiation with corresponding setter methods. These methods are in the typical OO style of <code>setX(newValue: Type)</code>, and should be suggested by the text editor for ease of use.</p>
</div>
</div>
<p>Additionally, <code>TextBox</code> supports script-defined callbacks. You can register <em>events</em> using the <code>events</code> prop. Supported events are described <a href="https://developer.mozilla.org/en-US/docs/Web/Events">here</a>.</p>
<div id="admonition-textbox-with-events" class="admonition admonish-example">
<div class="admonition-title">
<p>TextBox with events</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-textbox-with-events"></a></p>
</div>
<div>
<pre><code>new TextBox({
    text: 'hello',
    coords: {x: 50, y:50},
    color: 'black',
    fontSize: 12,
    events: [
        {event: 'click', callback: () =&gt; {console.log('clicked!')}}
    ]
}) 
</code></pre>
</div>
</div>
<h3 id="imagebox"><a class="header" href="#imagebox">ImageBox</a></h3>
<p>An <code>ImageBox</code> contains an image loaded from a URL. </p>
<div id="admonition-imagebox" class="admonition admonish-example">
<div class="admonition-title">
<p>ImageBox</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-imagebox"></a></p>
</div>
<div>
<pre><code>const stage = new Stage()
const box = new ImageBox({
    coords: {x:100,y:100}, 
    url: &quot;https://csci1710.github.io/2024/static/media/LFS_FROG.8de0a0795d10898e5fe9.png&quot;, 
    width:200, 
    height:200})
stage.add(box)
stage.render(svg)
</code></pre>
</div>
</div>
<h3 id="primitive-shapes"><a class="header" href="#primitive-shapes">Primitive Shapes</a></h3>
<p>The primitive object types <code>Rectangle</code>, <code>Circle</code>, and <code>Polygon</code> are all instances of a wider class called <code>Shape</code>. As a result, their props objects all implement the following interface:</p>
<pre><code>interface ShapeProps {
  color?: string,
  borderWidth?: number,
  borderColor?: string,
  label?: string,
  labelColor?: string,
  labelSize?: number,
  opacity?: number
}
</code></pre>
<p>For ease of reading, these fields will be rewritten later on where applicable.</p>
<h4 id="rectangle"><a class="header" href="#rectangle"><code>Rectangle</code></a></h4>
<p>Rectangles take in a pair of coordinates corresponding to the top left corner of the shape, along with a width and height. The props object is of the following form:</p>
<pre><code>interface RectangleProps extends shape {
    height: number,
    width: number,
    labelLocation?: string,
    coords?: Coords,

    // Borrowed from shape
    color?: string,
    borderWidth?: number,
    borderColor?: string,
    label?: string,
    labelColor?: string,
    labelSize?: number,
    opacity?: number
}
</code></pre>
<p>The value of <code>label-location</code> can be <code>&quot;center&quot;</code> (default). Other options include <code>&quot;topLeft&quot;</code>, <code>&quot;topRight&quot;</code>, <code>&quot;bottomLeft&quot;</code>, and <code>&quot;bottomRight&quot;</code>, which will generate text outside the rectangle in these locations. </p>
<p>Here is an example <code>Rectangle</code> using these props:</p>
<pre><code>let rect = new Rectangle({
    coords: {x: 100, y:100},
    height: 20,
    width: 20,
    color: &quot;pink&quot;,
    borderColor: &quot;black&quot;,
    borderWidth: 2,
    label: &quot;5&quot;
})
</code></pre>
<p>Which renders the following:</p>
<p><img src="sterling/../images/d3-examples/rectangle.png" alt="Small, light blue circle." /></p>
<h4 id="circle"><a class="header" href="#circle"><code>Circle</code></a></h4>
<p>Circles take in a pair of coordinates as the center and a radius, along with the rest of the following props object:</p>
<pre><code>interface CircleProps extends ShapeProps {
    radius: number,

    // Borrowed from shape
    color?: string,
    borderWidth?: number,
    borderColor?: string,
    label?: string,
    labelColor?: string,
    labelSize?: number,
    opacity?: number
}
</code></pre>
<p>The text in the <code>label</code> will render in the center of the circle. Here is an example circle:</p>
<pre><code>let circ = new Circle({
    radius: 10, 
    center: {x: 100, y:100}, 
    color: 'aqua', 
    borderWidth: 2, 
    borderColor: 'black', 
}); 
</code></pre>
<p>Which renders the following:</p>
<p><img src="sterling/../images/d3-examples/circle.png" alt="Small, light blue circle." /></p>
<h4 id="polygon"><a class="header" href="#polygon"><code>Polygon</code></a></h4>
<p>Polygons are the most generic of the primitive shapes offered in D3FX. They take in any list of points and create a shape with those points on the perimeter. The props are of the form:</p>
<pre><code>export interface PolygonProps extends ShapeProps {
    points: Coords[]

    // Borrowed from shape
    color?: string,
    borderWidth?: number,
    borderColor?: string,
    label?: string,
    labelColor?: string,
    labelSize?: number,
    opacity?: number
}
</code></pre>
<p>The label will be generated in roughly the center of the shape (the mean of the points entered). Here is an example of a polygon being used to create a (nonconvex) pentagon. </p>
<pre><code>polypoints = [
    {x:100, y:200},
    {x:200, y:200},
    {x:175, y:150},
    {x:200, y:100},
    {x:100, y:100}
]

let poly = new Polygon({
    points: polypoints, 
    color: 'orange', 
    borderWidth: 2, 
    borderColor: 'black', 
    label: &quot;Hi!&quot;,
    labelColor: &quot;black&quot; ,
    opacity: 0.7
});
</code></pre>
<p>Which will render the following pentagon:</p>
<p><img src="sterling/../images/d3-examples/polygon.png" alt="Concave pentagon labelled 'Hi!'." /></p>
<h4 id="line"><a class="header" href="#line"><code>Line</code></a></h4>
<p>A <code>Line</code> takes in a series of points and creates a line passing through said points. </p>
<pre><code>interface LineProps {
  points?: Coords[], 
  arrow?: boolean,
  color?: string, 
  width?: number,
  opacity?: number
  style?: string
}
</code></pre>
<p>If <code>arrow</code> is true, the end of the line will have a small arrowhead. Style can take the values of <code>'dotted'</code> or <code>'dashed'</code>Here's an example line:</p>
<pre><code>polypoints = [
    {x:100, y:100},
    {x:125, y:100},
    {x:150, y:75},
    {x:200, y:125},
    {x:225, y:100},
    {x:250, y:100}
]

let line = new Line({
    points: polypoints, 
    color: 'black', 
    width: 2, 
    labelColor: &quot;blue&quot;,
    arrow: true,
    style: &quot;dotted&quot;
});
</code></pre>
<p>Which will render:</p>
<p><img src="sterling/../images/d3-examples/line.png" alt="Jagged, dotted line with an arrowhead." /></p>
<h2 id="compound-objects"><a class="header" href="#compound-objects">Compound Objects</a></h2>
<p>While the above objects are good for simple visualizations, managing the relationship between many primitive objects manually can be difficult.  With this in mind, D3FX provides a number of <em>compound</em> objects, which automatically group their child objects in a particular way. </p>
<div id="admonition-warning-2" class="admonition admonish-warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-warning-2"></a></p>
</div>
<div>
<p>Compound objects are responsible for rendering their children. If an object is a child of another object, don't <code>add</code> it to the stage as well. If you do so, there may be unexpected consequences when rendering, since the child object would then be rendered twice in two different contexts.</p>
<p>In other words, avoid code like the following:</p>
<pre><code>circ = new Circle({...})
comp = new SomeCompoundObject({innerObject: circ, ...}) // circ is a child object

stage.add(comp) // the stage will render comp, which then renders its child circ
stage.add(circ) // the stage will render circ (again)
</code></pre>
</div>
</div>
<h3 id="grid"><a class="header" href="#grid"><code>Grid</code></a></h3>
<p>Grids place visual objects into a 2-dimensional arrangement of cells. The grid constructor takes in the following props:</p>
<pre><code>interface gridProps {
    grid_location: Coords, // Top left corner
    cell_size:{
        x_size:number,
        y_size:number
    },
    grid_dimensions:{
        x_size:number,
        y_size:number
    },
}
</code></pre>
<p>The <code>grid_dimensions</code> field should be a pair of positive integers, referring to the horizontal and vertical capacity of the array, respectively. The <code>cell_size</code>, in pixels, will be the size allocated for each of these objects in the rendered grid. Grids also offer the <code>add</code> method to fill these cells with <code>VisualObject</code>s:</p>
<pre><code>add(
    coords: Coords, 
    add_object:VisualObject, 
    ignore_warning?:boolean
)
</code></pre>
<p>The coordinates should be integers designating which row and column of the grid to add the child object to. Notably, <em>the child object's visual location will immediately be adjusted to fit the cell.</em></p>
<p>Adding a child object will produce an error if the child object does not fit into the given cell. To ignore this error, set the <code>ignore_warning</code> prop to true. </p>
<p>Here is an example of a simple grid:</p>
<pre><code>let grid = new Grid({
    grid_location: {x: 50, y:50},
    cell_size: {x_size: 30, y_size: 30},
    grid_dimensions: {x_size: 4, y_size: 5}
})

grid.add({x: 0, y: 1}, new Circle({radius: 10, color: &quot;red&quot;}))
grid.add({x: 3, y: 3}, new Circle({radius: 10, color: &quot;blue&quot;}))
</code></pre>
<p>Here we have a 4x4 grid of 30x30 pixel squares, into two of which we place circles. Note that the circles added to the grid do not have coordinates. This is because the coordinates of these shapes are immediately changed to be in the center of the given squares in the grid. This renders as follows:</p>
<p><img src="sterling/../images/d3-examples/grid.png" alt="Example grid with circles at (0, 1) and (3, 3)." /></p>
<h3 id="tree"><a class="header" href="#tree"><code>Tree</code></a></h3>
<p>The <code>Tree</code> object renders a branching data structure. While in principle Sterling's default visualization can produce trees, the <code>Tree</code> object in D3FX allows a finer degree of control. </p>
<p>The nodes in a <code>Tree</code> object are themselves visual objects, which will then automatically be rendered with lines between them. The props for <code>Tree</code> are as follows:</p>
<pre><code>interface TreeProps {
    root: VisTree, 
    height: number, 
    width: number, 
    coords?: Coords, 
    edgeColor?: string, 
    edgeWidth?: number
}
</code></pre>
<p>Where the <code>VisTree</code> interface logically represents a tree and its subtrees in recursive fashion:</p>
<pre><code>interface VisTree{
    visualObject: VisualObject,
    children: VisTree[]
}
</code></pre>
<p>When rendered, the tree will be adjusted to exactly fit into the box with top-left corner designated by <code>coords</code> and dimensions designated by <code>height</code> and <code>width</code>. Here is an example tree with four layers:</p>
<pre><code>let obj1 = new Circle({radius: 10, color: 'red', borderColor: &quot;black&quot;, label: '1'});
let obj2 = new Circle({radius: 10, color: 'red', borderColor: &quot;black&quot;, label: '2'});
let obj3 = new Rectangle({height: 20, width: 20, color: 'green', borderColor: &quot;black&quot;, label: '3'});
let obj4 = new Circle({radius: 10, color: 'red', borderColor: &quot;black&quot;, label: '4'});
let obj5 = new Circle({radius: 10, color: 'red', borderColor: &quot;black&quot;, label: '5'});
let obj6 = new Circle({radius: 10, color: 'red', borderColor: &quot;black&quot;, label: '6'});
let obj7 = new Circle({radius: 10, color: 'blue', borderColor: &quot;black&quot;, label: '7'});
let obj8 = new Circle({radius: 10, color: 'blue', borderColor: &quot;black&quot;, label: '8'});

let visTree = {
  visualObject: obj1,
  children: [
    {
      visualObject: obj2,
      children: [
        { visualObject: obj4, children: [] },
        {
          visualObject: obj5,
          children: [{ visualObject: obj8, children: [] }]
        },
        { visualObject: obj7, children: [] }
      ]
    },
    {
      visualObject: obj3,
      children: [{ visualObject: obj6, children: [] }]
    }
  ]
};

let tree = new Tree({
    root: visTree, 
    height: 200, 
    width: 200, 
    coords: { x: 100, y: 100 }
    });
</code></pre>
<p>which renders as:</p>
<p><img src="sterling/../images/d3-examples/tree.png" alt="A rendering of a grid with 7 circles and 1 square, arranged as stated in the code." /></p>
<h3 id="edge"><a class="header" href="#edge"><code>Edge</code></a></h3>
<p>Edges display relationships between objects, without requiring manual management of those objects' locations---unlike the primitive <code>Line</code>. Edge objects take in the following props:</p>
<pre><code>export interface EdgeProps {
  obj1: VisualObject;
  obj2: VisualObject;
  lineProps: LineProps;
  textProps: TextBoxProps;
  textLocation: string;
}
</code></pre>
<p>Here, <code>obj1</code> represents the first visual object, or the source of the edge, and <code>obj2</code> is the sink. Styling, color, width, and more attributes of the edge itself can be designated in <code>lineProps</code>, which contains all the information that would normally be passed to a <code>Line</code>.  Similarly, the label for the line is designated by <code>textProps</code>, which supports all relevant features used in the label's underlying <code>TextBox</code> object.</p>
<div id="admonition-warning-3" class="admonition admonish-warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="sterling/d3fx_apr23.html#admonition-warning-3"></a></p>
</div>
<div>
<p>Unlike with other compound objects, <code>Edge</code> <em>does not</em> render its children. This is because each object should only be rendered once, but an object might be referenced by multiple edges, such as in visualizing a graph. </p>
<p>Thus, the objects that an edge spans must still be added to the stage, or to some other appropriate and unique container.</p>
</div>
</div>
<p>Lastly, <code>textLocation</code> allows for freedom in determining the location of the label. By default, the label will appear in the exact center of the line. However, passing in <code>right</code>, <code>left</code>, <code>above</code>, or <code>below</code> will offset the location by whatever orthogonal direction closest to the input. There is also support for <code>clockwise</code> or <code>counterclockwise</code>, which place the label in the stated location from the perspective of the source object. Here is an example of a few edges between visualObjects:</p>
<pre><code>const rect = new Rectangle({width: 20, height: 20, coords: {x:200, y:50}})
const circ1 = new Circle({radius: 10, center: {x:150, y:200}})
const circ2 = new Circle({radius: 10, center: {x:250, y:200}})

const edge1 = new Edge({
    obj1: rect, obj2: circ1,
    textProps: {text: &quot;e1&quot;, fontSize: 11},
    textLocation: &quot;above&quot;
})
const edge2 = new Edge({obj1: circ1, obj2: rect,
    textProps: {text: &quot;e2&quot;, fontSize: 11},
    textLocation: &quot;below&quot;})
const edge3 = new Edge({obj1: circ1, obj2: circ2,
    textProps: {text: &quot;e3&quot;, fontSize: 11},
    lineProps: {color: &quot;green&quot;},
    textLocation: &quot;above&quot;})
const edge4 = new Edge({obj1: rect, obj2: circ2,
    lineProps: {arrow: true},
    textProps: {text: &quot;e4&quot;, fontSize: 11},
    textLocation: &quot;above&quot;})

// Adding all objects and circles to the stage individually before rendering. 
</code></pre>
<p>This renders as:</p>
<p><img src="sterling/../images/d3-examples/edges.png" alt="A rendering of a rectangle and two circles, with edges between them as specified in the above code." /></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="working-with-svg"><a class="header" href="#working-with-svg">Working with SVG</a></h1>
<h2 id="expanding-the-svg-region"><a class="header" href="#expanding-the-svg-region">Expanding the SVG Region</a></h2>
<p>If the default <code>svg</code> area is not the right size for your needs, you can change its dimensions. </p>
<p>The <code>&lt;svg&gt;</code> element that scripts render to is contained within an element called <code>svg-container</code>, whose only child is the render area. Thus, the render area can be obtained with:</p>
<pre><code>const renderArea = document.getElementById('svg-container').getElementsByTagName('svg')[0]
</code></pre>
<p>You can then set the <code>style.width</code> and <code>style.height</code> attributes of the rendering area. </p>
<div id="admonition-changing-the-rendering-area-size" class="admonition admonish-example">
<div class="admonition-title">
<p>Changing the rendering area size</p>
<p><a class="admonition-anchor-link" href="sterling/svg-tips.html#admonition-changing-the-rendering-area-size"></a></p>
</div>
<div>
<p>This code changes the available space in the <code>&lt;svg&gt;</code> element, giving us 5 times the original vertical space to work with: </p>
<pre><code>const svgContainer = document.getElementById('svg-container')
svgContainer.getElementsByTagName('svg')[0].style.height = '500%'
svgContainer.getElementsByTagName('svg')[0].style.width = '100%'
</code></pre>
</div>
</div>
<div id="admonition-resizing-in-the-script" class="admonition admonish-warning">
<div class="admonition-title">
<p>Resizing in the script</p>
<p><a class="admonition-anchor-link" href="sterling/svg-tips.html#admonition-resizing-in-the-script"></a></p>
</div>
<div>
<p>If you're using the helper library, you may need to resize <em>after</em> calling <code>stage.render</code>.</p>
</div>
</div>
<h3 id="alternative-method"><a class="header" href="#alternative-method">Alternative Method</a></h3>
<p>You also have access to set the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox"><code>viewBox</code> attribute</a> of the <code>&lt;svg&gt;</code> region. However, we don't suggest making this specific kind of low-level change if you're working only with D3FX.</p>
<div id="admonition-1000-by-1000-viewbox" class="admonition admonish-example">
<div class="admonition-title">
<p>1000 by 1000 viewbox</p>
<p><a class="admonition-anchor-link" href="sterling/svg-tips.html#admonition-1000-by-1000-viewbox"></a></p>
</div>
<div>
<pre><code>require('d3')
d3.select(svg).attr(&quot;viewBox&quot;, &quot;0 0 1000 1000&quot;)
</code></pre>
</div>
</div>
<h2 id="importing-modules"><a class="header" href="#importing-modules">Importing modules</a></h2>
<p>Sterling uses the <a href="https://github.com/d3/d3-require"><code>d3-require</code></a> and <a href="https://www.jsdelivr.com/">jsdelivr</a> systems to import external libraries. These should be given in the first lines of the script (before any comments!) and be enclosed in a single <code>require</code> form per library. E.g., to import the <code>d3-array</code> and <code>d3-format</code> libraries:</p>
<pre><code>require(&quot;d3-array&quot;)
require(&quot;d3-format&quot;)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="attribute-based-access-control"><a class="header" href="#attribute-based-access-control">Attribute-Based Access Control</a></h1>
<p>The Attribute-Based Access Control (ABAC) language can be enabled via <code>#lang forge/domains/abac</code> on the first line of a file. The syntax of the language is totally distinct from Froglet, Relational Forge, and Temporal forge. </p>
<h2 id="purpose"><a class="header" href="#purpose">Purpose</a></h2>
<p>ABAC policies describe whether <em>requests</em> should be permitted or denied. Requests comprise three <em>variables</em>:</p>
<ul>
<li><code>s</code>: the subject (i.e., the individual or program making the request);</li>
<li><code>a</code>: the action (i.e., the type of access being requested); and</li>
<li><code>r</code>: the resource (i.e., the file or other object being acted upon by the request).</li>
</ul>
<div id="admonition-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="dsl/abac.html#admonition-example"></a></p>
</div>
<div>
<pre><code>policy original
  // Administrators can read and write anything
  permit if: s is admin, a is read.
  permit if: s is admin, a is write.
  // Files being audited can't be changed by customers
  deny   if: a is write, r is file, r is under-audit.
  // Customers have full access to files they own
  permit if: s is customer, a is read, r is owned-by s.
  permit if: s is customer, a is write, r is owned-by s.
end;
</code></pre>
</div>
</div>
<h2 id="policy-syntax"><a class="header" href="#policy-syntax">Policy Syntax</a></h2>
<p>A policy declaration comprises a name and a set of a rules. The form is:</p>
<pre><code>policy &lt;NAME&gt;
  &lt;RULE1&gt;
  &lt;RULE2&gt;
  ...
end;
</code></pre>
<h2 id="rule-syntax"><a class="header" href="#rule-syntax">Rule Syntax</a></h2>
<p>A rule contains a decision and a sequence of conditions, terminated by a period. </p>
<pre><code>&lt;DECISION&gt; if: &lt;CONDITION1&gt;, &lt;CONDITION2&gt;, ... .
</code></pre>
<p>Decisions may be either:</p>
<ul>
<li><code>permit</code>; or </li>
<li><code>deny</code>. </li>
</ul>
<h2 id="condition-syntax"><a class="header" href="#condition-syntax">Condition Syntax</a></h2>
<p>Finally, a condition expresses a requirement involving one of the three request variables. If the condition involves only one variable, it takes the form <code>&lt;var&gt; is &lt;attribute&gt;</code>. If the condition involves two variables, it takes the form <code>&lt;var 2&gt; is &lt;attribute&gt; &lt;var 2&gt;</code>.</p>
<p>For the moment, the ABAC language is built for a specific assignment. Thus, the vocabulary of the language is restricted to the following attributes: </p>
<ul>
<li>for subjects: <code>admin</code>, <code>accountant</code>, and <code>customer</code>;</li>
<li>for actions: <code>read</code> and <code>write</code>;</li>
<li>for resources: <code>file</code>. </li>
<li>for resources (not exclusive with <code>file</code>): <code>under-audit</code>.</li>
<li>for combinations of subject and resource: <code>owned-by</code>.</li>
</ul>
<h2 id="analysis-commands"><a class="header" href="#analysis-commands">Analysis Commands</a></h2>
<p>For the purposes of this assignment, only one command should be necessary:</p>
<h3 id="comparing-policies"><a class="header" href="#comparing-policies">Comparing Policies</a></h3>
<p>The <code>compare</code> command uses Forge to run a &quot;semantic diff&quot; on two policies. It will produce a single scenario that describes a request where the two policies differ in their decisions, along with which rule applied to cause the difference. </p>
<p>Like policies, commands must be terminated with a semicolon. </p>
<div id="admonition-comparing-two-policies" class="admonition admonish-example">
<div class="admonition-title">
<p>Comparing two policies</p>
<p><a class="admonition-anchor-link" href="dsl/abac.html#admonition-comparing-two-policies"></a></p>
</div>
<div>
<p>To compare two policies named <code>original</code> and <code>modified</code>:</p>
<pre><code>compare original modified;
</code></pre>
<p>In this case, the output might resemble:</p>
<pre><code>Comparing policies original and modified...

-----------------------------------
Found example request involving...
a subject &lt;s&gt; that is:  Accountant, Employee
an action &lt;a&gt; that is:  Read
a resource &lt;r&gt; that is: File
Also,
  &lt;r&gt; is Audit

This rule applied in the second policy:
    permit if: s is accountant, a is read, r is under-audit.
Decisions: modified permitted; original denied
</code></pre>
<p>This indicates that the two policies aren't equivalent. Furthermore, a request
from an accountant to read a file that is under audit will be handled differently
by the two policies---demonstrating the inequivalence.</p>
</div>
</div>
<h3 id="other-commands"><a class="header" href="#other-commands">Other Commands</a></h3>
<ul>
<li><code>info</code> prints the names of policies currently defined. </li>
<li><code>query</code> can query the behavior of a single policy given a condition. </li>
</ul>
<div id="admonition-an-example-query" class="admonition admonish-example">
<div class="admonition-title">
<p>An example query</p>
<p><a class="admonition-anchor-link" href="dsl/abac.html#admonition-an-example-query"></a></p>
</div>
<div>
<p>To ask for scenarios where the <code>original</code> policy permits a request
involving someone who is not an administrator:</p>
<pre><code>query original yields permit where s is not admin;
</code></pre>
</div>
</div>
<h2 id="implementation-notes"><a class="header" href="#implementation-notes">Implementation Notes</a></h2>
<p>At the moment, there is no way to get <em>another</em> example from <code>compare</code> or <code>query</code>; in practice it would be implemented the same way that Forge's &quot;next&quot; button is. </p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<p>This glossary is meant to cover terms that aren't easily searched for via the search bar. E.g., it lists &quot;arity&quot; but not specific Forge language constructs like <code>pred</code> or <code>sig</code>. </p>
<h2 id="terms"><a class="header" href="#terms">Terms</a></h2>
<p>The <em>arity</em> of a relation is the number of columns in the relation; that is, the number of elements of a tuple in that relation. </p>
<p>An <em>atom</em> is a distinct object within an instance. </p>
<p>An <a href="https://csci1710.github.io/forge-documentation/building-models/overview.html"><em>instance</em></a> is a concrete scenario that abides by the rules of a model, containing specific <em>atoms</em> and their relationships to each other.</p>
<p>A <a href="https://csci1710.github.io/forge-documentation/building-models/overview.html"><em>model</em></a> is a representation of a system. In Forge, a model comprises a set of <code>sig</code> and <code>field</code> definitions, along with constraints.</p>
<h2 id="glossary-of-errors"><a class="header" href="#glossary-of-errors">Glossary of Errors</a></h2>
<p>This section contains tips related to some error terminology in Forge. </p>
<h3 id="errors-related-to-bounds"><a class="header" href="#errors-related-to-bounds">Errors Related to Bounds</a></h3>
<h4 id="please-specify-an-upper-bound-for-ancestors-of-"><a class="header" href="#please-specify-an-upper-bound-for-ancestors-of-">Please specify an upper bound for ancestors of ...</a></h4>
<p>If <code>A</code> is a <code>sig</code>, and you get an error that says &quot;Please specify an upper bound for ancestors of A&quot;, this means that, while you've defined the contents of <code>A</code>, Forge cannot infer corresponding contents for the parent <code>sig</code> of <code>A</code> and needs you to provide a binding. </p>
<div id="admonition-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="glossary.html#admonition-example"></a></p>
</div>
<div>
<p>Given this definition:</p>
<pre><code>sig Course {}
sig Intro, Intermediate, UpperLevel extends Course {} 
</code></pre>
<p>and this example:</p>
<pre><code>example someIntro is {wellformed} for {
    Intro = `CSCI0150
}
</code></pre>
<p>the above error will be produced. Add a bound for <code>Course</code>:</p>
<pre><code>example someIntro is {wellformed} for {
    Intro = `CSCI0150
    Course = `CSCI0150
}
</code></pre>
</div>
</div>
<h3 id="errors-related-to-testing"><a class="header" href="#errors-related-to-testing">Errors Related to Testing</a></h3>
<h4 id="invalid-example--the-instance-specified-is-impossible-"><a class="header" href="#invalid-example--the-instance-specified-is-impossible-">Invalid example ... the instance specified is impossible ...</a></h4>
<p>If an example fails, Forge will attempt to disambiguate between:</p>
<ul>
<li>it actually fails the <em>predicate under test</em>; and </li>
<li>it fails because it violates the type declarations for sigs and fields. </li>
</ul>
<p>Consider this example:</p>
<div id="admonition-impossible-instance" class="admonition admonish-example">
<div class="admonition-title">
<p>Impossible Instance</p>
<p><a class="admonition-anchor-link" href="glossary.html#admonition-impossible-instance"></a></p>
</div>
<div>
<pre><code>#lang forge/bsl 

abstract sig Grade {} 
one sig A, B, C, None extends Grade {} 
sig Course {} 
sig Person { 
    grades: func Course -&gt; Grade,
    spouse: lone Person 
}

pred wellformed { 
    all p: Person | p != p.spouse 
    all p1,p2: Person | p1 = p2.spouse implies p2 = p1.spouse
}

example selfloopNotWellformed is {wellformed} for {
    Person = `Tim + `Nim 
    Course = `CSCI1710 + `CSCI0320
    A = `A   B = `B   C = `C   None = `None 
    Grade = A + B + C + None

    -- this violates wellformed
    `Tim.spouse = `Tim 
    
    -- but this violates the definition: &quot;grades&quot; is a total function
    -- from courses to grades; there's no entry for `CSCI0320.
    `Tim.grades = (`CSCI1710) -&gt; B
    
}
</code></pre>
</div>
</div>
<p>If you receive this message, it means your example does something like the above, where some type declaration unrelated to the predicate under test is being violated.</p>
<h3 id="errors-related-to-syntax"><a class="header" href="#errors-related-to-syntax">Errors related to syntax</a></h3>
<h4 id="unexpected-type-or-contract-violation"><a class="header" href="#unexpected-type-or-contract-violation">Unexpected type or Contract Violation</a></h4>
<p>In Forge there are 2 kinds of constraint syntax for use in predicates:</p>
<ul>
<li>formulas, which evaluate to true or false; and </li>
<li>expressions, which evaluate to values like specific atoms. </li>
</ul>
<p>If you write something like this:</p>
<div id="admonition-contract-violation" class="admonition admonish-example">
<div class="admonition-title">
<p>Contract Violation</p>
<p><a class="admonition-anchor-link" href="glossary.html#admonition-contract-violation"></a></p>
</div>
<div>
<pre><code>#lang forge/bsl 
sig Person {spouse: lone Person}
run { some p: Person | p.spouse}
</code></pre>
<p>produces:</p>
<pre><code>some: contract violation
  expected: formula?
  given: (join p (Relation spouse))
</code></pre>
</div>
</div>
<p>The syntax is invalid: the <code>some</code> quantifier expects a <em>formula</em> after its such-that bar, but <code>p.spouse</code> is an expression. Something like <code>some p.spouse</code> is OK. (The phrase &quot;contract violation&quot; in this case just means &quot;I was passed something I didn't expect.&quot;)</p>
<p>Likewise: </p>
<div id="admonition-unexpected-type" class="admonition admonish-example">
<div class="admonition-title">
<p>Unexpected Type</p>
<p><a class="admonition-anchor-link" href="glossary.html#admonition-unexpected-type"></a></p>
</div>
<div>
<pre><code>sig Person {spouse: lone Person}
run { all p1,p2: Person | p1.spouse = p2.spouse implies p2.spouse}
</code></pre>
<p>results in:</p>
<pre><code>=&gt;: argument to =&gt; had unexpected type. 
  expected #&lt;procedure:node/formula?&gt;,
  got (join p2 (Relation spouse))
</code></pre>
</div>
</div>
<p>Since <code>implies</code> is a boolean operator, it takes a <em>formula</em> as its argument. Unfortunately, <code>p2.spouse</code> is an expression, not a formula. To fix this, express what you really meant was <em>implied</em>. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
